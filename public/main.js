class N9{r;c;el;mine=!1;revealed=!1;flagged=!1;constructor(Z,Q,K){this.r=Z,this.c=Q,this.el=K}}var N4={easy:{r:9,c:9,m:10},medium:{r:16,c:16,m:40},hard:{r:16,c:30,m:99}},I9=3;var I4=()=>{return};var _4=function(Z){let Q=[],K=0;for(let J=0;J<Z.length;J++){let W=Z.charCodeAt(J);if(W<128)Q[K++]=W;else if(W<2048)Q[K++]=W>>6|192,Q[K++]=W&63|128;else if((W&64512)===55296&&J+1<Z.length&&(Z.charCodeAt(J+1)&64512)===56320)W=65536+((W&1023)<<10)+(Z.charCodeAt(++J)&1023),Q[K++]=W>>18|240,Q[K++]=W>>12&63|128,Q[K++]=W>>6&63|128,Q[K++]=W&63|128;else Q[K++]=W>>12|224,Q[K++]=W>>6&63|128,Q[K++]=W&63|128}return Q},RJ=function(Z){let Q=[],K=0,J=0;while(K<Z.length){let W=Z[K++];if(W<128)Q[J++]=String.fromCharCode(W);else if(W>191&&W<224){let X=Z[K++];Q[J++]=String.fromCharCode((W&31)<<6|X&63)}else if(W>239&&W<365){let X=Z[K++],U=Z[K++],Y=Z[K++],z=((W&7)<<18|(X&63)<<12|(U&63)<<6|Y&63)-65536;Q[J++]=String.fromCharCode(55296+(z>>10)),Q[J++]=String.fromCharCode(56320+(z&1023))}else{let X=Z[K++],U=Z[K++];Q[J++]=String.fromCharCode((W&15)<<12|(X&63)<<6|U&63)}}return Q.join("")},A4={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob==="function",encodeByteArray(Z,Q){if(!Array.isArray(Z))throw Error("encodeByteArray takes an array as a parameter");this.init_();let K=Q?this.byteToCharMapWebSafe_:this.byteToCharMap_,J=[];for(let W=0;W<Z.length;W+=3){let X=Z[W],U=W+1<Z.length,Y=U?Z[W+1]:0,z=W+2<Z.length,P=z?Z[W+2]:0,F=X>>2,j=(X&3)<<4|Y>>4,I=(Y&15)<<2|P>>6,T=P&63;if(!z){if(T=64,!U)I=64}J.push(K[F],K[j],K[I],K[T])}return J.join("")},encodeString(Z,Q){if(this.HAS_NATIVE_SUPPORT&&!Q)return btoa(Z);return this.encodeByteArray(_4(Z),Q)},decodeString(Z,Q){if(this.HAS_NATIVE_SUPPORT&&!Q)return atob(Z);return RJ(this.decodeStringToByteArray(Z,Q))},decodeStringToByteArray(Z,Q){this.init_();let K=Q?this.charToByteMapWebSafe_:this.charToByteMap_,J=[];for(let W=0;W<Z.length;){let X=K[Z.charAt(W++)],Y=W<Z.length?K[Z.charAt(W)]:0;++W;let P=W<Z.length?K[Z.charAt(W)]:64;++W;let j=W<Z.length?K[Z.charAt(W)]:64;if(++W,X==null||Y==null||P==null||j==null)throw new S4;let I=X<<2|Y>>4;if(J.push(I),P!==64){let T=Y<<4&240|P>>2;if(J.push(T),j!==64){let C=P<<6&192|j;J.push(C)}}}return J},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let Z=0;Z<this.ENCODED_VALS.length;Z++)if(this.byteToCharMap_[Z]=this.ENCODED_VALS.charAt(Z),this.charToByteMap_[this.byteToCharMap_[Z]]=Z,this.byteToCharMapWebSafe_[Z]=this.ENCODED_VALS_WEBSAFE.charAt(Z),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[Z]]=Z,Z>=this.ENCODED_VALS_BASE.length)this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(Z)]=Z,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(Z)]=Z}}};class S4 extends Error{constructor(){super(...arguments);this.name="DecodeBase64StringError"}}var NJ=function(Z){let Q=_4(Z);return A4.encodeByteArray(Q,!0)},D8=function(Z){return NJ(Z).replace(/\./g,"")},T4=function(Z){try{return A4.decodeString(Z,!0)}catch(Q){console.error("base64Decode failed: ",Q)}return null};function E4(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw Error("Unable to locate global object.")}var IJ=()=>E4().__FIREBASE_DEFAULTS__,OJ=()=>{if(typeof process>"u"||typeof process.env>"u")return;let Z=process.env.__FIREBASE_DEFAULTS__;if(Z)return JSON.parse(Z)},jJ=()=>{if(typeof document>"u")return;let Z;try{Z=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(K){return}let Q=Z&&T4(Z[1]);return Q&&JSON.parse(Q)},O9=()=>{try{return I4()||IJ()||OJ()||jJ()}catch(Z){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${Z}`);return}},_J=(Z)=>O9()?.emulatorHosts?.[Z],L4=(Z)=>{let Q=_J(Z);if(!Q)return;let K=Q.lastIndexOf(":");if(K<=0||K+1===Q.length)throw Error(`Invalid host ${Q} with no separate hostname and port!`);let J=parseInt(Q.substring(K+1),10);if(Q[0]==="[")return[Q.substring(1,K-1),J];else return[Q.substring(0,K),J]},j9=()=>O9()?.config;class _9{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((Z,Q)=>{this.resolve=Z,this.reject=Q})}wrapCallback(Z){return(Q,K)=>{if(Q)this.reject(Q);else this.resolve(K);if(typeof Z==="function")if(this.promise.catch(()=>{}),Z.length===1)Z(Q);else Z(Q,K)}}}function B1(Z){try{return(Z.startsWith("http://")||Z.startsWith("https://")?new URL(Z).hostname:Z).endsWith(".cloudworkstations.dev")}catch{return!1}}async function x4(Z){return(await fetch(Z,{credentials:"include"})).ok}function y4(Z,Q){if(Z.uid)throw Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');let K={alg:"none",type:"JWT"},J=Q||"demo-project",W=Z.iat||0,X=Z.sub||Z.user_id;if(!X)throw Error("mockUserToken must contain 'sub' or 'user_id' field!");let U={iss:`https://securetoken.google.com/${J}`,aud:J,iat:W,exp:W+3600,auth_time:W,sub:X,user_id:X,firebase:{sign_in_provider:"custom",identities:{}},...Z},Y="";return[D8(JSON.stringify(K)),D8(JSON.stringify(U)),Y].join(".")}var F8={};function AJ(){let Z={prod:[],emulator:[]};for(let Q of Object.keys(F8))if(F8[Q])Z.emulator.push(Q);else Z.prod.push(Q);return Z}function SJ(Z){let Q=document.getElementById(Z),K=!1;if(!Q)Q=document.createElement("div"),Q.setAttribute("id",Z),K=!0;return{created:K,element:Q}}var O4=!1;function C4(Z,Q){if(typeof window>"u"||typeof document>"u"||!B1(window.location.host)||F8[Z]===Q||F8[Z]||O4)return;F8[Z]=Q;function K(I){return`__firebase__banner__${I}`}let J="__firebase__banner",X=AJ().prod.length>0;function U(){let I=document.getElementById(J);if(I)I.remove()}function Y(I){I.style.display="flex",I.style.background="#7faaf0",I.style.position="fixed",I.style.bottom="5px",I.style.left="5px",I.style.padding=".5em",I.style.borderRadius="5px",I.style.alignItems="center"}function z(I,T){I.setAttribute("width","24"),I.setAttribute("id",T),I.setAttribute("height","24"),I.setAttribute("viewBox","0 0 24 24"),I.setAttribute("fill","none"),I.style.marginLeft="-6px"}function P(){let I=document.createElement("span");return I.style.cursor="pointer",I.style.marginLeft="16px",I.style.fontSize="24px",I.innerHTML=" &times;",I.onclick=()=>{O4=!0,U()},I}function F(I,T){I.setAttribute("id",T),I.innerText="Learn more",I.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",I.setAttribute("target","__blank"),I.style.paddingLeft="5px",I.style.textDecoration="underline"}function j(){let I=SJ(J),T=K("text"),C=document.getElementById(T)||document.createElement("span"),x=K("learnmore"),k=document.getElementById(x)||document.createElement("a"),d=K("preprendIcon"),i=document.getElementById(d)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(I.created){let n=I.element;Y(n),F(k,x);let F0=P();z(i,d),n.append(i,C,k,F0),document.body.appendChild(n)}if(X)C.innerText="Preview backend disconnected.",i.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`;else i.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,C.innerText="Preview backend running in this workspace.";C.setAttribute("id",T)}if(document.readyState==="loading")window.addEventListener("DOMContentLoaded",j);else j()}function k4(){if(typeof navigator<"u"&&typeof navigator.userAgent==="string")return navigator.userAgent;else return""}function TJ(){let Z=O9()?.forceEnvironment;if(Z==="node")return!0;else if(Z==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch(Q){return!1}}function h4(){return!TJ()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function A9(){try{return typeof indexedDB==="object"}catch(Z){return!1}}function v4(){return new Promise((Z,Q)=>{try{let K=!0,J="validate-browser-context-for-indexeddb-analytics-module",W=self.indexedDB.open(J);W.onsuccess=()=>{if(W.result.close(),!K)self.indexedDB.deleteDatabase(J);Z(!0)},W.onupgradeneeded=()=>{K=!1},W.onerror=()=>{Q(W.error?.message||"")}}catch(K){Q(K)}})}var EJ="FirebaseError";class g0 extends Error{constructor(Z,Q,K){super(Q);if(this.code=Z,this.customData=K,this.name=EJ,Object.setPrototypeOf(this,g0.prototype),Error.captureStackTrace)Error.captureStackTrace(this,q1.prototype.create)}}class q1{constructor(Z,Q,K){this.service=Z,this.serviceName=Q,this.errors=K}create(Z,...Q){let K=Q[0]||{},J=`${this.service}/${Z}`,W=this.errors[Z],X=W?LJ(W,K):"Error",U=`${this.serviceName}: ${X} (${J}).`;return new g0(J,U,K)}}function LJ(Z,Q){return Z.replace(xJ,(K,J)=>{let W=Q[J];return W!=null?String(W):`<${J}?>`})}var xJ=/\{\$([^}]+)}/g;function E6(Z,Q){if(Z===Q)return!0;let K=Object.keys(Z),J=Object.keys(Q);for(let W of K){if(!J.includes(W))return!1;let X=Z[W],U=Q[W];if(j4(X)&&j4(U)){if(!E6(X,U))return!1}else if(X!==U)return!1}for(let W of J)if(!K.includes(W))return!1;return!0}function j4(Z){return Z!==null&&typeof Z==="object"}function x0(Z){if(Z&&Z._delegate)return Z._delegate;else return Z}class J6{constructor(Z,Q,K){this.name=Z,this.instanceFactory=Q,this.type=K,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(Z){return this.instantiationMode=Z,this}setMultipleInstances(Z){return this.multipleInstances=Z,this}setServiceProps(Z){return this.serviceProps=Z,this}setInstanceCreatedCallback(Z){return this.onInstanceCreated=Z,this}}var R6="[DEFAULT]";class m4{constructor(Z,Q){this.name=Z,this.container=Q,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(Z){let Q=this.normalizeInstanceIdentifier(Z);if(!this.instancesDeferred.has(Q)){let K=new _9;if(this.instancesDeferred.set(Q,K),this.isInitialized(Q)||this.shouldAutoInitialize())try{let J=this.getOrInitializeService({instanceIdentifier:Q});if(J)K.resolve(J)}catch(J){}}return this.instancesDeferred.get(Q).promise}getImmediate(Z){let Q=this.normalizeInstanceIdentifier(Z?.identifier),K=Z?.optional??!1;if(this.isInitialized(Q)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:Q})}catch(J){if(K)return null;else throw J}else if(K)return null;else throw Error(`Service ${this.name} is not available`)}getComponent(){return this.component}setComponent(Z){if(Z.name!==this.name)throw Error(`Mismatching Component ${Z.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=Z,!this.shouldAutoInitialize())return;if(CJ(Z))try{this.getOrInitializeService({instanceIdentifier:R6})}catch(Q){}for(let[Q,K]of this.instancesDeferred.entries()){let J=this.normalizeInstanceIdentifier(Q);try{let W=this.getOrInitializeService({instanceIdentifier:J});K.resolve(W)}catch(W){}}}clearInstance(Z=R6){this.instancesDeferred.delete(Z),this.instancesOptions.delete(Z),this.instances.delete(Z)}async delete(){let Z=Array.from(this.instances.values());await Promise.all([...Z.filter((Q)=>("INTERNAL"in Q)).map((Q)=>Q.INTERNAL.delete()),...Z.filter((Q)=>("_delete"in Q)).map((Q)=>Q._delete())])}isComponentSet(){return this.component!=null}isInitialized(Z=R6){return this.instances.has(Z)}getOptions(Z=R6){return this.instancesOptions.get(Z)||{}}initialize(Z={}){let{options:Q={}}=Z,K=this.normalizeInstanceIdentifier(Z.instanceIdentifier);if(this.isInitialized(K))throw Error(`${this.name}(${K}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);let J=this.getOrInitializeService({instanceIdentifier:K,options:Q});for(let[W,X]of this.instancesDeferred.entries()){let U=this.normalizeInstanceIdentifier(W);if(K===U)X.resolve(J)}return J}onInit(Z,Q){let K=this.normalizeInstanceIdentifier(Q),J=this.onInitCallbacks.get(K)??new Set;J.add(Z),this.onInitCallbacks.set(K,J);let W=this.instances.get(K);if(W)Z(W,K);return()=>{J.delete(Z)}}invokeOnInitCallbacks(Z,Q){let K=this.onInitCallbacks.get(Q);if(!K)return;for(let J of K)try{J(Z,Q)}catch{}}getOrInitializeService({instanceIdentifier:Z,options:Q={}}){let K=this.instances.get(Z);if(!K&&this.component){if(K=this.component.instanceFactory(this.container,{instanceIdentifier:yJ(Z),options:Q}),this.instances.set(Z,K),this.instancesOptions.set(Z,Q),this.invokeOnInitCallbacks(K,Z),this.component.onInstanceCreated)try{this.component.onInstanceCreated(this.container,Z,K)}catch{}}return K||null}normalizeInstanceIdentifier(Z=R6){if(this.component)return this.component.multipleInstances?Z:R6;else return Z}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function yJ(Z){return Z===R6?void 0:Z}function CJ(Z){return Z.instantiationMode==="EAGER"}class S9{constructor(Z){this.name=Z,this.providers=new Map}addComponent(Z){let Q=this.getProvider(Z.name);if(Q.isComponentSet())throw Error(`Component ${Z.name} has already been registered with ${this.name}`);Q.setComponent(Z)}addOrOverwriteComponent(Z){if(this.getProvider(Z.name).isComponentSet())this.providers.delete(Z.name);this.addComponent(Z)}getProvider(Z){if(this.providers.has(Z))return this.providers.get(Z);let Q=new m4(Z,this);return this.providers.set(Z,Q),Q}getProviders(){return Array.from(this.providers.values())}}var kJ=[],l;(function(Z){Z[Z.DEBUG=0]="DEBUG",Z[Z.VERBOSE=1]="VERBOSE",Z[Z.INFO=2]="INFO",Z[Z.WARN=3]="WARN",Z[Z.ERROR=4]="ERROR",Z[Z.SILENT=5]="SILENT"})(l||(l={}));var hJ={debug:l.DEBUG,verbose:l.VERBOSE,info:l.INFO,warn:l.WARN,error:l.ERROR,silent:l.SILENT},vJ=l.INFO,mJ={[l.DEBUG]:"log",[l.VERBOSE]:"log",[l.INFO]:"info",[l.WARN]:"warn",[l.ERROR]:"error"},uJ=(Z,Q,...K)=>{if(Q<Z.logLevel)return;let J=new Date().toISOString(),W=mJ[Q];if(W)console[W](`[${J}]  ${Z.name}:`,...K);else throw Error(`Attempted to log a message with an invalid logType (value: ${Q})`)};class M8{constructor(Z){this.name=Z,this._logLevel=vJ,this._logHandler=uJ,this._userLogHandler=null,kJ.push(this)}get logLevel(){return this._logLevel}set logLevel(Z){if(!(Z in l))throw TypeError(`Invalid value "${Z}" assigned to \`logLevel\``);this._logLevel=Z}setLogLevel(Z){this._logLevel=typeof Z==="string"?hJ[Z]:Z}get logHandler(){return this._logHandler}set logHandler(Z){if(typeof Z!=="function")throw TypeError("Value assigned to `logHandler` must be a function");this._logHandler=Z}get userLogHandler(){return this._userLogHandler}set userLogHandler(Z){this._userLogHandler=Z}debug(...Z){this._userLogHandler&&this._userLogHandler(this,l.DEBUG,...Z),this._logHandler(this,l.DEBUG,...Z)}log(...Z){this._userLogHandler&&this._userLogHandler(this,l.VERBOSE,...Z),this._logHandler(this,l.VERBOSE,...Z)}info(...Z){this._userLogHandler&&this._userLogHandler(this,l.INFO,...Z),this._logHandler(this,l.INFO,...Z)}warn(...Z){this._userLogHandler&&this._userLogHandler(this,l.WARN,...Z),this._logHandler(this,l.WARN,...Z)}error(...Z){this._userLogHandler&&this._userLogHandler(this,l.ERROR,...Z),this._logHandler(this,l.ERROR,...Z)}}var fJ=(Z,Q)=>Q.some((K)=>Z instanceof K),u4,f4;function gJ(){return u4||(u4=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function pJ(){return f4||(f4=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}var g4=new WeakMap,E9=new WeakMap,p4=new WeakMap,T9=new WeakMap,x9=new WeakMap;function lJ(Z){let Q=new Promise((K,J)=>{let W=()=>{Z.removeEventListener("success",X),Z.removeEventListener("error",U)},X=()=>{K(y0(Z.result)),W()},U=()=>{J(Z.error),W()};Z.addEventListener("success",X),Z.addEventListener("error",U)});return Q.then((K)=>{if(K instanceof IDBCursor)g4.set(K,Z)}).catch(()=>{}),x9.set(Q,Z),Q}function sJ(Z){if(E9.has(Z))return;let Q=new Promise((K,J)=>{let W=()=>{Z.removeEventListener("complete",X),Z.removeEventListener("error",U),Z.removeEventListener("abort",U)},X=()=>{K(),W()},U=()=>{J(Z.error||new DOMException("AbortError","AbortError")),W()};Z.addEventListener("complete",X),Z.addEventListener("error",U),Z.addEventListener("abort",U)});E9.set(Z,Q)}var L9={get(Z,Q,K){if(Z instanceof IDBTransaction){if(Q==="done")return E9.get(Z);if(Q==="objectStoreNames")return Z.objectStoreNames||p4.get(Z);if(Q==="store")return K.objectStoreNames[1]?void 0:K.objectStore(K.objectStoreNames[0])}return y0(Z[Q])},set(Z,Q,K){return Z[Q]=K,!0},has(Z,Q){if(Z instanceof IDBTransaction&&(Q==="done"||Q==="store"))return!0;return Q in Z}};function l4(Z){L9=Z(L9)}function iJ(Z){if(Z===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype))return function(Q,...K){let J=Z.call(F1(this),Q,...K);return p4.set(J,Q.sort?Q.sort():[Q]),y0(J)};if(pJ().includes(Z))return function(...Q){return Z.apply(F1(this),Q),y0(g4.get(this))};return function(...Q){return y0(Z.apply(F1(this),Q))}}function dJ(Z){if(typeof Z==="function")return iJ(Z);if(Z instanceof IDBTransaction)sJ(Z);if(fJ(Z,gJ()))return new Proxy(Z,L9);return Z}function y0(Z){if(Z instanceof IDBRequest)return lJ(Z);if(T9.has(Z))return T9.get(Z);let Q=dJ(Z);if(Q!==Z)T9.set(Z,Q),x9.set(Q,Z);return Q}var F1=(Z)=>x9.get(Z);function i4(Z,Q,{blocked:K,upgrade:J,blocking:W,terminated:X}={}){let U=indexedDB.open(Z,Q),Y=y0(U);if(J)U.addEventListener("upgradeneeded",(z)=>{J(y0(U.result),z.oldVersion,z.newVersion,y0(U.transaction),z)});if(K)U.addEventListener("blocked",(z)=>K(z.oldVersion,z.newVersion,z));return Y.then((z)=>{if(X)z.addEventListener("close",()=>X());if(W)z.addEventListener("versionchange",(P)=>W(P.oldVersion,P.newVersion,P))}).catch(()=>{}),Y}var oJ=["get","getKey","getAll","getAllKeys","count"],nJ=["put","add","delete","clear"],y9=new Map;function s4(Z,Q){if(!(Z instanceof IDBDatabase&&!(Q in Z)&&typeof Q==="string"))return;if(y9.get(Q))return y9.get(Q);let K=Q.replace(/FromIndex$/,""),J=Q!==K,W=nJ.includes(K);if(!(K in(J?IDBIndex:IDBObjectStore).prototype)||!(W||oJ.includes(K)))return;let X=async function(U,...Y){let z=this.transaction(U,W?"readwrite":"readonly"),P=z.store;if(J)P=P.index(Y.shift());return(await Promise.all([P[K](...Y),W&&z.done]))[0]};return y9.set(Q,X),X}l4((Z)=>({...Z,get:(Q,K,J)=>s4(Q,K)||Z.get(Q,K,J),has:(Q,K)=>!!s4(Q,K)||Z.has(Q,K)}));class b4{constructor(Z){this.container=Z}getPlatformInfoString(){return this.container.getProviders().map((Q)=>{if(tJ(Q)){let K=Q.getImmediate();return`${K.library}/${K.version}`}else return null}).filter((Q)=>Q).join(" ")}}function tJ(Z){return Z.getComponent()?.type==="VERSION"}var k9="@firebase/app",d4="0.14.6",p0=new M8("@firebase/app"),rJ="@firebase/app-compat",bJ="@firebase/analytics-compat",cJ="@firebase/analytics",eJ="@firebase/app-check-compat",aJ="@firebase/app-check",ZG="@firebase/auth",QG="@firebase/auth-compat",KG="@firebase/database",JG="@firebase/data-connect",GG="@firebase/database-compat",WG="@firebase/functions",XG="@firebase/functions-compat",$G="@firebase/installations",UG="@firebase/installations-compat",VG="@firebase/messaging",YG="@firebase/messaging-compat",zG="@firebase/performance",HG="@firebase/performance-compat",PG="@firebase/remote-config",wG="@firebase/remote-config-compat",BG="@firebase/storage",qG="@firebase/storage-compat",FG="@firebase/firestore",DG="@firebase/ai",MG="@firebase/firestore-compat",RG="firebase",NG="12.6.0",h9="[DEFAULT]",IG={[k9]:"fire-core",[rJ]:"fire-core-compat",[cJ]:"fire-analytics",[bJ]:"fire-analytics-compat",[aJ]:"fire-app-check",[eJ]:"fire-app-check-compat",[ZG]:"fire-auth",[QG]:"fire-auth-compat",[KG]:"fire-rtdb",[JG]:"fire-data-connect",[GG]:"fire-rtdb-compat",[WG]:"fire-fn",[XG]:"fire-fn-compat",[$G]:"fire-iid",[UG]:"fire-iid-compat",[VG]:"fire-fcm",[YG]:"fire-fcm-compat",[zG]:"fire-perf",[HG]:"fire-perf-compat",[PG]:"fire-rc",[wG]:"fire-rc-compat",[BG]:"fire-gcs",[qG]:"fire-gcs-compat",[FG]:"fire-fst",[MG]:"fire-fst-compat",[DG]:"fire-vertex","fire-js":"fire-js",[RG]:"fire-js-all"},D1=new Map,OG=new Map,v9=new Map;function o4(Z,Q){try{Z.container.addComponent(Q)}catch(K){p0.debug(`Component ${Q.name} failed to register with FirebaseApp ${Z.name}`,K)}}function R8(Z){let Q=Z.name;if(v9.has(Q))return p0.debug(`There were multiple attempts to register component ${Q}.`),!1;v9.set(Q,Z);for(let K of D1.values())o4(K,Z);for(let K of OG.values())o4(K,Z);return!0}function c4(Z,Q){let K=Z.container.getProvider("heartbeat").getImmediate({optional:!0});if(K)K.triggerHeartbeat();return Z.container.getProvider(Q)}function e4(Z){if(Z===null||Z===void 0)return!1;return Z.settings!==void 0}var jG={["no-app"]:"No Firebase App '{$appName}' has been created - call initializeApp() first",["bad-app-name"]:"Illegal App name: '{$appName}'",["duplicate-app"]:"Firebase App named '{$appName}' already exists with different options or config",["app-deleted"]:"Firebase App named '{$appName}' already deleted",["server-app-deleted"]:"Firebase Server App has been deleted",["no-options"]:"Need to provide options, when not being deployed to hosting via source.",["invalid-app-argument"]:"firebase.{$appName}() takes either no argument or a Firebase App instance.",["invalid-log-argument"]:"First argument to `onLog` must be null or a function.",["idb-open"]:"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.",["idb-get"]:"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.",["idb-set"]:"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.",["idb-delete"]:"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.",["finalization-registry-not-supported"]:"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.",["invalid-server-app-environment"]:"FirebaseServerApp is not for use in browser environments."},G6=new q1("app","Firebase",jG);class a4{constructor(Z,Q,K){this._isDeleted=!1,this._options={...Z},this._config={...Q},this._name=Q.name,this._automaticDataCollectionEnabled=Q.automaticDataCollectionEnabled,this._container=K,this.container.addComponent(new J6("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(Z){this.checkDestroyed(),this._automaticDataCollectionEnabled=Z}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(Z){this._isDeleted=Z}checkDestroyed(){if(this.isDeleted)throw G6.create("app-deleted",{appName:this._name})}}var ZQ=NG;function m9(Z,Q={}){let K=Z;if(typeof Q!=="object")Q={name:Q};let J={name:h9,automaticDataCollectionEnabled:!0,...Q},W=J.name;if(typeof W!=="string"||!W)throw G6.create("bad-app-name",{appName:String(W)});if(K||(K=j9()),!K)throw G6.create("no-options");let X=D1.get(W);if(X)if(E6(K,X.options)&&E6(J,X.config))return X;else throw G6.create("duplicate-app",{appName:W});let U=new S9(W);for(let z of v9.values())U.addComponent(z);let Y=new a4(K,J,U);return D1.set(W,Y),Y}function QQ(Z=h9){let Q=D1.get(Z);if(!Q&&Z===h9&&j9())return m9();if(!Q)throw G6.create("no-app",{appName:Z});return Q}function W6(Z,Q,K){let J=IG[Z]??Z;if(K)J+=`-${K}`;let W=J.match(/\s|\//),X=Q.match(/\s|\//);if(W||X){let U=[`Unable to register library "${J}" with version "${Q}":`];if(W)U.push(`library name "${J}" contains illegal characters (whitespace or "/")`);if(W&&X)U.push("and");if(X)U.push(`version name "${Q}" contains illegal characters (whitespace or "/")`);p0.warn(U.join(" "));return}R8(new J6(`${J}-version`,()=>({library:J,version:Q}),"VERSION"))}var _G="firebase-heartbeat-database",AG=1,N8="firebase-heartbeat-store",C9=null;function KQ(){if(!C9)C9=i4(_G,AG,{upgrade:(Z,Q)=>{switch(Q){case 0:try{Z.createObjectStore(N8)}catch(K){console.warn(K)}}}}).catch((Z)=>{throw G6.create("idb-open",{originalErrorMessage:Z.message})});return C9}async function SG(Z){try{let K=(await KQ()).transaction(N8),J=await K.objectStore(N8).get(JQ(Z));return await K.done,J}catch(Q){if(Q instanceof g0)p0.warn(Q.message);else{let K=G6.create("idb-get",{originalErrorMessage:Q?.message});p0.warn(K.message)}}}async function n4(Z,Q){try{let J=(await KQ()).transaction(N8,"readwrite");await J.objectStore(N8).put(Q,JQ(Z)),await J.done}catch(K){if(K instanceof g0)p0.warn(K.message);else{let J=G6.create("idb-set",{originalErrorMessage:K?.message});p0.warn(J.message)}}}function JQ(Z){return`${Z.name}!${Z.options.appId}`}var TG=1024,EG=30;class GQ{constructor(Z){this.container=Z,this._heartbeatsCache=null;let Q=this.container.getProvider("app").getImmediate();this._storage=new WQ(Q),this._heartbeatsCachePromise=this._storage.read().then((K)=>{return this._heartbeatsCache=K,K})}async triggerHeartbeat(){try{let Q=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),K=t4();if(this._heartbeatsCache?.heartbeats==null){if(this._heartbeatsCache=await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null)return}if(this._heartbeatsCache.lastSentHeartbeatDate===K||this._heartbeatsCache.heartbeats.some((J)=>J.date===K))return;else if(this._heartbeatsCache.heartbeats.push({date:K,agent:Q}),this._heartbeatsCache.heartbeats.length>EG){let J=xG(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(J,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(Z){p0.warn(Z)}}async getHeartbeatsHeader(){try{if(this._heartbeatsCache===null)await this._heartbeatsCachePromise;if(this._heartbeatsCache?.heartbeats==null||this._heartbeatsCache.heartbeats.length===0)return"";let Z=t4(),{heartbeatsToSend:Q,unsentEntries:K}=LG(this._heartbeatsCache.heartbeats),J=D8(JSON.stringify({version:2,heartbeats:Q}));if(this._heartbeatsCache.lastSentHeartbeatDate=Z,K.length>0)this._heartbeatsCache.heartbeats=K,await this._storage.overwrite(this._heartbeatsCache);else this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache);return J}catch(Z){return p0.warn(Z),""}}}function t4(){return new Date().toISOString().substring(0,10)}function LG(Z,Q=TG){let K=[],J=Z.slice();for(let W of Z){let X=K.find((U)=>U.agent===W.agent);if(!X){if(K.push({agent:W.agent,dates:[W.date]}),r4(K)>Q){K.pop();break}}else if(X.dates.push(W.date),r4(K)>Q){X.dates.pop();break}J=J.slice(1)}return{heartbeatsToSend:K,unsentEntries:J}}class WQ{constructor(Z){this.app=Z,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){if(!A9())return!1;else return v4().then(()=>!0).catch(()=>!1)}async read(){if(!await this._canUseIndexedDBPromise)return{heartbeats:[]};else{let Q=await SG(this.app);if(Q?.heartbeats)return Q;else return{heartbeats:[]}}}async overwrite(Z){if(!await this._canUseIndexedDBPromise)return;else{let K=await this.read();return n4(this.app,{lastSentHeartbeatDate:Z.lastSentHeartbeatDate??K.lastSentHeartbeatDate,heartbeats:Z.heartbeats})}}async add(Z){if(!await this._canUseIndexedDBPromise)return;else{let K=await this.read();return n4(this.app,{lastSentHeartbeatDate:Z.lastSentHeartbeatDate??K.lastSentHeartbeatDate,heartbeats:[...K.heartbeats,...Z.heartbeats]})}}}function r4(Z){return D8(JSON.stringify({version:2,heartbeats:Z})).length}function xG(Z){if(Z.length===0)return-1;let Q=0,K=Z[0].date;for(let J=1;J<Z.length;J++)if(Z[J].date<K)K=Z[J].date,Q=J;return Q}function yG(Z){R8(new J6("platform-logger",(Q)=>new b4(Q),"PRIVATE")),R8(new J6("heartbeat",(Q)=>new GQ(Q),"PRIVATE")),W6(k9,d4,Z),W6(k9,d4,"esm2020"),W6("fire-js","")}yG("");var CG="firebase",kG="12.7.0";W6(CG,kG,"app");var XQ=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},$Q={},l0,u9;(function(){var Z;function Q(M,w){function q(){}q.prototype=w.prototype,M.F=w.prototype,M.prototype=new q,M.prototype.constructor=M,M.D=function(R,D,O){for(var B=Array(arguments.length-2),R0=2;R0<arguments.length;R0++)B[R0-2]=arguments[R0];return w.prototype[D].apply(R,B)}}function K(){this.blockSize=-1}function J(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.C=Array(this.blockSize),this.o=this.h=0,this.u()}Q(J,K),J.prototype.u=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function W(M,w,q){q||(q=0);let R=Array(16);if(typeof w==="string")for(var D=0;D<16;++D)R[D]=w.charCodeAt(q++)|w.charCodeAt(q++)<<8|w.charCodeAt(q++)<<16|w.charCodeAt(q++)<<24;else for(D=0;D<16;++D)R[D]=w[q++]|w[q++]<<8|w[q++]<<16|w[q++]<<24;w=M.g[0],q=M.g[1],D=M.g[2];let O=M.g[3],B;B=w+(O^q&(D^O))+R[0]+3614090360&4294967295,w=q+(B<<7&4294967295|B>>>25),B=O+(D^w&(q^D))+R[1]+3905402710&4294967295,O=w+(B<<12&4294967295|B>>>20),B=D+(q^O&(w^q))+R[2]+606105819&4294967295,D=O+(B<<17&4294967295|B>>>15),B=q+(w^D&(O^w))+R[3]+3250441966&4294967295,q=D+(B<<22&4294967295|B>>>10),B=w+(O^q&(D^O))+R[4]+4118548399&4294967295,w=q+(B<<7&4294967295|B>>>25),B=O+(D^w&(q^D))+R[5]+1200080426&4294967295,O=w+(B<<12&4294967295|B>>>20),B=D+(q^O&(w^q))+R[6]+2821735955&4294967295,D=O+(B<<17&4294967295|B>>>15),B=q+(w^D&(O^w))+R[7]+4249261313&4294967295,q=D+(B<<22&4294967295|B>>>10),B=w+(O^q&(D^O))+R[8]+1770035416&4294967295,w=q+(B<<7&4294967295|B>>>25),B=O+(D^w&(q^D))+R[9]+2336552879&4294967295,O=w+(B<<12&4294967295|B>>>20),B=D+(q^O&(w^q))+R[10]+4294925233&4294967295,D=O+(B<<17&4294967295|B>>>15),B=q+(w^D&(O^w))+R[11]+2304563134&4294967295,q=D+(B<<22&4294967295|B>>>10),B=w+(O^q&(D^O))+R[12]+1804603682&4294967295,w=q+(B<<7&4294967295|B>>>25),B=O+(D^w&(q^D))+R[13]+4254626195&4294967295,O=w+(B<<12&4294967295|B>>>20),B=D+(q^O&(w^q))+R[14]+2792965006&4294967295,D=O+(B<<17&4294967295|B>>>15),B=q+(w^D&(O^w))+R[15]+1236535329&4294967295,q=D+(B<<22&4294967295|B>>>10),B=w+(D^O&(q^D))+R[1]+4129170786&4294967295,w=q+(B<<5&4294967295|B>>>27),B=O+(q^D&(w^q))+R[6]+3225465664&4294967295,O=w+(B<<9&4294967295|B>>>23),B=D+(w^q&(O^w))+R[11]+643717713&4294967295,D=O+(B<<14&4294967295|B>>>18),B=q+(O^w&(D^O))+R[0]+3921069994&4294967295,q=D+(B<<20&4294967295|B>>>12),B=w+(D^O&(q^D))+R[5]+3593408605&4294967295,w=q+(B<<5&4294967295|B>>>27),B=O+(q^D&(w^q))+R[10]+38016083&4294967295,O=w+(B<<9&4294967295|B>>>23),B=D+(w^q&(O^w))+R[15]+3634488961&4294967295,D=O+(B<<14&4294967295|B>>>18),B=q+(O^w&(D^O))+R[4]+3889429448&4294967295,q=D+(B<<20&4294967295|B>>>12),B=w+(D^O&(q^D))+R[9]+568446438&4294967295,w=q+(B<<5&4294967295|B>>>27),B=O+(q^D&(w^q))+R[14]+3275163606&4294967295,O=w+(B<<9&4294967295|B>>>23),B=D+(w^q&(O^w))+R[3]+4107603335&4294967295,D=O+(B<<14&4294967295|B>>>18),B=q+(O^w&(D^O))+R[8]+1163531501&4294967295,q=D+(B<<20&4294967295|B>>>12),B=w+(D^O&(q^D))+R[13]+2850285829&4294967295,w=q+(B<<5&4294967295|B>>>27),B=O+(q^D&(w^q))+R[2]+4243563512&4294967295,O=w+(B<<9&4294967295|B>>>23),B=D+(w^q&(O^w))+R[7]+1735328473&4294967295,D=O+(B<<14&4294967295|B>>>18),B=q+(O^w&(D^O))+R[12]+2368359562&4294967295,q=D+(B<<20&4294967295|B>>>12),B=w+(q^D^O)+R[5]+4294588738&4294967295,w=q+(B<<4&4294967295|B>>>28),B=O+(w^q^D)+R[8]+2272392833&4294967295,O=w+(B<<11&4294967295|B>>>21),B=D+(O^w^q)+R[11]+1839030562&4294967295,D=O+(B<<16&4294967295|B>>>16),B=q+(D^O^w)+R[14]+4259657740&4294967295,q=D+(B<<23&4294967295|B>>>9),B=w+(q^D^O)+R[1]+2763975236&4294967295,w=q+(B<<4&4294967295|B>>>28),B=O+(w^q^D)+R[4]+1272893353&4294967295,O=w+(B<<11&4294967295|B>>>21),B=D+(O^w^q)+R[7]+4139469664&4294967295,D=O+(B<<16&4294967295|B>>>16),B=q+(D^O^w)+R[10]+3200236656&4294967295,q=D+(B<<23&4294967295|B>>>9),B=w+(q^D^O)+R[13]+681279174&4294967295,w=q+(B<<4&4294967295|B>>>28),B=O+(w^q^D)+R[0]+3936430074&4294967295,O=w+(B<<11&4294967295|B>>>21),B=D+(O^w^q)+R[3]+3572445317&4294967295,D=O+(B<<16&4294967295|B>>>16),B=q+(D^O^w)+R[6]+76029189&4294967295,q=D+(B<<23&4294967295|B>>>9),B=w+(q^D^O)+R[9]+3654602809&4294967295,w=q+(B<<4&4294967295|B>>>28),B=O+(w^q^D)+R[12]+3873151461&4294967295,O=w+(B<<11&4294967295|B>>>21),B=D+(O^w^q)+R[15]+530742520&4294967295,D=O+(B<<16&4294967295|B>>>16),B=q+(D^O^w)+R[2]+3299628645&4294967295,q=D+(B<<23&4294967295|B>>>9),B=w+(D^(q|~O))+R[0]+4096336452&4294967295,w=q+(B<<6&4294967295|B>>>26),B=O+(q^(w|~D))+R[7]+1126891415&4294967295,O=w+(B<<10&4294967295|B>>>22),B=D+(w^(O|~q))+R[14]+2878612391&4294967295,D=O+(B<<15&4294967295|B>>>17),B=q+(O^(D|~w))+R[5]+4237533241&4294967295,q=D+(B<<21&4294967295|B>>>11),B=w+(D^(q|~O))+R[12]+1700485571&4294967295,w=q+(B<<6&4294967295|B>>>26),B=O+(q^(w|~D))+R[3]+2399980690&4294967295,O=w+(B<<10&4294967295|B>>>22),B=D+(w^(O|~q))+R[10]+4293915773&4294967295,D=O+(B<<15&4294967295|B>>>17),B=q+(O^(D|~w))+R[1]+2240044497&4294967295,q=D+(B<<21&4294967295|B>>>11),B=w+(D^(q|~O))+R[8]+1873313359&4294967295,w=q+(B<<6&4294967295|B>>>26),B=O+(q^(w|~D))+R[15]+4264355552&4294967295,O=w+(B<<10&4294967295|B>>>22),B=D+(w^(O|~q))+R[6]+2734768916&4294967295,D=O+(B<<15&4294967295|B>>>17),B=q+(O^(D|~w))+R[13]+1309151649&4294967295,q=D+(B<<21&4294967295|B>>>11),B=w+(D^(q|~O))+R[4]+4149444226&4294967295,w=q+(B<<6&4294967295|B>>>26),B=O+(q^(w|~D))+R[11]+3174756917&4294967295,O=w+(B<<10&4294967295|B>>>22),B=D+(w^(O|~q))+R[2]+718787259&4294967295,D=O+(B<<15&4294967295|B>>>17),B=q+(O^(D|~w))+R[9]+3951481745&4294967295,M.g[0]=M.g[0]+w&4294967295,M.g[1]=M.g[1]+(D+(B<<21&4294967295|B>>>11))&4294967295,M.g[2]=M.g[2]+D&4294967295,M.g[3]=M.g[3]+O&4294967295}J.prototype.v=function(M,w){w===void 0&&(w=M.length);let q=w-this.blockSize,R=this.C,D=this.h,O=0;for(;O<w;){if(D==0)for(;O<=q;)W(this,M,O),O+=this.blockSize;if(typeof M==="string"){for(;O<w;)if(R[D++]=M.charCodeAt(O++),D==this.blockSize){W(this,R),D=0;break}}else for(;O<w;)if(R[D++]=M[O++],D==this.blockSize){W(this,R),D=0;break}}this.h=D,this.o+=w},J.prototype.A=function(){var M=Array((this.h<56?this.blockSize:this.blockSize*2)-this.h);M[0]=128;for(var w=1;w<M.length-8;++w)M[w]=0;w=this.o*8;for(var q=M.length-8;q<M.length;++q)M[q]=w&255,w/=256;this.v(M),M=Array(16),w=0;for(q=0;q<4;++q)for(let R=0;R<32;R+=8)M[w++]=this.g[q]>>>R&255;return M};function X(M,w){var q=Y;return Object.prototype.hasOwnProperty.call(q,M)?q[M]:q[M]=w(M)}function U(M,w){this.h=w;let q=[],R=!0;for(let D=M.length-1;D>=0;D--){let O=M[D]|0;R&&O==w||(q[D]=O,R=!1)}this.g=q}var Y={};function z(M){return-128<=M&&M<128?X(M,function(w){return new U([w|0],w<0?-1:0)}):new U([M|0],M<0?-1:0)}function P(M){if(isNaN(M)||!isFinite(M))return j;if(M<0)return k(P(-M));let w=[],q=1;for(let R=0;M>=q;R++)w[R]=M/q|0,q*=4294967296;return new U(w,0)}function F(M,w){if(M.length==0)throw Error("number format error: empty string");if(w=w||10,w<2||36<w)throw Error("radix out of range: "+w);if(M.charAt(0)=="-")return k(F(M.substring(1),w));if(M.indexOf("-")>=0)throw Error('number format error: interior "-" character');let q=P(Math.pow(w,8)),R=j;for(let O=0;O<M.length;O+=8){var D=Math.min(8,M.length-O);let B=parseInt(M.substring(O,O+D),w);D<8?(D=P(Math.pow(w,D)),R=R.j(D).add(P(B))):(R=R.j(q),R=R.add(P(B)))}return R}var j=z(0),I=z(1),T=z(16777216);Z=U.prototype,Z.m=function(){if(x(this))return-k(this).m();let M=0,w=1;for(let q=0;q<this.g.length;q++){let R=this.i(q);M+=(R>=0?R:4294967296+R)*w,w*=4294967296}return M},Z.toString=function(M){if(M=M||10,M<2||36<M)throw Error("radix out of range: "+M);if(C(this))return"0";if(x(this))return"-"+k(this).toString(M);let w=P(Math.pow(M,6));var q=this;let R="";for(;;){let D=F0(q,w).g;q=d(q,D.j(w));let O=((q.g.length>0?q.g[0]:q.h)>>>0).toString(M);if(q=D,C(q))return O+R;for(;O.length<6;)O="0"+O;R=O+R}},Z.i=function(M){return M<0?0:M<this.g.length?this.g[M]:this.h};function C(M){if(M.h!=0)return!1;for(let w=0;w<M.g.length;w++)if(M.g[w]!=0)return!1;return!0}function x(M){return M.h==-1}Z.l=function(M){return M=d(this,M),x(M)?-1:C(M)?0:1};function k(M){let w=M.g.length,q=[];for(let R=0;R<w;R++)q[R]=~M.g[R];return new U(q,~M.h).add(I)}Z.abs=function(){return x(this)?k(this):this},Z.add=function(M){let w=Math.max(this.g.length,M.g.length),q=[],R=0;for(let D=0;D<=w;D++){let O=R+(this.i(D)&65535)+(M.i(D)&65535),B=(O>>>16)+(this.i(D)>>>16)+(M.i(D)>>>16);R=B>>>16,O&=65535,B&=65535,q[D]=B<<16|O}return new U(q,q[q.length-1]&-2147483648?-1:0)};function d(M,w){return M.add(k(w))}Z.j=function(M){if(C(this)||C(M))return j;if(x(this))return x(M)?k(this).j(k(M)):k(k(this).j(M));if(x(M))return k(this.j(k(M)));if(this.l(T)<0&&M.l(T)<0)return P(this.m()*M.m());let w=this.g.length+M.g.length,q=[];for(var R=0;R<2*w;R++)q[R]=0;for(R=0;R<this.g.length;R++)for(let D=0;D<M.g.length;D++){let O=this.i(R)>>>16,B=this.i(R)&65535,R0=M.i(D)>>>16,b0=M.i(D)&65535;q[2*R+2*D]+=B*b0,i(q,2*R+2*D),q[2*R+2*D+1]+=O*b0,i(q,2*R+2*D+1),q[2*R+2*D+1]+=B*R0,i(q,2*R+2*D+1),q[2*R+2*D+2]+=O*R0,i(q,2*R+2*D+2)}for(M=0;M<w;M++)q[M]=q[2*M+1]<<16|q[2*M];for(M=w;M<2*w;M++)q[M]=0;return new U(q,0)};function i(M,w){for(;(M[w]&65535)!=M[w];)M[w+1]+=M[w]>>>16,M[w]&=65535,w++}function n(M,w){this.g=M,this.h=w}function F0(M,w){if(C(w))throw Error("division by zero");if(C(M))return new n(j,j);if(x(M))return w=F0(k(M),w),new n(k(w.g),k(w.h));if(x(w))return w=F0(M,k(w)),new n(k(w.g),w.h);if(M.g.length>30){if(x(M)||x(w))throw Error("slowDivide_ only works with positive integers.");for(var q=I,R=w;R.l(M)<=0;)q=O0(q),R=O0(R);var D=P0(q,1),O=P0(R,1);R=P0(R,2);for(q=P0(q,2);!C(R);){var B=O.add(R);B.l(M)<=0&&(D=D.add(q),O=B),R=P0(R,1),q=P0(q,1)}return w=d(M,D.j(w)),new n(D,w)}for(D=j;M.l(w)>=0;){q=Math.max(1,Math.floor(M.m()/w.m())),R=Math.ceil(Math.log(q)/Math.LN2),R=R<=48?1:Math.pow(2,R-48),O=P(q);for(B=O.j(w);x(B)||B.l(M)>0;)q-=R,O=P(q),B=O.j(w);C(O)&&(O=I),D=D.add(O),M=d(M,B)}return new n(D,M)}Z.B=function(M){return F0(this,M).h},Z.and=function(M){let w=Math.max(this.g.length,M.g.length),q=[];for(let R=0;R<w;R++)q[R]=this.i(R)&M.i(R);return new U(q,this.h&M.h)},Z.or=function(M){let w=Math.max(this.g.length,M.g.length),q=[];for(let R=0;R<w;R++)q[R]=this.i(R)|M.i(R);return new U(q,this.h|M.h)},Z.xor=function(M){let w=Math.max(this.g.length,M.g.length),q=[];for(let R=0;R<w;R++)q[R]=this.i(R)^M.i(R);return new U(q,this.h^M.h)};function O0(M){let w=M.g.length+1,q=[];for(let R=0;R<w;R++)q[R]=M.i(R)<<1|M.i(R-1)>>>31;return new U(q,M.h)}function P0(M,w){let q=w>>5;w%=32;let R=M.g.length-q,D=[];for(let O=0;O<R;O++)D[O]=w>0?M.i(O+q)>>>w|M.i(O+q+1)<<32-w:M.i(O+q);return new U(D,M.h)}J.prototype.digest=J.prototype.A,J.prototype.reset=J.prototype.u,J.prototype.update=J.prototype.v,u9=$Q.Md5=J,U.prototype.add=U.prototype.add,U.prototype.multiply=U.prototype.j,U.prototype.modulo=U.prototype.B,U.prototype.compare=U.prototype.l,U.prototype.toNumber=U.prototype.m,U.prototype.toString=U.prototype.toString,U.prototype.getBits=U.prototype.i,U.fromNumber=P,U.fromString=F,l0=$Q.Integer=U}).apply(typeof XQ<"u"?XQ:typeof self<"u"?self:typeof window<"u"?window:{});var M1=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},s0={},f9,hG,L6,g9,I8,R1,p9,l9,s9;(function(){var Z,Q=Object.defineProperty;function K(G){G=[typeof globalThis=="object"&&globalThis,G,typeof window=="object"&&window,typeof self=="object"&&self,typeof M1=="object"&&M1];for(var $=0;$<G.length;++$){var V=G[$];if(V&&V.Math==Math)return V}throw Error("Cannot find global object")}var J=K(this);function W(G,$){if($)Z:{var V=J;G=G.split(".");for(var H=0;H<G.length-1;H++){var N=G[H];if(!(N in V))break Z;V=V[N]}G=G[G.length-1],H=V[G],$=$(H),$!=H&&$!=null&&Q(V,G,{configurable:!0,writable:!0,value:$})}}W("Symbol.dispose",function(G){return G?G:Symbol("Symbol.dispose")}),W("Array.prototype.values",function(G){return G?G:function(){return this[Symbol.iterator]()}}),W("Object.entries",function(G){return G?G:function($){var V=[],H;for(H in $)Object.prototype.hasOwnProperty.call($,H)&&V.push([H,$[H]]);return V}});var X=X||{},U=this||self;function Y(G){var $=typeof G;return $=="object"&&G!=null||$=="function"}function z(G,$,V){return G.call.apply(G.bind,arguments)}function P(G,$,V){return P=z,P.apply(null,arguments)}function F(G,$){var V=Array.prototype.slice.call(arguments,1);return function(){var H=V.slice();return H.push.apply(H,arguments),G.apply(this,H)}}function j(G,$){function V(){}V.prototype=$.prototype,G.Z=$.prototype,G.prototype=new V,G.prototype.constructor=G,G.Ob=function(H,N,_){for(var E=Array(arguments.length-2),f=2;f<arguments.length;f++)E[f-2]=arguments[f];return $.prototype[N].apply(H,E)}}var I=typeof AsyncContext<"u"&&typeof AsyncContext.Snapshot==="function"?(G)=>G&&AsyncContext.Snapshot.wrap(G):(G)=>G;function T(G){let $=G.length;if($>0){let V=Array($);for(let H=0;H<$;H++)V[H]=G[H];return V}return[]}function C(G,$){for(let H=1;H<arguments.length;H++){let N=arguments[H];var V=typeof N;if(V=V!="object"?V:N?Array.isArray(N)?"array":V:"null",V=="array"||V=="object"&&typeof N.length=="number"){V=G.length||0;let _=N.length||0;G.length=V+_;for(let E=0;E<_;E++)G[V+E]=N[E]}else G.push(N)}}class x{constructor(G,$){this.i=G,this.j=$,this.h=0,this.g=null}get(){let G;return this.h>0?(this.h--,G=this.g,this.g=G.next,G.next=null):G=this.i(),G}}function k(G){U.setTimeout(()=>{throw G},0)}function d(){var G=M;let $=null;return G.g&&($=G.g,G.g=G.g.next,G.g||(G.h=null),$.next=null),$}class i{constructor(){this.h=this.g=null}add(G,$){let V=n.get();V.set(G,$),this.h?this.h.next=V:this.g=V,this.h=V}}var n=new x(()=>new F0,(G)=>G.reset());class F0{constructor(){this.next=this.g=this.h=null}set(G,$){this.h=G,this.g=$,this.next=null}reset(){this.next=this.g=this.h=null}}let O0,P0=!1,M=new i,w=()=>{let G=Promise.resolve(void 0);O0=()=>{G.then(q)}};function q(){for(var G;G=d();){try{G.h.call(G.g)}catch(V){k(V)}var $=n;$.j(G),$.h<100&&($.h++,G.next=$.g,$.g=G)}P0=!1}function R(){this.u=this.u,this.C=this.C}R.prototype.u=!1,R.prototype.dispose=function(){this.u||(this.u=!0,this.N())},R.prototype[Symbol.dispose]=function(){this.dispose()},R.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function D(G,$){this.type=G,this.g=this.target=$,this.defaultPrevented=!1}D.prototype.h=function(){this.defaultPrevented=!0};var O=function(){if(!U.addEventListener||!Object.defineProperty)return!1;var G=!1,$=Object.defineProperty({},"passive",{get:function(){G=!0}});try{let V=()=>{};U.addEventListener("test",V,$),U.removeEventListener("test",V,$)}catch(V){}return G}();function B(G){return/^[\s\xa0]*$/.test(G)}function R0(G,$){D.call(this,G?G.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,G&&this.init(G,$)}j(R0,D),R0.prototype.init=function(G,$){let V=this.type=G.type,H=G.changedTouches&&G.changedTouches.length?G.changedTouches[0]:null;this.target=G.target||G.srcElement,this.g=$,$=G.relatedTarget,$||(V=="mouseover"?$=G.fromElement:V=="mouseout"&&($=G.toElement)),this.relatedTarget=$,H?(this.clientX=H.clientX!==void 0?H.clientX:H.pageX,this.clientY=H.clientY!==void 0?H.clientY:H.pageY,this.screenX=H.screenX||0,this.screenY=H.screenY||0):(this.clientX=G.clientX!==void 0?G.clientX:G.pageX,this.clientY=G.clientY!==void 0?G.clientY:G.pageY,this.screenX=G.screenX||0,this.screenY=G.screenY||0),this.button=G.button,this.key=G.key||"",this.ctrlKey=G.ctrlKey,this.altKey=G.altKey,this.shiftKey=G.shiftKey,this.metaKey=G.metaKey,this.pointerId=G.pointerId||0,this.pointerType=G.pointerType,this.state=G.state,this.i=G,G.defaultPrevented&&R0.Z.h.call(this)},R0.prototype.h=function(){R0.Z.h.call(this);let G=this.i;G.preventDefault?G.preventDefault():G.returnValue=!1};var b0="closure_listenable_"+(Math.random()*1e6|0),i3=0;function d3(G,$,V,H,N){this.listener=G,this.proxy=null,this.src=$,this.type=V,this.capture=!!H,this.ha=N,this.key=++i3,this.da=this.fa=!1}function a8(G){G.da=!0,G.listener=null,G.proxy=null,G.src=null,G.ha=null}function Z1(G,$,V){for(let H in G)$.call(V,G[H],H,G)}function o3(G,$){for(let V in G)$.call(void 0,G[V],V,G)}function DZ(G){let $={};for(let V in G)$[V]=G[V];return $}let MZ="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function RZ(G,$){let V,H;for(let N=1;N<arguments.length;N++){H=arguments[N];for(V in H)G[V]=H[V];for(let _=0;_<MZ.length;_++)V=MZ[_],Object.prototype.hasOwnProperty.call(H,V)&&(G[V]=H[V])}}function Q1(G){this.src=G,this.g={},this.h=0}Q1.prototype.add=function(G,$,V,H,N){let _=G.toString();G=this.g[_],G||(G=this.g[_]=[],this.h++);let E=e1(G,$,H,N);return E>-1?($=G[E],V||($.fa=!1)):($=new d3($,this.src,_,!!H,N),$.fa=V,G.push($)),$};function c1(G,$){let V=$.type;if(V in G.g){var H=G.g[V],N=Array.prototype.indexOf.call(H,$,void 0),_;(_=N>=0)&&Array.prototype.splice.call(H,N,1),_&&(a8($),G.g[V].length==0&&(delete G.g[V],G.h--))}}function e1(G,$,V,H){for(let N=0;N<G.length;++N){let _=G[N];if(!_.da&&_.listener==$&&_.capture==!!V&&_.ha==H)return N}return-1}var a1="closure_lm_"+(Math.random()*1e6|0),Z9={};function NZ(G,$,V,H,N){if(H&&H.once)return OZ(G,$,V,H,N);if(Array.isArray($)){for(let _=0;_<$.length;_++)NZ(G,$[_],V,H,N);return null}return V=G9(V),G&&G[b0]?G.J($,V,Y(H)?!!H.capture:!!H,N):IZ(G,$,V,!1,H,N)}function IZ(G,$,V,H,N,_){if(!$)throw Error("Invalid event type");let E=Y(N)?!!N.capture:!!N,f=K9(G);if(f||(G[a1]=f=new Q1(G)),V=f.add($,V,H,E,_),V.proxy)return V;if(H=n3(),V.proxy=H,H.src=G,H.listener=V,G.addEventListener)O||(N=E),N===void 0&&(N=!1),G.addEventListener($.toString(),H,N);else if(G.attachEvent)G.attachEvent(_Z($.toString()),H);else if(G.addListener&&G.removeListener)G.addListener(H);else throw Error("addEventListener and attachEvent are unavailable.");return V}function n3(){function G(V){return $.call(G.src,G.listener,V)}let $=t3;return G}function OZ(G,$,V,H,N){if(Array.isArray($)){for(let _=0;_<$.length;_++)OZ(G,$[_],V,H,N);return null}return V=G9(V),G&&G[b0]?G.K($,V,Y(H)?!!H.capture:!!H,N):IZ(G,$,V,!0,H,N)}function jZ(G,$,V,H,N){if(Array.isArray($))for(var _=0;_<$.length;_++)jZ(G,$[_],V,H,N);else(H=Y(H)?!!H.capture:!!H,V=G9(V),G&&G[b0])?(G=G.i,_=String($).toString(),(_ in G.g)&&($=G.g[_],V=e1($,V,H,N),V>-1&&(a8($[V]),Array.prototype.splice.call($,V,1),$.length==0&&(delete G.g[_],G.h--)))):G&&(G=K9(G))&&($=G.g[$.toString()],G=-1,$&&(G=e1($,V,H,N)),(V=G>-1?$[G]:null)&&Q9(V))}function Q9(G){if(typeof G!=="number"&&G&&!G.da){var $=G.src;if($&&$[b0])c1($.i,G);else{var{type:V,proxy:H}=G;$.removeEventListener?$.removeEventListener(V,H,G.capture):$.detachEvent?$.detachEvent(_Z(V),H):$.addListener&&$.removeListener&&$.removeListener(H),(V=K9($))?(c1(V,G),V.h==0&&(V.src=null,$[a1]=null)):a8(G)}}}function _Z(G){return G in Z9?Z9[G]:Z9[G]="on"+G}function t3(G,$){if(G.da)G=!0;else{$=new R0($,this);let V=G.listener,H=G.ha||G.src;G.fa&&Q9(G),G=V.call(H,$)}return G}function K9(G){return G=G[a1],G instanceof Q1?G:null}var J9="__closure_events_fn_"+(Math.random()*1e9>>>0);function G9(G){if(typeof G==="function")return G;return G[J9]||(G[J9]=function($){return G.handleEvent($)}),G[J9]}function w0(){R.call(this),this.i=new Q1(this),this.M=this,this.G=null}j(w0,R),w0.prototype[b0]=!0,w0.prototype.removeEventListener=function(G,$,V,H){jZ(this,G,$,V,H)};function D0(G,$){var V,H=G.G;if(H)for(V=[];H;H=H.G)V.push(H);if(G=G.M,H=$.type||$,typeof $==="string")$=new D($,G);else if($ instanceof D)$.target=$.target||G;else{var N=$;$=new D(H,G),RZ($,N)}N=!0;let _,E;if(V)for(E=V.length-1;E>=0;E--)_=$.g=V[E],N=K1(_,H,!0,$)&&N;if(_=$.g=G,N=K1(_,H,!0,$)&&N,N=K1(_,H,!1,$)&&N,V)for(E=0;E<V.length;E++)_=$.g=V[E],N=K1(_,H,!1,$)&&N}w0.prototype.N=function(){if(w0.Z.N.call(this),this.i){var G=this.i;for(let $ in G.g){let V=G.g[$];for(let H=0;H<V.length;H++)a8(V[H]);delete G.g[$],G.h--}}this.G=null},w0.prototype.J=function(G,$,V,H){return this.i.add(String(G),$,!1,V,H)},w0.prototype.K=function(G,$,V,H){return this.i.add(String(G),$,!0,V,H)};function K1(G,$,V,H){if($=G.i.g[String($)],!$)return!0;$=$.concat();let N=!0;for(let _=0;_<$.length;++_){let E=$[_];if(E&&!E.da&&E.capture==V){let f=E.listener,G0=E.ha||E.src;E.fa&&c1(G.i,E),N=f.call(G0,H)!==!1&&N}}return N&&!H.defaultPrevented}function r3(G,$){if(typeof G!=="function")if(G&&typeof G.handleEvent=="function")G=P(G.handleEvent,G);else throw Error("Invalid listener argument");return Number($)>2147483647?-1:U.setTimeout(G,$||0)}function AZ(G){G.g=r3(()=>{G.g=null,G.i&&(G.i=!1,AZ(G))},G.l);let $=G.h;G.h=null,G.m.apply(null,$)}class SZ extends R{constructor(G,$){super();this.m=G,this.l=$,this.h=null,this.i=!1,this.g=null}j(G){this.h=arguments,this.g?this.i=!0:AZ(this)}N(){super.N(),this.g&&(U.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Q8(G){R.call(this),this.h=G,this.g={}}j(Q8,R);var TZ=[];function EZ(G){Z1(G.g,function($,V){this.g.hasOwnProperty(V)&&Q9($)},G),G.g={}}Q8.prototype.N=function(){Q8.Z.N.call(this),EZ(this)},Q8.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var W9=U.JSON.stringify,b3=U.JSON.parse,c3=class{stringify(G){return U.JSON.stringify(G,void 0)}parse(G){return U.JSON.parse(G,void 0)}};function LZ(){}function xZ(){}var K8={OPEN:"a",hb:"b",ERROR:"c",tb:"d"};function X9(){D.call(this,"d")}j(X9,D);function $9(){D.call(this,"c")}j($9,D);var B6={},yZ=null;function J1(){return yZ=yZ||new w0}B6.Ia="serverreachability";function CZ(G){D.call(this,B6.Ia,G)}j(CZ,D);function J8(G){let $=J1();D0($,new CZ($))}B6.STAT_EVENT="statevent";function kZ(G,$){D.call(this,B6.STAT_EVENT,G),this.stat=$}j(kZ,D);function M0(G){let $=J1();D0($,new kZ($,G))}B6.Ja="timingevent";function hZ(G,$){D.call(this,B6.Ja,G),this.size=$}j(hZ,D);function G8(G,$){if(typeof G!=="function")throw Error("Fn must not be null and must be a function");return U.setTimeout(function(){G()},$)}function W8(){this.g=!0}W8.prototype.ua=function(){this.g=!1};function e3(G,$,V,H,N,_){G.info(function(){if(G.g)if(_){var E="",f=_.split("&");for(let t=0;t<f.length;t++){var G0=f[t].split("=");if(G0.length>1){let U0=G0[0];G0=G0[1];let L0=U0.split("_");E=L0.length>=2&&L0[1]=="type"?E+(U0+"="+G0+"&"):E+(U0+"=redacted&")}}}else E=null;else E=_;return"XMLHTTP REQ ("+H+") [attempt "+N+"]: "+$+`
`+V+`
`+E})}function a3(G,$,V,H,N,_,E){G.info(function(){return"XMLHTTP RESP ("+H+") [ attempt "+N+"]: "+$+`
`+V+`
`+_+" "+E})}function A6(G,$,V,H){G.info(function(){return"XMLHTTP TEXT ("+$+"): "+QJ(G,V)+(H?" "+H:"")})}function ZJ(G,$){G.info(function(){return"TIMEOUT: "+$})}W8.prototype.info=function(){};function QJ(G,$){if(!G.g)return $;if(!$)return null;try{let _=JSON.parse($);if(_){for(G=0;G<_.length;G++)if(Array.isArray(_[G])){var V=_[G];if(!(V.length<2)){var H=V[1];if(Array.isArray(H)&&!(H.length<1)){var N=H[0];if(N!="noop"&&N!="stop"&&N!="close")for(let E=1;E<H.length;E++)H[E]=""}}}}return W9(_)}catch(_){return $}}var G1={NO_ERROR:0,cb:1,qb:2,pb:3,kb:4,ob:5,rb:6,Ga:7,TIMEOUT:8,ub:9},vZ={ib:"complete",Fb:"success",ERROR:"error",Ga:"abort",xb:"ready",yb:"readystatechange",TIMEOUT:"timeout",sb:"incrementaldata",wb:"progress",lb:"downloadprogress",Nb:"uploadprogress"},mZ;function U9(){}j(U9,LZ),U9.prototype.g=function(){return new XMLHttpRequest},mZ=new U9;function X8(G){return encodeURIComponent(String(G))}function KJ(G){var $=1;G=G.split(":");let V=[];for(;$>0&&G.length;)V.push(G.shift()),$--;return G.length&&V.push(G.join(":")),V}function c0(G,$,V,H){this.j=G,this.i=$,this.l=V,this.S=H||1,this.V=new Q8(this),this.H=45000,this.J=null,this.o=!1,this.u=this.B=this.A=this.M=this.F=this.T=this.D=null,this.G=[],this.g=null,this.C=0,this.m=this.v=null,this.X=-1,this.K=!1,this.P=0,this.O=null,this.W=this.L=this.U=this.R=!1,this.h=new uZ}function uZ(){this.i=null,this.g="",this.h=!1}var fZ={},V9={};function Y9(G,$,V){G.M=1,G.A=X1(E0($)),G.u=V,G.R=!0,gZ(G,null)}function gZ(G,$){G.F=Date.now(),W1(G),G.B=E0(G.A);var{B:V,S:H}=G;Array.isArray(H)||(H=[String(H)]),aZ(V.i,"t",H),G.C=0,V=G.j.L,G.h=new uZ,G.g=F4(G.j,V?$:null,!G.u),G.P>0&&(G.O=new SZ(P(G.Y,G,G.g),G.P)),$=G.V,V=G.g,H=G.ba;var N="readystatechange";Array.isArray(N)||(N&&(TZ[0]=N.toString()),N=TZ);for(let _=0;_<N.length;_++){let E=NZ(V,N[_],H||$.handleEvent,!1,$.h||$);if(!E)break;$.g[E.key]=E}$=G.J?DZ(G.J):{},G.u?(G.v||(G.v="POST"),$["Content-Type"]="application/x-www-form-urlencoded",G.g.ea(G.B,G.v,G.u,$)):(G.v="GET",G.g.ea(G.B,G.v,null,$)),J8(),e3(G.i,G.v,G.B,G.l,G.S,G.u)}c0.prototype.ba=function(G){G=G.target;let $=this.O;$&&Z6(G)==3?$.j():this.Y(G)},c0.prototype.Y=function(G){try{if(G==this.g)Z:{let f=Z6(this.g),G0=this.g.ya(),t=this.g.ca();if(!(f<3)&&(f!=3||this.g&&(this.h.h||this.g.la()||X4(this.g)))){this.K||f!=4||G0==7||(G0==8||t<=0?J8(3):J8(2)),z9(this);var $=this.g.ca();this.X=$;var V=JJ(this);if(this.o=$==200,a3(this.i,this.v,this.B,this.l,this.S,f,$),this.o){if(this.U&&!this.L){Q:{if(this.g){var H,N=this.g;if((H=N.g?N.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!B(H)){var _=H;break Q}}_=null}if(G=_)A6(this.i,this.l,G,"Initial handshake response via X-HTTP-Initial-Response"),this.L=!0,H9(this,G);else{this.o=!1,this.m=3,M0(12),q6(this),$8(this);break Z}}if(this.R){G=!0;let U0;for(;!this.K&&this.C<V.length;)if(U0=GJ(this,V),U0==V9){f==4&&(this.m=4,M0(14),G=!1),A6(this.i,this.l,null,"[Incomplete Response]");break}else if(U0==fZ){this.m=4,M0(15),A6(this.i,this.l,V,"[Invalid Chunk]"),G=!1;break}else A6(this.i,this.l,U0,null),H9(this,U0);if(pZ(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),f!=4||V.length!=0||this.h.h||(this.m=1,M0(16),G=!1),this.o=this.o&&G,!G)A6(this.i,this.l,V,"[Invalid Chunked Response]"),q6(this),$8(this);else if(V.length>0&&!this.W){this.W=!0;var E=this.j;E.g==this&&E.aa&&!E.P&&(E.j.info("Great, no buffering proxy detected. Bytes received: "+V.length),M9(E),E.P=!0,M0(11))}}else A6(this.i,this.l,V,null),H9(this,V);f==4&&q6(this),this.o&&!this.K&&(f==4?P4(this.j,this):(this.o=!1,W1(this)))}else DJ(this.g),$==400&&V.indexOf("Unknown SID")>0?(this.m=3,M0(12)):(this.m=0,M0(13)),q6(this),$8(this)}}}catch(f){}finally{}};function JJ(G){if(!pZ(G))return G.g.la();let $=X4(G.g);if($==="")return"";let V="",H=$.length,N=Z6(G.g)==4;if(!G.h.i){if(typeof TextDecoder>"u")return q6(G),$8(G),"";G.h.i=new U.TextDecoder}for(let _=0;_<H;_++)G.h.h=!0,V+=G.h.i.decode($[_],{stream:!(N&&_==H-1)});return $.length=0,G.h.g+=V,G.C=0,G.h.g}function pZ(G){return G.g?G.v=="GET"&&G.M!=2&&G.j.Aa:!1}function GJ(G,$){var V=G.C,H=$.indexOf(`
`,V);if(H==-1)return V9;if(V=Number($.substring(V,H)),isNaN(V))return fZ;if(H+=1,H+V>$.length)return V9;return $=$.slice(H,H+V),G.C=H+V,$}c0.prototype.cancel=function(){this.K=!0,q6(this)};function W1(G){G.T=Date.now()+G.H,lZ(G,G.H)}function lZ(G,$){if(G.D!=null)throw Error("WatchDog timer not null");G.D=G8(P(G.aa,G),$)}function z9(G){G.D&&(U.clearTimeout(G.D),G.D=null)}c0.prototype.aa=function(){this.D=null;let G=Date.now();G-this.T>=0?(ZJ(this.i,this.B),this.M!=2&&(J8(),M0(17)),q6(this),this.m=2,$8(this)):lZ(this,this.T-G)};function $8(G){G.j.I==0||G.K||P4(G.j,G)}function q6(G){z9(G);var $=G.O;$&&typeof $.dispose=="function"&&$.dispose(),G.O=null,EZ(G.V),G.g&&($=G.g,G.g=null,$.abort(),$.dispose())}function H9(G,$){try{var V=G.j;if(V.I!=0&&(V.g==G||P9(V.h,G))){if(!G.L&&P9(V.h,G)&&V.I==3){try{var H=V.Ba.g.parse($)}catch(t){H=null}if(Array.isArray(H)&&H.length==3){var N=H;if(N[0]==0)Z:if(!V.v){if(V.g)if(V.g.F+3000<G.F)H1(V),Y1(V);else break Z;D9(V),M0(18)}else V.xa=N[1],0<V.xa-V.K&&N[2]<37500&&V.F&&V.A==0&&!V.C&&(V.C=G8(P(V.Va,V),6000));dZ(V.h)<=1&&V.ta&&(V.ta=void 0)}else D6(V,11)}else if((G.L||V.g==G)&&H1(V),!B($))for(N=V.Ba.g.parse($),$=0;$<N.length;$++){let t=N[$],U0=t[0];if(!(U0<=V.K))if(V.K=U0,t=t[1],V.I==2)if(t[0]=="c"){V.M=t[1],V.ba=t[2];let L0=t[3];L0!=null&&(V.ka=L0,V.j.info("VER="+V.ka));let M6=t[4];M6!=null&&(V.za=M6,V.j.info("SVER="+V.za));let Q6=t[5];Q6!=null&&typeof Q6==="number"&&Q6>0&&(H=1.5*Q6,V.O=H,V.j.info("backChannelRequestTimeoutMs_="+H)),H=V;let K6=G.g;if(K6){let w1=K6.g?K6.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(w1){var _=H.h;_.g||w1.indexOf("spdy")==-1&&w1.indexOf("quic")==-1&&w1.indexOf("h2")==-1||(_.j=_.l,_.g=new Set,_.h&&(w9(_,_.h),_.h=null))}if(H.G){let R9=K6.g?K6.g.getResponseHeader("X-HTTP-Session-Id"):null;R9&&(H.wa=R9,b(H.J,H.G,R9))}}V.I=3,V.l&&V.l.ra(),V.aa&&(V.T=Date.now()-G.F,V.j.info("Handshake RTT: "+V.T+"ms")),H=V;var E=G;if(H.na=q4(H,H.L?H.ba:null,H.W),E.L){oZ(H.h,E);var f=E,G0=H.O;G0&&(f.H=G0),f.D&&(z9(f),W1(f)),H.g=E}else z4(H);V.i.length>0&&z1(V)}else t[0]!="stop"&&t[0]!="close"||D6(V,7);else V.I==3&&(t[0]=="stop"||t[0]=="close"?t[0]=="stop"?D6(V,7):F9(V):t[0]!="noop"&&V.l&&V.l.qa(t),V.A=0)}}J8(4)}catch(t){}}var WJ=class{constructor(G,$){this.g=G,this.map=$}};function sZ(G){this.l=G||10,U.PerformanceNavigationTiming?(G=U.performance.getEntriesByType("navigation"),G=G.length>0&&(G[0].nextHopProtocol=="hq"||G[0].nextHopProtocol=="h2")):G=!!(U.chrome&&U.chrome.loadTimes&&U.chrome.loadTimes()&&U.chrome.loadTimes().wasFetchedViaSpdy),this.j=G?this.l:1,this.g=null,this.j>1&&(this.g=new Set),this.h=null,this.i=[]}function iZ(G){return G.h?!0:G.g?G.g.size>=G.j:!1}function dZ(G){return G.h?1:G.g?G.g.size:0}function P9(G,$){return G.h?G.h==$:G.g?G.g.has($):!1}function w9(G,$){G.g?G.g.add($):G.h=$}function oZ(G,$){G.h&&G.h==$?G.h=null:G.g&&G.g.has($)&&G.g.delete($)}sZ.prototype.cancel=function(){if(this.i=nZ(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(let G of this.g.values())G.cancel();this.g.clear()}};function nZ(G){if(G.h!=null)return G.i.concat(G.h.G);if(G.g!=null&&G.g.size!==0){let $=G.i;for(let V of G.g.values())$=$.concat(V.G);return $}return T(G.i)}var tZ=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function XJ(G,$){if(G){G=G.split("&");for(let V=0;V<G.length;V++){let H=G[V].indexOf("="),N,_=null;H>=0?(N=G[V].substring(0,H),_=G[V].substring(H+1)):N=G[V],$(N,_?decodeURIComponent(_.replace(/\+/g," ")):"")}}}function e0(G){this.g=this.o=this.j="",this.u=null,this.m=this.h="",this.l=!1;let $;G instanceof e0?(this.l=G.l,U8(this,G.j),this.o=G.o,this.g=G.g,V8(this,G.u),this.h=G.h,B9(this,Z4(G.i)),this.m=G.m):G&&($=String(G).match(tZ))?(this.l=!1,U8(this,$[1]||"",!0),this.o=Y8($[2]||""),this.g=Y8($[3]||"",!0),V8(this,$[4]),this.h=Y8($[5]||"",!0),B9(this,$[6]||"",!0),this.m=Y8($[7]||"")):(this.l=!1,this.i=new H8(null,this.l))}e0.prototype.toString=function(){let G=[];var $=this.j;$&&G.push(z8($,rZ,!0),":");var V=this.g;if(V||$=="file")G.push("//"),($=this.o)&&G.push(z8($,rZ,!0),"@"),G.push(X8(V).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),V=this.u,V!=null&&G.push(":",String(V));if(V=this.h)this.g&&V.charAt(0)!="/"&&G.push("/"),G.push(z8(V,V.charAt(0)=="/"?VJ:UJ,!0));return(V=this.i.toString())&&G.push("?",V),(V=this.m)&&G.push("#",z8(V,zJ)),G.join("")},e0.prototype.resolve=function(G){let $=E0(this),V=!!G.j;V?U8($,G.j):V=!!G.o,V?$.o=G.o:V=!!G.g,V?$.g=G.g:V=G.u!=null;var H=G.h;if(V)V8($,G.u);else if(V=!!G.h){if(H.charAt(0)!="/")if(this.g&&!this.h)H="/"+H;else{var N=$.h.lastIndexOf("/");N!=-1&&(H=$.h.slice(0,N+1)+H)}if(N=H,N==".."||N==".")H="";else if(N.indexOf("./")!=-1||N.indexOf("/.")!=-1){H=N.lastIndexOf("/",0)==0,N=N.split("/");let _=[];for(let E=0;E<N.length;){let f=N[E++];f=="."?H&&E==N.length&&_.push(""):f==".."?((_.length>1||_.length==1&&_[0]!="")&&_.pop(),H&&E==N.length&&_.push("")):(_.push(f),H=!0)}H=_.join("/")}else H=N}return V?$.h=H:V=G.i.toString()!=="",V?B9($,Z4(G.i)):V=!!G.m,V&&($.m=G.m),$};function E0(G){return new e0(G)}function U8(G,$,V){G.j=V?Y8($,!0):$,G.j&&(G.j=G.j.replace(/:$/,""))}function V8(G,$){if($){if($=Number($),isNaN($)||$<0)throw Error("Bad port number "+$);G.u=$}else G.u=null}function B9(G,$,V){$ instanceof H8?(G.i=$,HJ(G.i,G.l)):(V||($=z8($,YJ)),G.i=new H8($,G.l))}function b(G,$,V){G.i.set($,V)}function X1(G){return b(G,"zx",Math.floor(Math.random()*2147483648).toString(36)+Math.abs(Math.floor(Math.random()*2147483648)^Date.now()).toString(36)),G}function Y8(G,$){return G?$?decodeURI(G.replace(/%25/g,"%2525")):decodeURIComponent(G):""}function z8(G,$,V){return typeof G==="string"?(G=encodeURI(G).replace($,$J),V&&(G=G.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),G):null}function $J(G){return G=G.charCodeAt(0),"%"+(G>>4&15).toString(16)+(G&15).toString(16)}var rZ=/[#\/\?@]/g,UJ=/[#\?:]/g,VJ=/[#\?]/g,YJ=/[#\?@]/g,zJ=/#/g;function H8(G,$){this.h=this.g=null,this.i=G||null,this.j=!!$}function F6(G){G.g||(G.g=new Map,G.h=0,G.i&&XJ(G.i,function($,V){G.add(decodeURIComponent($.replace(/\+/g," ")),V)}))}Z=H8.prototype,Z.add=function(G,$){F6(this),this.i=null,G=S6(this,G);let V=this.g.get(G);return V||this.g.set(G,V=[]),V.push($),this.h+=1,this};function bZ(G,$){F6(G),$=S6(G,$),G.g.has($)&&(G.i=null,G.h-=G.g.get($).length,G.g.delete($))}function cZ(G,$){return F6(G),$=S6(G,$),G.g.has($)}Z.forEach=function(G,$){F6(this),this.g.forEach(function(V,H){V.forEach(function(N){G.call($,N,H,this)},this)},this)};function eZ(G,$){F6(G);let V=[];if(typeof $==="string")cZ(G,$)&&(V=V.concat(G.g.get(S6(G,$))));else for(G=Array.from(G.g.values()),$=0;$<G.length;$++)V=V.concat(G[$]);return V}Z.set=function(G,$){return F6(this),this.i=null,G=S6(this,G),cZ(this,G)&&(this.h-=this.g.get(G).length),this.g.set(G,[$]),this.h+=1,this},Z.get=function(G,$){if(!G)return $;return G=eZ(this,G),G.length>0?String(G[0]):$};function aZ(G,$,V){bZ(G,$),V.length>0&&(G.i=null,G.g.set(S6(G,$),T(V)),G.h+=V.length)}Z.toString=function(){if(this.i)return this.i;if(!this.g)return"";let G=[],$=Array.from(this.g.keys());for(let H=0;H<$.length;H++){var V=$[H];let N=X8(V);V=eZ(this,V);for(let _=0;_<V.length;_++){let E=N;V[_]!==""&&(E+="="+X8(V[_])),G.push(E)}}return this.i=G.join("&")};function Z4(G){let $=new H8;return $.i=G.i,G.g&&($.g=new Map(G.g),$.h=G.h),$}function S6(G,$){return $=String($),G.j&&($=$.toLowerCase()),$}function HJ(G,$){$&&!G.j&&(F6(G),G.i=null,G.g.forEach(function(V,H){let N=H.toLowerCase();H!=N&&(bZ(this,H),aZ(this,N,V))},G)),G.j=$}function PJ(G,$){let V=new W8;if(U.Image){let H=new Image;H.onload=F(a0,V,"TestLoadImage: loaded",!0,$,H),H.onerror=F(a0,V,"TestLoadImage: error",!1,$,H),H.onabort=F(a0,V,"TestLoadImage: abort",!1,$,H),H.ontimeout=F(a0,V,"TestLoadImage: timeout",!1,$,H),U.setTimeout(function(){if(H.ontimeout)H.ontimeout()},1e4),H.src=G}else $(!1)}function wJ(G,$){let V=new W8,H=new AbortController,N=setTimeout(()=>{H.abort(),a0(V,"TestPingServer: timeout",!1,$)},1e4);fetch(G,{signal:H.signal}).then((_)=>{clearTimeout(N),_.ok?a0(V,"TestPingServer: ok",!0,$):a0(V,"TestPingServer: server error",!1,$)}).catch(()=>{clearTimeout(N),a0(V,"TestPingServer: error",!1,$)})}function a0(G,$,V,H,N){try{N&&(N.onload=null,N.onerror=null,N.onabort=null,N.ontimeout=null),H(V)}catch(_){}}function BJ(){this.g=new c3}function $1(G){this.i=G.Sb||null,this.h=G.ab||!1}j($1,LZ),$1.prototype.g=function(){return new U1(this.i,this.h)};function U1(G,$){w0.call(this),this.H=G,this.o=$,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.A=new Headers,this.h=null,this.F="GET",this.D="",this.g=!1,this.B=this.j=this.l=null,this.v=new AbortController}j(U1,w0),Z=U1.prototype,Z.open=function(G,$){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.F=G,this.D=$,this.readyState=1,w8(this)},Z.send=function(G){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");if(this.v.signal.aborted)throw this.abort(),Error("Request was aborted.");this.g=!0;let $={headers:this.A,method:this.F,credentials:this.m,cache:void 0,signal:this.v.signal};G&&($.body=G),(this.H||U).fetch(new Request(this.D,$)).then(this.Pa.bind(this),this.ga.bind(this))},Z.abort=function(){this.response=this.responseText="",this.A=new Headers,this.status=0,this.v.abort(),this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),this.readyState>=1&&this.g&&this.readyState!=4&&(this.g=!1,P8(this)),this.readyState=0},Z.Pa=function(G){if(this.g&&(this.l=G,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=G.headers,this.readyState=2,w8(this)),this.g&&(this.readyState=3,w8(this),this.g)))if(this.responseType==="arraybuffer")G.arrayBuffer().then(this.Na.bind(this),this.ga.bind(this));else if(typeof U.ReadableStream<"u"&&"body"in G){if(this.j=G.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.B=new TextDecoder;Q4(this)}else G.text().then(this.Oa.bind(this),this.ga.bind(this))};function Q4(G){G.j.read().then(G.Ma.bind(G)).catch(G.ga.bind(G))}Z.Ma=function(G){if(this.g){if(this.o&&G.value)this.response.push(G.value);else if(!this.o){var $=G.value?G.value:new Uint8Array(0);if($=this.B.decode($,{stream:!G.done}))this.response=this.responseText+=$}G.done?P8(this):w8(this),this.readyState==3&&Q4(this)}},Z.Oa=function(G){this.g&&(this.response=this.responseText=G,P8(this))},Z.Na=function(G){this.g&&(this.response=G,P8(this))},Z.ga=function(){this.g&&P8(this)};function P8(G){G.readyState=4,G.l=null,G.j=null,G.B=null,w8(G)}Z.setRequestHeader=function(G,$){this.A.append(G,$)},Z.getResponseHeader=function(G){return this.h?this.h.get(G.toLowerCase())||"":""},Z.getAllResponseHeaders=function(){if(!this.h)return"";let G=[],$=this.h.entries();for(var V=$.next();!V.done;)V=V.value,G.push(V[0]+": "+V[1]),V=$.next();return G.join(`\r
`)};function w8(G){G.onreadystatechange&&G.onreadystatechange.call(G)}Object.defineProperty(U1.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(G){this.m=G?"include":"same-origin"}});function K4(G){let $="";return Z1(G,function(V,H){$+=H,$+=":",$+=V,$+=`\r
`}),$}function q9(G,$,V){Z:{for(H in V){var H=!1;break Z}H=!0}H||(V=K4(V),typeof G==="string"?V!=null&&X8(V):b(G,$,V))}function Z0(G){w0.call(this),this.headers=new Map,this.L=G||null,this.h=!1,this.g=null,this.D="",this.o=0,this.l="",this.j=this.B=this.v=this.A=!1,this.m=null,this.F="",this.H=!1}j(Z0,w0);var qJ=/^https?$/i,FJ=["POST","PUT"];Z=Z0.prototype,Z.Fa=function(G){this.H=G},Z.ea=function(G,$,V,H){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+G);$=$?$.toUpperCase():"GET",this.D=G,this.l="",this.o=0,this.A=!1,this.h=!0,this.g=this.L?this.L.g():mZ.g(),this.g.onreadystatechange=I(P(this.Ca,this));try{this.B=!0,this.g.open($,String(G),!0),this.B=!1}catch(_){J4(this,_);return}if(G=V||"",V=new Map(this.headers),H)if(Object.getPrototypeOf(H)===Object.prototype)for(var N in H)V.set(N,H[N]);else if(typeof H.keys==="function"&&typeof H.get==="function")for(let _ of H.keys())V.set(_,H.get(_));else throw Error("Unknown input type for opt_headers: "+String(H));H=Array.from(V.keys()).find((_)=>_.toLowerCase()=="content-type"),N=U.FormData&&G instanceof U.FormData,!(Array.prototype.indexOf.call(FJ,$,void 0)>=0)||H||N||V.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(let[_,E]of V)this.g.setRequestHeader(_,E);this.F&&(this.g.responseType=this.F),"withCredentials"in this.g&&this.g.withCredentials!==this.H&&(this.g.withCredentials=this.H);try{this.m&&(clearTimeout(this.m),this.m=null),this.v=!0,this.g.send(G),this.v=!1}catch(_){J4(this,_)}};function J4(G,$){G.h=!1,G.g&&(G.j=!0,G.g.abort(),G.j=!1),G.l=$,G.o=5,G4(G),V1(G)}function G4(G){G.A||(G.A=!0,D0(G,"complete"),D0(G,"error"))}Z.abort=function(G){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.o=G||7,D0(this,"complete"),D0(this,"abort"),V1(this))},Z.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),V1(this,!0)),Z0.Z.N.call(this)},Z.Ca=function(){this.u||(this.B||this.v||this.j?W4(this):this.Xa())},Z.Xa=function(){W4(this)};function W4(G){if(G.h&&typeof X<"u"){if(G.v&&Z6(G)==4)setTimeout(G.Ca.bind(G),0);else if(D0(G,"readystatechange"),Z6(G)==4){G.h=!1;try{let _=G.ca();Z:switch(_){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var $=!0;break Z;default:$=!1}var V;if(!(V=$)){var H;if(H=_===0){let E=String(G.D).match(tZ)[1]||null;!E&&U.self&&U.self.location&&(E=U.self.location.protocol.slice(0,-1)),H=!qJ.test(E?E.toLowerCase():"")}V=H}if(V)D0(G,"complete"),D0(G,"success");else{G.o=6;try{var N=Z6(G)>2?G.g.statusText:""}catch(E){N=""}G.l=N+" ["+G.ca()+"]",G4(G)}}finally{V1(G)}}}}function V1(G,$){if(G.g){G.m&&(clearTimeout(G.m),G.m=null);let V=G.g;G.g=null,$||D0(G,"ready");try{V.onreadystatechange=null}catch(H){}}}Z.isActive=function(){return!!this.g};function Z6(G){return G.g?G.g.readyState:0}Z.ca=function(){try{return Z6(this)>2?this.g.status:-1}catch(G){return-1}},Z.la=function(){try{return this.g?this.g.responseText:""}catch(G){return""}},Z.La=function(G){if(this.g){var $=this.g.responseText;return G&&$.indexOf(G)==0&&($=$.substring(G.length)),b3($)}};function X4(G){try{if(!G.g)return null;if("response"in G.g)return G.g.response;switch(G.F){case"":case"text":return G.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in G.g)return G.g.mozResponseArrayBuffer}return null}catch($){return null}}function DJ(G){let $={};G=(G.g&&Z6(G)>=2?G.g.getAllResponseHeaders()||"":"").split(`\r
`);for(let H=0;H<G.length;H++){if(B(G[H]))continue;var V=KJ(G[H]);let N=V[0];if(V=V[1],typeof V!=="string")continue;V=V.trim();let _=$[N]||[];$[N]=_,_.push(V)}o3($,function(H){return H.join(", ")})}Z.ya=function(){return this.o},Z.Ha=function(){return typeof this.l==="string"?this.l:String(this.l)};function B8(G,$,V){return V&&V.internalChannelParams?V.internalChannelParams[G]||$:$}function $4(G){this.za=0,this.i=[],this.j=new W8,this.ba=this.na=this.J=this.W=this.g=this.wa=this.G=this.H=this.u=this.U=this.o=null,this.Ya=this.V=0,this.Sa=B8("failFast",!1,G),this.F=this.C=this.v=this.m=this.l=null,this.X=!0,this.xa=this.K=-1,this.Y=this.A=this.D=0,this.Qa=B8("baseRetryDelayMs",5000,G),this.Za=B8("retryDelaySeedMs",1e4,G),this.Ta=B8("forwardChannelMaxRetries",2,G),this.va=B8("forwardChannelRequestTimeoutMs",20000,G),this.ma=G&&G.xmlHttpFactory||void 0,this.Ua=G&&G.Rb||void 0,this.Aa=G&&G.useFetchStreams||!1,this.O=void 0,this.L=G&&G.supportsCrossDomainXhr||!1,this.M="",this.h=new sZ(G&&G.concurrentRequestLimit),this.Ba=new BJ,this.S=G&&G.fastHandshake||!1,this.R=G&&G.encodeInitMessageHeaders||!1,this.S&&this.R&&(this.R=!1),this.Ra=G&&G.Pb||!1,G&&G.ua&&this.j.ua(),G&&G.forceLongPolling&&(this.X=!1),this.aa=!this.S&&this.X&&G&&G.detectBufferingProxy||!1,this.ia=void 0,G&&G.longPollingTimeout&&G.longPollingTimeout>0&&(this.ia=G.longPollingTimeout),this.ta=void 0,this.T=0,this.P=!1,this.ja=this.B=null}Z=$4.prototype,Z.ka=8,Z.I=1,Z.connect=function(G,$,V,H){M0(0),this.W=G,this.H=$||{},V&&H!==void 0&&(this.H.OSID=V,this.H.OAID=H),this.F=this.X,this.J=q4(this,null,this.W),z1(this)};function F9(G){if(U4(G),G.I==3){var $=G.V++,V=E0(G.J);if(b(V,"SID",G.M),b(V,"RID",$),b(V,"TYPE","terminate"),q8(G,V),$=new c0(G,G.j,$),$.M=2,$.A=X1(E0(V)),V=!1,U.navigator&&U.navigator.sendBeacon)try{V=U.navigator.sendBeacon($.A.toString(),"")}catch(H){}!V&&U.Image&&(new Image().src=$.A,V=!0),V||($.g=F4($.j,null),$.g.ea($.A)),$.F=Date.now(),W1($)}B4(G)}function Y1(G){G.g&&(M9(G),G.g.cancel(),G.g=null)}function U4(G){Y1(G),G.v&&(U.clearTimeout(G.v),G.v=null),H1(G),G.h.cancel(),G.m&&(typeof G.m==="number"&&U.clearTimeout(G.m),G.m=null)}function z1(G){if(!iZ(G.h)&&!G.m){G.m=!0;var $=G.Ea;O0||w(),P0||(O0(),P0=!0),M.add($,G),G.D=0}}function MJ(G,$){if(dZ(G.h)>=G.h.j-(G.m?1:0))return!1;if(G.m)return G.i=$.G.concat(G.i),!0;if(G.I==1||G.I==2||G.D>=(G.Sa?0:G.Ta))return!1;return G.m=G8(P(G.Ea,G,$),w4(G,G.D)),G.D++,!0}Z.Ea=function(G){if(this.m)if(this.m=null,this.I==1){if(!G){this.V=Math.floor(Math.random()*1e5),G=this.V++;let N=new c0(this,this.j,G),_=this.o;if(this.U&&(_?(_=DZ(_),RZ(_,this.U)):_=this.U),this.u!==null||this.R||(N.J=_,_=null),this.S)Z:{var $=0;for(var V=0;V<this.i.length;V++){Q:{var H=this.i[V];if("__data__"in H.map&&(H=H.map.__data__,typeof H==="string")){H=H.length;break Q}H=void 0}if(H===void 0)break;if($+=H,$>4096){$=V;break Z}if($===4096||V===this.i.length-1){$=V+1;break Z}}$=1000}else $=1000;$=Y4(this,N,$),V=E0(this.J),b(V,"RID",G),b(V,"CVER",22),this.G&&b(V,"X-HTTP-Session-Id",this.G),q8(this,V),_&&(this.R?$="headers="+X8(K4(_))+"&"+$:this.u&&q9(V,this.u,_)),w9(this.h,N),this.Ra&&b(V,"TYPE","init"),this.S?(b(V,"$req",$),b(V,"SID","null"),N.U=!0,Y9(N,V,null)):Y9(N,V,$),this.I=2}}else this.I==3&&(G?V4(this,G):this.i.length==0||iZ(this.h)||V4(this))};function V4(G,$){var V;$?V=$.l:V=G.V++;let H=E0(G.J);b(H,"SID",G.M),b(H,"RID",V),b(H,"AID",G.K),q8(G,H),G.u&&G.o&&q9(H,G.u,G.o),V=new c0(G,G.j,V,G.D+1),G.u===null&&(V.J=G.o),$&&(G.i=$.G.concat(G.i)),$=Y4(G,V,1000),V.H=Math.round(G.va*0.5)+Math.round(G.va*0.5*Math.random()),w9(G.h,V),Y9(V,H,$)}function q8(G,$){G.H&&Z1(G.H,function(V,H){b($,H,V)}),G.l&&Z1({},function(V,H){b($,H,V)})}function Y4(G,$,V){V=Math.min(G.i.length,V);let H=G.l?P(G.l.Ka,G.l,G):null;Z:{var N=G.i;let f=-1;for(;;){let G0=["count="+V];f==-1?V>0?(f=N[0].g,G0.push("ofs="+f)):f=0:G0.push("ofs="+f);let t=!0;for(let U0=0;U0<V;U0++){var _=N[U0].g;let L0=N[U0].map;if(_-=f,_<0)f=Math.max(0,N[U0].g-100),t=!1;else try{_="req"+_+"_"||"";try{var E=L0 instanceof Map?L0:Object.entries(L0);for(let[M6,Q6]of E){let K6=Q6;Y(Q6)&&(K6=W9(Q6)),G0.push(_+M6+"="+encodeURIComponent(K6))}}catch(M6){throw G0.push(_+"type="+encodeURIComponent("_badmap")),M6}}catch(M6){H&&H(L0)}}if(t){E=G0.join("&");break Z}}E=void 0}return G=G.i.splice(0,V),$.G=G,E}function z4(G){if(!G.g&&!G.v){G.Y=1;var $=G.Da;O0||w(),P0||(O0(),P0=!0),M.add($,G),G.A=0}}function D9(G){if(G.g||G.v||G.A>=3)return!1;return G.Y++,G.v=G8(P(G.Da,G),w4(G,G.A)),G.A++,!0}Z.Da=function(){if(this.v=null,H4(this),this.aa&&!(this.P||this.g==null||this.T<=0)){var G=4*this.T;this.j.info("BP detection timer enabled: "+G),this.B=G8(P(this.Wa,this),G)}},Z.Wa=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.P=!0,M0(10),Y1(this),H4(this))};function M9(G){G.B!=null&&(U.clearTimeout(G.B),G.B=null)}function H4(G){G.g=new c0(G,G.j,"rpc",G.Y),G.u===null&&(G.g.J=G.o),G.g.P=0;var $=E0(G.na);b($,"RID","rpc"),b($,"SID",G.M),b($,"AID",G.K),b($,"CI",G.F?"0":"1"),!G.F&&G.ia&&b($,"TO",G.ia),b($,"TYPE","xmlhttp"),q8(G,$),G.u&&G.o&&q9($,G.u,G.o),G.O&&(G.g.H=G.O);var V=G.g;G=G.ba,V.M=1,V.A=X1(E0($)),V.u=null,V.R=!0,gZ(V,G)}Z.Va=function(){this.C!=null&&(this.C=null,Y1(this),D9(this),M0(19))};function H1(G){G.C!=null&&(U.clearTimeout(G.C),G.C=null)}function P4(G,$){var V=null;if(G.g==$){H1(G),M9(G),G.g=null;var H=2}else if(P9(G.h,$))V=$.G,oZ(G.h,$),H=1;else return;if(G.I!=0){if($.o)if(H==1){V=$.u?$.u.length:0,$=Date.now()-$.F;var N=G.D;H=J1(),D0(H,new hZ(H,V)),z1(G)}else z4(G);else if(N=$.m,N==3||N==0&&$.X>0||!(H==1&&MJ(G,$)||H==2&&D9(G)))switch(V&&V.length>0&&($=G.h,$.i=$.i.concat(V)),N){case 1:D6(G,5);break;case 4:D6(G,10);break;case 3:D6(G,6);break;default:D6(G,2)}}}function w4(G,$){let V=G.Qa+Math.floor(Math.random()*G.Za);return G.isActive()||(V*=2),V*$}function D6(G,$){if(G.j.info("Error code "+$),$==2){var V=P(G.bb,G),H=G.Ua;let N=!H;H=new e0(H||"//www.google.com/images/cleardot.gif"),U.location&&U.location.protocol=="http"||U8(H,"https"),X1(H),N?PJ(H.toString(),V):wJ(H.toString(),V)}else M0(2);G.I=0,G.l&&G.l.pa($),B4(G),U4(G)}Z.bb=function(G){G?(this.j.info("Successfully pinged google.com"),M0(2)):(this.j.info("Failed to ping google.com"),M0(1))};function B4(G){if(G.I=0,G.ja=[],G.l){let $=nZ(G.h);if($.length!=0||G.i.length!=0)C(G.ja,$),C(G.ja,G.i),G.h.i.length=0,T(G.i),G.i.length=0;G.l.oa()}}function q4(G,$,V){var H=V instanceof e0?E0(V):new e0(V);if(H.g!="")$&&(H.g=$+"."+H.g),V8(H,H.u);else{var N=U.location;H=N.protocol,$=$?$+"."+N.hostname:N.hostname,N=+N.port;let _=new e0(null);H&&U8(_,H),$&&(_.g=$),N&&V8(_,N),V&&(_.h=V),H=_}return V=G.G,$=G.wa,V&&$&&b(H,V,$),b(H,"VER",G.ka),q8(G,H),H}function F4(G,$,V){if($&&!G.L)throw Error("Can't create secondary domain capable XhrIo object.");return $=G.Aa&&!G.ma?new Z0(new $1({ab:V})):new Z0(G.ma),$.Fa(G.L),$}Z.isActive=function(){return!!this.l&&this.l.isActive(this)};function D4(){}Z=D4.prototype,Z.ra=function(){},Z.qa=function(){},Z.pa=function(){},Z.oa=function(){},Z.isActive=function(){return!0},Z.Ka=function(){};function P1(){}P1.prototype.g=function(G,$){return new j0(G,$)};function j0(G,$){w0.call(this),this.g=new $4($),this.l=G,this.h=$&&$.messageUrlParams||null,G=$&&$.messageHeaders||null,$&&$.clientProtocolHeaderRequired&&(G?G["X-Client-Protocol"]="webchannel":G={"X-Client-Protocol":"webchannel"}),this.g.o=G,G=$&&$.initMessageHeaders||null,$&&$.messageContentType&&(G?G["X-WebChannel-Content-Type"]=$.messageContentType:G={"X-WebChannel-Content-Type":$.messageContentType}),$&&$.sa&&(G?G["X-WebChannel-Client-Profile"]=$.sa:G={"X-WebChannel-Client-Profile":$.sa}),this.g.U=G,(G=$&&$.Qb)&&!B(G)&&(this.g.u=G),this.A=$&&$.supportsCrossDomainXhr||!1,this.v=$&&$.sendRawJson||!1,($=$&&$.httpSessionIdParam)&&!B($)&&(this.g.G=$,G=this.h,G!==null&&($ in G)&&(G=this.h,($ in G)&&delete G[$])),this.j=new T6(this)}j(j0,w0),j0.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.L=!0),this.g.connect(this.l,this.h||void 0)},j0.prototype.close=function(){F9(this.g)},j0.prototype.o=function(G){var $=this.g;if(typeof G==="string"){var V={};V.__data__=G,G=V}else this.v&&(V={},V.__data__=W9(G),G=V);$.i.push(new WJ($.Ya++,G)),$.I==3&&z1($)},j0.prototype.N=function(){this.g.l=null,delete this.j,F9(this.g),delete this.g,j0.Z.N.call(this)};function M4(G){X9.call(this),G.__headers__&&(this.headers=G.__headers__,this.statusCode=G.__status__,delete G.__headers__,delete G.__status__);var $=G.__sm__;if($){Z:{for(let V in $){G=V;break Z}G=void 0}if(this.i=G)G=this.i,$=$!==null&&G in $?$[G]:void 0;this.data=$}else this.data=G}j(M4,X9);function R4(){$9.call(this),this.status=1}j(R4,$9);function T6(G){this.g=G}j(T6,D4),T6.prototype.ra=function(){D0(this.g,"a")},T6.prototype.qa=function(G){D0(this.g,new M4(G))},T6.prototype.pa=function(G){D0(this.g,new R4)},T6.prototype.oa=function(){D0(this.g,"b")},P1.prototype.createWebChannel=P1.prototype.g,j0.prototype.send=j0.prototype.o,j0.prototype.open=j0.prototype.m,j0.prototype.close=j0.prototype.close,s9=s0.createWebChannelTransport=function(){return new P1},l9=s0.getStatEventTarget=function(){return J1()},p9=s0.Event=B6,R1=s0.Stat={jb:0,mb:1,nb:2,Hb:3,Mb:4,Jb:5,Kb:6,Ib:7,Gb:8,Lb:9,PROXY:10,NOPROXY:11,Eb:12,Ab:13,Bb:14,zb:15,Cb:16,Db:17,fb:18,eb:19,gb:20},G1.NO_ERROR=0,G1.TIMEOUT=8,G1.HTTP_ERROR=6,I8=s0.ErrorCode=G1,vZ.COMPLETE="complete",g9=s0.EventType=vZ,xZ.EventType=K8,K8.OPEN="a",K8.CLOSE="b",K8.ERROR="c",K8.MESSAGE="d",w0.prototype.listen=w0.prototype.J,L6=s0.WebChannel=xZ,hG=s0.FetchXmlHttpFactory=$1,Z0.prototype.listenOnce=Z0.prototype.K,Z0.prototype.getLastError=Z0.prototype.Ha,Z0.prototype.getLastErrorCode=Z0.prototype.ya,Z0.prototype.getStatus=Z0.prototype.ca,Z0.prototype.getResponseJson=Z0.prototype.La,Z0.prototype.getResponseText=Z0.prototype.la,Z0.prototype.send=Z0.prototype.ea,Z0.prototype.setWithCredentials=Z0.prototype.Fa,f9=s0.XhrIo=Z0}).apply(typeof M1<"u"?M1:typeof self<"u"?self:typeof window<"u"?window:{});var UQ="@firebase/firestore",VQ="4.9.3";class V0{constructor(Z){this.uid=Z}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(Z){return Z.uid===this.uid}}V0.UNAUTHENTICATED=new V0(null),V0.GOOGLE_CREDENTIALS=new V0("google-credentials-uid"),V0.FIRST_PARTY=new V0("first-party-uid"),V0.MOCK_USER=new V0("mock-user");var b6="12.7.0",I6=new M8("@firebase/firestore");function x6(){return I6.logLevel}function y(Z,...Q){if(I6.logLevel<=l.DEBUG){let K=Q.map(M7);I6.debug(`Firestore (${b6}): ${Z}`,...K)}}function d0(Z,...Q){if(I6.logLevel<=l.ERROR){let K=Q.map(M7);I6.error(`Firestore (${b6}): ${Z}`,...K)}}function f6(Z,...Q){if(I6.logLevel<=l.WARN){let K=Q.map(M7);I6.warn(`Firestore (${b6}): ${Z}`,...K)}}function M7(Z){if(typeof Z=="string")return Z;try{return function(K){return JSON.stringify(K)}(Z)}catch(Q){return Z}}function v(Z,Q,K){let J="Unexpected state";typeof Q=="string"?J=Q:K=Q,eQ(Z,J,K)}function eQ(Z,Q,K){let J=`FIRESTORE (${b6}) INTERNAL ASSERTION FAILED: ${Q} (ID: ${Z.toString(16)})`;if(K!==void 0)try{J+=" CONTEXT: "+JSON.stringify(K)}catch(W){J+=" CONTEXT: "+K}throw d0(J),Error(J)}function o(Z,Q,K,J){let W="Unexpected state";typeof K=="string"?W=K:J=K,Z||eQ(Q,W,J)}function u(Z,Q){return Z}var A={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class L extends g0{constructor(Z,Q){super(Z,Q),this.code=Z,this.message=Q,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class i0{constructor(){this.promise=new Promise((Z,Q)=>{this.resolve=Z,this.reject=Q})}}class R7{constructor(Z,Q){this.user=Q,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${Z}`)}}class aQ{getToken(){return Promise.resolve(null)}invalidateToken(){}start(Z,Q){Z.enqueueRetryable(()=>Q(V0.UNAUTHENTICATED))}shutdown(){}}class Z5{constructor(Z){this.token=Z,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(Z,Q){this.changeListener=Q,Z.enqueueRetryable(()=>Q(this.token.user))}shutdown(){this.changeListener=null}}class Q5{constructor(Z){this.t=Z,this.currentUser=V0.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(Z,Q){o(this.o===void 0,42304);let K=this.i,J=(Y)=>this.i!==K?(K=this.i,Q(Y)):Promise.resolve(),W=new i0;this.o=()=>{this.i++,this.currentUser=this.u(),W.resolve(),W=new i0,Z.enqueueRetryable(()=>J(this.currentUser))};let X=()=>{let Y=W;Z.enqueueRetryable(async()=>{await Y.promise,await J(this.currentUser)})},U=(Y)=>{y("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=Y,this.o&&(this.auth.addAuthTokenListener(this.o),X())};this.t.onInit((Y)=>U(Y)),setTimeout(()=>{if(!this.auth){let Y=this.t.getImmediate({optional:!0});Y?U(Y):(y("FirebaseAuthCredentialsProvider","Auth not yet detected"),W.resolve(),W=new i0)}},0),X()}getToken(){let Z=this.i,Q=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(Q).then((K)=>this.i!==Z?(y("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):K?(o(typeof K.accessToken=="string",31837,{l:K}),new R7(K.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){let Z=this.auth&&this.auth.getUid();return o(Z===null||typeof Z=="string",2055,{h:Z}),new V0(Z)}}class K5{constructor(Z,Q,K){this.P=Z,this.T=Q,this.I=K,this.type="FirstParty",this.user=V0.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);let Z=this.R();return Z&&this.A.set("Authorization",Z),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class J5{constructor(Z,Q,K){this.P=Z,this.T=Q,this.I=K}getToken(){return Promise.resolve(new K5(this.P,this.T,this.I))}start(Z,Q){Z.enqueueRetryable(()=>Q(V0.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class r9{constructor(Z){this.value=Z,this.type="AppCheck",this.headers=new Map,Z&&Z.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class G5{constructor(Z,Q){this.V=Q,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,e4(Z)&&Z.settings.appCheckToken&&(this.p=Z.settings.appCheckToken)}start(Z,Q){o(this.o===void 0,3512);let K=(W)=>{W.error!=null&&y("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${W.error.message}`);let X=W.token!==this.m;return this.m=W.token,y("FirebaseAppCheckTokenProvider",`Received ${X?"new":"existing"} token.`),X?Q(W.token):Promise.resolve()};this.o=(W)=>{Z.enqueueRetryable(()=>K(W))};let J=(W)=>{y("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=W,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit((W)=>J(W)),setTimeout(()=>{if(!this.appCheck){let W=this.V.getImmediate({optional:!0});W?J(W):y("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.p)return Promise.resolve(new r9(this.p));let Z=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(Z).then((Q)=>Q?(o(typeof Q.token=="string",44558,{tokenResult:Q}),this.m=Q.token,new r9(Q.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}function vG(Z){let Q=typeof self<"u"&&(self.crypto||self.msCrypto),K=new Uint8Array(Z);if(Q&&typeof Q.getRandomValues=="function")Q.getRandomValues(K);else for(let J=0;J<Z;J++)K[J]=Math.floor(256*Math.random());return K}class k1{static newId(){let Q=62*Math.floor(4.129032258064516),K="";for(;K.length<20;){let J=vG(40);for(let W=0;W<J.length;++W)K.length<20&&J[W]<Q&&(K+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(J[W]%62))}return K}}function g(Z,Q){return Z<Q?-1:Z>Q?1:0}function b9(Z,Q){let K=Math.min(Z.length,Q.length);for(let J=0;J<K;J++){let W=Z.charAt(J),X=Q.charAt(J);if(W!==X)return i9(W)===i9(X)?g(W,X):i9(W)?1:-1}return g(Z.length,Q.length)}var mG=55296,uG=57343;function i9(Z){let Q=Z.charCodeAt(0);return Q>=mG&&Q<=uG}function g6(Z,Q,K){return Z.length===Q.length&&Z.every((J,W)=>K(J,Q[W]))}var YQ="__name__";class C0{constructor(Z,Q,K){Q===void 0?Q=0:Q>Z.length&&v(637,{offset:Q,range:Z.length}),K===void 0?K=Z.length-Q:K>Z.length-Q&&v(1746,{length:K,range:Z.length-Q}),this.segments=Z,this.offset=Q,this.len=K}get length(){return this.len}isEqual(Z){return C0.comparator(this,Z)===0}child(Z){let Q=this.segments.slice(this.offset,this.limit());return Z instanceof C0?Z.forEach((K)=>{Q.push(K)}):Q.push(Z),this.construct(Q)}limit(){return this.offset+this.length}popFirst(Z){return Z=Z===void 0?1:Z,this.construct(this.segments,this.offset+Z,this.length-Z)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(Z){return this.segments[this.offset+Z]}isEmpty(){return this.length===0}isPrefixOf(Z){if(Z.length<this.length)return!1;for(let Q=0;Q<this.length;Q++)if(this.get(Q)!==Z.get(Q))return!1;return!0}isImmediateParentOf(Z){if(this.length+1!==Z.length)return!1;for(let Q=0;Q<this.length;Q++)if(this.get(Q)!==Z.get(Q))return!1;return!0}forEach(Z){for(let Q=this.offset,K=this.limit();Q<K;Q++)Z(this.segments[Q])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(Z,Q){let K=Math.min(Z.length,Q.length);for(let J=0;J<K;J++){let W=C0.compareSegments(Z.get(J),Q.get(J));if(W!==0)return W}return g(Z.length,Q.length)}static compareSegments(Z,Q){let K=C0.isNumericId(Z),J=C0.isNumericId(Q);return K&&!J?-1:!K&&J?1:K&&J?C0.extractNumericId(Z).compare(C0.extractNumericId(Q)):b9(Z,Q)}static isNumericId(Z){return Z.startsWith("__id")&&Z.endsWith("__")}static extractNumericId(Z){return l0.fromString(Z.substring(4,Z.length-2))}}class r extends C0{construct(Z,Q,K){return new r(Z,Q,K)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...Z){let Q=[];for(let K of Z){if(K.indexOf("//")>=0)throw new L(A.INVALID_ARGUMENT,`Invalid segment (${K}). Paths must not contain // in them.`);Q.push(...K.split("/").filter((J)=>J.length>0))}return new r(Q)}static emptyPath(){return new r([])}}var fG=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class z0 extends C0{construct(Z,Q,K){return new z0(Z,Q,K)}static isValidIdentifier(Z){return fG.test(Z)}canonicalString(){return this.toArray().map((Z)=>(Z=Z.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),z0.isValidIdentifier(Z)||(Z="`"+Z+"`"),Z)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===YQ}static keyField(){return new z0([YQ])}static fromServerFormat(Z){let Q=[],K="",J=0,W=()=>{if(K.length===0)throw new L(A.INVALID_ARGUMENT,`Invalid field path (${Z}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);Q.push(K),K=""},X=!1;for(;J<Z.length;){let U=Z[J];if(U==="\\"){if(J+1===Z.length)throw new L(A.INVALID_ARGUMENT,"Path has trailing escape character: "+Z);let Y=Z[J+1];if(Y!=="\\"&&Y!=="."&&Y!=="`")throw new L(A.INVALID_ARGUMENT,"Path has invalid escape sequence: "+Z);K+=Y,J+=2}else U==="`"?(X=!X,J++):U!=="."||X?(K+=U,J++):(W(),J++)}if(W(),X)throw new L(A.INVALID_ARGUMENT,"Unterminated ` in path: "+Z);return new z0(Q)}static emptyPath(){return new z0([])}}class h{constructor(Z){this.path=Z}static fromPath(Z){return new h(r.fromString(Z))}static fromName(Z){return new h(r.fromString(Z).popFirst(5))}static empty(){return new h(r.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(Z){return this.path.length>=2&&this.path.get(this.path.length-2)===Z}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(Z){return Z!==null&&r.comparator(this.path,Z.path)===0}toString(){return this.path.toString()}static comparator(Z,Q){return r.comparator(Z.path,Q.path)}static isDocumentKey(Z){return Z.length%2==0}static fromSegments(Z){return new h(new r(Z.slice()))}}function W5(Z,Q,K){if(!K)throw new L(A.INVALID_ARGUMENT,`Function ${Z}() cannot be called with an empty ${Q}.`)}function gG(Z,Q,K,J){if(Q===!0&&J===!0)throw new L(A.INVALID_ARGUMENT,`${Z} and ${K} cannot be used together.`)}function zQ(Z){if(!h.isDocumentKey(Z))throw new L(A.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${Z} has ${Z.length}.`)}function HQ(Z){if(h.isDocumentKey(Z))throw new L(A.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${Z} has ${Z.length}.`)}function X5(Z){return typeof Z=="object"&&Z!==null&&(Object.getPrototypeOf(Z)===Object.prototype||Object.getPrototypeOf(Z)===null)}function h1(Z){if(Z===void 0)return"undefined";if(Z===null)return"null";if(typeof Z=="string")return Z.length>20&&(Z=`${Z.substring(0,20)}...`),JSON.stringify(Z);if(typeof Z=="number"||typeof Z=="boolean")return""+Z;if(typeof Z=="object"){if(Z instanceof Array)return"an array";{let Q=function(J){if(J.constructor)return J.constructor.name;return null}(Z);return Q?`a custom ${Q} object`:"an object"}}return typeof Z=="function"?"a function":v(12329,{type:typeof Z})}function p6(Z,Q){if("_delegate"in Z&&(Z=Z._delegate),!(Z instanceof Q)){if(Q.name===Z.constructor.name)throw new L(A.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{let K=h1(Z);throw new L(A.INVALID_ARGUMENT,`Expected type '${Q.name}', but it was: ${K}`)}}return Z}function pG(Z,Q){if(Q<=0)throw new L(A.INVALID_ARGUMENT,`Function ${Z}() requires a positive number, but it was: ${Q}.`)}function J0(Z,Q){let K={typeString:Z};return Q&&(K.value=Q),K}function p8(Z,Q){if(!X5(Z))throw new L(A.INVALID_ARGUMENT,"JSON must be an object");let K;for(let J in Q)if(Q[J]){let W=Q[J].typeString,X="value"in Q[J]?{value:Q[J].value}:void 0;if(!(J in Z)){K=`JSON missing required field: '${J}'`;break}let U=Z[J];if(W&&typeof U!==W){K=`JSON field '${J}' must be a ${W}.`;break}if(X!==void 0&&U!==X.value){K=`Expected '${J}' field to equal '${X.value}'`;break}}if(K)throw new L(A.INVALID_ARGUMENT,K);return!0}var PQ=-62135596800,wQ=1e6;class c{static now(){return c.fromMillis(Date.now())}static fromDate(Z){return c.fromMillis(Z.getTime())}static fromMillis(Z){let Q=Math.floor(Z/1000),K=Math.floor((Z-1000*Q)*wQ);return new c(Q,K)}constructor(Z,Q){if(this.seconds=Z,this.nanoseconds=Q,Q<0)throw new L(A.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+Q);if(Q>=1e9)throw new L(A.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+Q);if(Z<PQ)throw new L(A.INVALID_ARGUMENT,"Timestamp seconds out of range: "+Z);if(Z>=253402300800)throw new L(A.INVALID_ARGUMENT,"Timestamp seconds out of range: "+Z)}toDate(){return new Date(this.toMillis())}toMillis(){return 1000*this.seconds+this.nanoseconds/wQ}_compareTo(Z){return this.seconds===Z.seconds?g(this.nanoseconds,Z.nanoseconds):g(this.seconds,Z.seconds)}isEqual(Z){return Z.seconds===this.seconds&&Z.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:c._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(Z){if(p8(Z,c._jsonSchema))return new c(Z.seconds,Z.nanoseconds)}valueOf(){let Z=this.seconds-PQ;return String(Z).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}c._jsonSchemaVersion="firestore/timestamp/1.0",c._jsonSchema={type:J0("string",c._jsonSchemaVersion),seconds:J0("number"),nanoseconds:J0("number")};class m{static fromTimestamp(Z){return new m(Z)}static min(){return new m(new c(0,0))}static max(){return new m(new c(253402300799,999999999))}constructor(Z){this.timestamp=Z}compareTo(Z){return this.timestamp._compareTo(Z.timestamp)}isEqual(Z){return this.timestamp.isEqual(Z.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1000}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}var y8=-1;class $5{constructor(Z,Q,K,J){this.indexId=Z,this.collectionGroup=Q,this.fields=K,this.indexState=J}}$5.UNKNOWN_ID=-1;function lG(Z,Q){let K=Z.toTimestamp().seconds,J=Z.toTimestamp().nanoseconds+1,W=m.fromTimestamp(J===1e9?new c(K+1,0):new c(K,J));return new U6(W,h.empty(),Q)}function sG(Z){return new U6(Z.readTime,Z.key,y8)}class U6{constructor(Z,Q,K){this.readTime=Z,this.documentKey=Q,this.largestBatchId=K}static min(){return new U6(m.min(),h.empty(),y8)}static max(){return new U6(m.max(),h.empty(),y8)}}function iG(Z,Q){let K=Z.readTime.compareTo(Q.readTime);return K!==0?K:(K=h.comparator(Z.documentKey,Q.documentKey),K!==0?K:g(Z.largestBatchId,Q.largestBatchId))}var dG="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class U5{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(Z){this.onCommittedListeners.push(Z)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((Z)=>Z())}}async function c6(Z){if(Z.code!==A.FAILED_PRECONDITION||Z.message!==dG)throw Z;y("LocalStore","Unexpectedly lost primary lease")}class S{constructor(Z){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,Z((Q)=>{this.isDone=!0,this.result=Q,this.nextCallback&&this.nextCallback(Q)},(Q)=>{this.isDone=!0,this.error=Q,this.catchCallback&&this.catchCallback(Q)})}catch(Z){return this.next(void 0,Z)}next(Z,Q){return this.callbackAttached&&v(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(Q,this.error):this.wrapSuccess(Z,this.result):new S((K,J)=>{this.nextCallback=(W)=>{this.wrapSuccess(Z,W).next(K,J)},this.catchCallback=(W)=>{this.wrapFailure(Q,W).next(K,J)}})}toPromise(){return new Promise((Z,Q)=>{this.next(Z,Q)})}wrapUserFunction(Z){try{let Q=Z();return Q instanceof S?Q:S.resolve(Q)}catch(Q){return S.reject(Q)}}wrapSuccess(Z,Q){return Z?this.wrapUserFunction(()=>Z(Q)):S.resolve(Q)}wrapFailure(Z,Q){return Z?this.wrapUserFunction(()=>Z(Q)):S.reject(Q)}static resolve(Z){return new S((Q,K)=>{Q(Z)})}static reject(Z){return new S((Q,K)=>{K(Z)})}static waitFor(Z){return new S((Q,K)=>{let J=0,W=0,X=!1;Z.forEach((U)=>{++J,U.next(()=>{++W,X&&W===J&&Q()},(Y)=>K(Y))}),X=!0,W===J&&Q()})}static or(Z){let Q=S.resolve(!1);for(let K of Z)Q=Q.next((J)=>J?S.resolve(J):K());return Q}static forEach(Z,Q){let K=[];return Z.forEach((J,W)=>{K.push(Q.call(this,J,W))}),this.waitFor(K)}static mapArray(Z,Q){return new S((K,J)=>{let W=Z.length,X=Array(W),U=0;for(let Y=0;Y<W;Y++){let z=Y;Q(Z[z]).next((P)=>{X[z]=P,++U,U===W&&K(X)},(P)=>J(P))}})}static doWhile(Z,Q){return new S((K,J)=>{let W=()=>{Z()===!0?Q().next(()=>{W()},J):K()};W()})}}function oG(Z){let Q=Z.match(/Android ([\d.]+)/i),K=Q?Q[1].split(".").slice(0,2).join("."):"-1";return Number(K)}function e6(Z){return Z.name==="IndexedDbTransactionError"}class l8{constructor(Z,Q){this.previousValue=Z,Q&&(Q.sequenceNumberHandler=(K)=>this.ae(K),this.ue=(K)=>Q.writeSequenceNumber(K))}ae(Z){return this.previousValue=Math.max(Z,this.previousValue),this.previousValue}next(){let Z=++this.previousValue;return this.ue&&this.ue(Z),Z}}l8.ce=-1;var N7=-1;function v1(Z){return Z==null}function C8(Z){return Z===0&&1/Z==-1/0}function nG(Z){return typeof Z=="number"&&Number.isInteger(Z)&&!C8(Z)&&Z<=Number.MAX_SAFE_INTEGER&&Z>=Number.MIN_SAFE_INTEGER}var V5="\x01";function tG(Z){let Q="";for(let K=0;K<Z.length;K++)Q.length>0&&(Q=BQ(Q)),Q=rG(Z.get(K),Q);return BQ(Q)}function rG(Z,Q){let K=Q,J=Z.length;for(let W=0;W<J;W++){let X=Z.charAt(W);switch(X){case"\x00":K+="\x01\x10";break;case V5:K+="\x01\x11";break;default:K+=X}}return K}function BQ(Z){return Z+V5+"\x01"}var bG="remoteDocuments",Y5="owner";var z5="mutationQueues";var H5="mutations";var P5="documentMutations",cG="remoteDocumentsV14";var w5="remoteDocumentGlobal";var B5="targets";var q5="targetDocuments";var F5="targetGlobal",D5="collectionParents";var M5="clientMetadata";var R5="bundles";var N5="namedQueries";var eG="indexConfiguration";var aG="indexState";var Z2="indexEntries";var I5="documentOverlays";var Q2="globals";var K2=[z5,H5,P5,bG,B5,Y5,F5,q5,M5,w5,D5,R5,N5],LX=[...K2,I5],J2=[z5,H5,P5,cG,B5,Y5,F5,q5,M5,w5,D5,R5,N5,I5],G2=J2,W2=[...G2,eG,aG,Z2];var xX=[...W2,Q2];function qQ(Z){let Q=0;for(let K in Z)Object.prototype.hasOwnProperty.call(Z,K)&&Q++;return Q}function H6(Z,Q){for(let K in Z)Object.prototype.hasOwnProperty.call(Z,K)&&Q(K,Z[K])}function O5(Z){for(let Q in Z)if(Object.prototype.hasOwnProperty.call(Z,Q))return!1;return!0}class a{constructor(Z,Q){this.comparator=Z,this.root=Q||Y0.EMPTY}insert(Z,Q){return new a(this.comparator,this.root.insert(Z,Q,this.comparator).copy(null,null,Y0.BLACK,null,null))}remove(Z){return new a(this.comparator,this.root.remove(Z,this.comparator).copy(null,null,Y0.BLACK,null,null))}get(Z){let Q=this.root;for(;!Q.isEmpty();){let K=this.comparator(Z,Q.key);if(K===0)return Q.value;K<0?Q=Q.left:K>0&&(Q=Q.right)}return null}indexOf(Z){let Q=0,K=this.root;for(;!K.isEmpty();){let J=this.comparator(Z,K.key);if(J===0)return Q+K.left.size;J<0?K=K.left:(Q+=K.left.size+1,K=K.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(Z){return this.root.inorderTraversal(Z)}forEach(Z){this.inorderTraversal((Q,K)=>(Z(Q,K),!1))}toString(){let Z=[];return this.inorderTraversal((Q,K)=>(Z.push(`${Q}:${K}`),!1)),`{${Z.join(", ")}}`}reverseTraversal(Z){return this.root.reverseTraversal(Z)}getIterator(){return new O8(this.root,null,this.comparator,!1)}getIteratorFrom(Z){return new O8(this.root,Z,this.comparator,!1)}getReverseIterator(){return new O8(this.root,null,this.comparator,!0)}getReverseIteratorFrom(Z){return new O8(this.root,Z,this.comparator,!0)}}class O8{constructor(Z,Q,K,J){this.isReverse=J,this.nodeStack=[];let W=1;for(;!Z.isEmpty();)if(W=Q?K(Z.key,Q):1,Q&&J&&(W*=-1),W<0)Z=this.isReverse?Z.left:Z.right;else{if(W===0){this.nodeStack.push(Z);break}this.nodeStack.push(Z),Z=this.isReverse?Z.right:Z.left}}getNext(){let Z=this.nodeStack.pop(),Q={key:Z.key,value:Z.value};if(this.isReverse)for(Z=Z.left;!Z.isEmpty();)this.nodeStack.push(Z),Z=Z.right;else for(Z=Z.right;!Z.isEmpty();)this.nodeStack.push(Z),Z=Z.left;return Q}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;let Z=this.nodeStack[this.nodeStack.length-1];return{key:Z.key,value:Z.value}}}class Y0{constructor(Z,Q,K,J,W){this.key=Z,this.value=Q,this.color=K!=null?K:Y0.RED,this.left=J!=null?J:Y0.EMPTY,this.right=W!=null?W:Y0.EMPTY,this.size=this.left.size+1+this.right.size}copy(Z,Q,K,J,W){return new Y0(Z!=null?Z:this.key,Q!=null?Q:this.value,K!=null?K:this.color,J!=null?J:this.left,W!=null?W:this.right)}isEmpty(){return!1}inorderTraversal(Z){return this.left.inorderTraversal(Z)||Z(this.key,this.value)||this.right.inorderTraversal(Z)}reverseTraversal(Z){return this.right.reverseTraversal(Z)||Z(this.key,this.value)||this.left.reverseTraversal(Z)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(Z,Q,K){let J=this,W=K(Z,J.key);return J=W<0?J.copy(null,null,null,J.left.insert(Z,Q,K),null):W===0?J.copy(null,Q,null,null,null):J.copy(null,null,null,null,J.right.insert(Z,Q,K)),J.fixUp()}removeMin(){if(this.left.isEmpty())return Y0.EMPTY;let Z=this;return Z.left.isRed()||Z.left.left.isRed()||(Z=Z.moveRedLeft()),Z=Z.copy(null,null,null,Z.left.removeMin(),null),Z.fixUp()}remove(Z,Q){let K,J=this;if(Q(Z,J.key)<0)J.left.isEmpty()||J.left.isRed()||J.left.left.isRed()||(J=J.moveRedLeft()),J=J.copy(null,null,null,J.left.remove(Z,Q),null);else{if(J.left.isRed()&&(J=J.rotateRight()),J.right.isEmpty()||J.right.isRed()||J.right.left.isRed()||(J=J.moveRedRight()),Q(Z,J.key)===0){if(J.right.isEmpty())return Y0.EMPTY;K=J.right.min(),J=J.copy(K.key,K.value,null,null,J.right.removeMin())}J=J.copy(null,null,null,null,J.right.remove(Z,Q))}return J.fixUp()}isRed(){return this.color}fixUp(){let Z=this;return Z.right.isRed()&&!Z.left.isRed()&&(Z=Z.rotateLeft()),Z.left.isRed()&&Z.left.left.isRed()&&(Z=Z.rotateRight()),Z.left.isRed()&&Z.right.isRed()&&(Z=Z.colorFlip()),Z}moveRedLeft(){let Z=this.colorFlip();return Z.right.left.isRed()&&(Z=Z.copy(null,null,null,null,Z.right.rotateRight()),Z=Z.rotateLeft(),Z=Z.colorFlip()),Z}moveRedRight(){let Z=this.colorFlip();return Z.left.left.isRed()&&(Z=Z.rotateRight(),Z=Z.colorFlip()),Z}rotateLeft(){let Z=this.copy(null,null,Y0.RED,null,this.right.left);return this.right.copy(null,null,this.color,Z,null)}rotateRight(){let Z=this.copy(null,null,Y0.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,Z)}colorFlip(){let Z=this.left.copy(null,null,!this.left.color,null,null),Q=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,Z,Q)}checkMaxDepth(){let Z=this.check();return Math.pow(2,Z)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw v(43730,{key:this.key,value:this.value});if(this.right.isRed())throw v(14113,{key:this.key,value:this.value});let Z=this.left.check();if(Z!==this.right.check())throw v(27949);return Z+(this.isRed()?0:1)}}Y0.EMPTY=null,Y0.RED=!0,Y0.BLACK=!1;Y0.EMPTY=new class{constructor(){this.size=0}get key(){throw v(57766)}get value(){throw v(16141)}get color(){throw v(16727)}get left(){throw v(29726)}get right(){throw v(36894)}copy(Q,K,J,W,X){return this}insert(Q,K,J){return new Y0(Q,K)}remove(Q,K){return this}isEmpty(){return!0}inorderTraversal(Q){return!1}reverseTraversal(Q){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class $0{constructor(Z){this.comparator=Z,this.data=new a(this.comparator)}has(Z){return this.data.get(Z)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(Z){return this.data.indexOf(Z)}forEach(Z){this.data.inorderTraversal((Q,K)=>(Z(Q),!1))}forEachInRange(Z,Q){let K=this.data.getIteratorFrom(Z[0]);for(;K.hasNext();){let J=K.getNext();if(this.comparator(J.key,Z[1])>=0)return;Q(J.key)}}forEachWhile(Z,Q){let K;for(K=Q!==void 0?this.data.getIteratorFrom(Q):this.data.getIterator();K.hasNext();)if(!Z(K.getNext().key))return}firstAfterOrEqual(Z){let Q=this.data.getIteratorFrom(Z);return Q.hasNext()?Q.getNext().key:null}getIterator(){return new c9(this.data.getIterator())}getIteratorFrom(Z){return new c9(this.data.getIteratorFrom(Z))}add(Z){return this.copy(this.data.remove(Z).insert(Z,!0))}delete(Z){return this.has(Z)?this.copy(this.data.remove(Z)):this}isEmpty(){return this.data.isEmpty()}unionWith(Z){let Q=this;return Q.size<Z.size&&(Q=Z,Z=this),Z.forEach((K)=>{Q=Q.add(K)}),Q}isEqual(Z){if(!(Z instanceof $0))return!1;if(this.size!==Z.size)return!1;let Q=this.data.getIterator(),K=Z.data.getIterator();for(;Q.hasNext();){let J=Q.getNext().key,W=K.getNext().key;if(this.comparator(J,W)!==0)return!1}return!0}toArray(){let Z=[];return this.forEach((Q)=>{Z.push(Q)}),Z}toString(){let Z=[];return this.forEach((Q)=>Z.push(Q)),"SortedSet("+Z.toString()+")"}copy(Z){let Q=new $0(this.comparator);return Q.data=Z,Q}}class c9{constructor(Z){this.iter=Z}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}class _0{constructor(Z){this.fields=Z,Z.sort(z0.comparator)}static empty(){return new _0([])}unionWith(Z){let Q=new $0(z0.comparator);for(let K of this.fields)Q=Q.add(K);for(let K of Z)Q=Q.add(K);return new _0(Q.toArray())}covers(Z){for(let Q of this.fields)if(Q.isPrefixOf(Z))return!0;return!1}isEqual(Z){return g6(this.fields,Z.fields,(Q,K)=>Q.isEqual(K))}}class I7 extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class H0{constructor(Z){this.binaryString=Z}static fromBase64String(Z){let Q=function(J){try{return atob(J)}catch(W){throw typeof DOMException<"u"&&W instanceof DOMException?new I7("Invalid base64 string: "+W):W}}(Z);return new H0(Q)}static fromUint8Array(Z){let Q=function(J){let W="";for(let X=0;X<J.length;++X)W+=String.fromCharCode(J[X]);return W}(Z);return new H0(Q)}[Symbol.iterator](){let Z=0;return{next:()=>Z<this.binaryString.length?{value:this.binaryString.charCodeAt(Z++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(Q){return btoa(Q)}(this.binaryString)}toUint8Array(){return function(Q){let K=new Uint8Array(Q.length);for(let J=0;J<Q.length;J++)K[J]=Q.charCodeAt(J);return K}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(Z){return g(this.binaryString,Z.binaryString)}isEqual(Z){return this.binaryString===Z.binaryString}}H0.EMPTY_BYTE_STRING=new H0("");var X2=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function o0(Z){if(o(!!Z,39018),typeof Z=="string"){let Q=0,K=X2.exec(Z);if(o(!!K,46558,{timestamp:Z}),K[1]){let W=K[1];W=(W+"000000000").substr(0,9),Q=Number(W)}let J=new Date(Z);return{seconds:Math.floor(J.getTime()/1000),nanos:Q}}return{seconds:e(Z.seconds),nanos:e(Z.nanos)}}function e(Z){return typeof Z=="number"?Z:typeof Z=="string"?Number(Z):0}function n0(Z){return typeof Z=="string"?H0.fromBase64String(Z):H0.fromUint8Array(Z)}var j5="server_timestamp",_5="__type__",A5="__previous_value__",S5="__local_write_time__";function O7(Z){return(Z?.mapValue?.fields||{})[_5]?.stringValue===j5}function m1(Z){let Q=Z.mapValue.fields[A5];return O7(Q)?m1(Q):Q}function k8(Z){let Q=o0(Z.mapValue.fields[S5].timestampValue);return new c(Q.seconds,Q.nanos)}class T5{constructor(Z,Q,K,J,W,X,U,Y,z,P){this.databaseId=Z,this.appId=Q,this.persistenceKey=K,this.host=J,this.ssl=W,this.forceLongPolling=X,this.autoDetectLongPolling=U,this.longPollingOptions=Y,this.useFetchStreams=z,this.isUsingEmulator=P}}var S1="(default)";class h8{constructor(Z,Q){this.projectId=Z,this.database=Q||S1}static empty(){return new h8("","")}get isDefaultDatabase(){return this.database===S1}isEqual(Z){return Z instanceof h8&&Z.projectId===this.projectId&&Z.database===this.database}}var j7="__type__",E5="__max__",N1={mapValue:{fields:{__type__:{stringValue:E5}}}},_7="__vector__",l6="value";function V6(Z){return"nullValue"in Z?0:("booleanValue"in Z)?1:("integerValue"in Z)||("doubleValue"in Z)?2:("timestampValue"in Z)?3:("stringValue"in Z)?5:("bytesValue"in Z)?6:("referenceValue"in Z)?7:("geoPointValue"in Z)?8:("arrayValue"in Z)?9:("mapValue"in Z)?O7(Z)?4:x5(Z)?9007199254740991:L5(Z)?10:11:v(28295,{value:Z})}function f0(Z,Q){if(Z===Q)return!0;let K=V6(Z);if(K!==V6(Q))return!1;switch(K){case 0:case 9007199254740991:return!0;case 1:return Z.booleanValue===Q.booleanValue;case 4:return k8(Z).isEqual(k8(Q));case 3:return function(W,X){if(typeof W.timestampValue=="string"&&typeof X.timestampValue=="string"&&W.timestampValue.length===X.timestampValue.length)return W.timestampValue===X.timestampValue;let U=o0(W.timestampValue),Y=o0(X.timestampValue);return U.seconds===Y.seconds&&U.nanos===Y.nanos}(Z,Q);case 5:return Z.stringValue===Q.stringValue;case 6:return function(W,X){return n0(W.bytesValue).isEqual(n0(X.bytesValue))}(Z,Q);case 7:return Z.referenceValue===Q.referenceValue;case 8:return function(W,X){return e(W.geoPointValue.latitude)===e(X.geoPointValue.latitude)&&e(W.geoPointValue.longitude)===e(X.geoPointValue.longitude)}(Z,Q);case 2:return function(W,X){if("integerValue"in W&&"integerValue"in X)return e(W.integerValue)===e(X.integerValue);if("doubleValue"in W&&"doubleValue"in X){let U=e(W.doubleValue),Y=e(X.doubleValue);return U===Y?C8(U)===C8(Y):isNaN(U)&&isNaN(Y)}return!1}(Z,Q);case 9:return g6(Z.arrayValue.values||[],Q.arrayValue.values||[],f0);case 10:case 11:return function(W,X){let U=W.mapValue.fields||{},Y=X.mapValue.fields||{};if(qQ(U)!==qQ(Y))return!1;for(let z in U)if(U.hasOwnProperty(z)&&(Y[z]===void 0||!f0(U[z],Y[z])))return!1;return!0}(Z,Q);default:return v(52216,{left:Z})}}function v8(Z,Q){return(Z.values||[]).find((K)=>f0(K,Q))!==void 0}function s6(Z,Q){if(Z===Q)return 0;let K=V6(Z),J=V6(Q);if(K!==J)return g(K,J);switch(K){case 0:case 9007199254740991:return 0;case 1:return g(Z.booleanValue,Q.booleanValue);case 2:return function(X,U){let Y=e(X.integerValue||X.doubleValue),z=e(U.integerValue||U.doubleValue);return Y<z?-1:Y>z?1:Y===z?0:isNaN(Y)?isNaN(z)?0:-1:1}(Z,Q);case 3:return FQ(Z.timestampValue,Q.timestampValue);case 4:return FQ(k8(Z),k8(Q));case 5:return b9(Z.stringValue,Q.stringValue);case 6:return function(X,U){let Y=n0(X),z=n0(U);return Y.compareTo(z)}(Z.bytesValue,Q.bytesValue);case 7:return function(X,U){let Y=X.split("/"),z=U.split("/");for(let P=0;P<Y.length&&P<z.length;P++){let F=g(Y[P],z[P]);if(F!==0)return F}return g(Y.length,z.length)}(Z.referenceValue,Q.referenceValue);case 8:return function(X,U){let Y=g(e(X.latitude),e(U.latitude));if(Y!==0)return Y;return g(e(X.longitude),e(U.longitude))}(Z.geoPointValue,Q.geoPointValue);case 9:return DQ(Z.arrayValue,Q.arrayValue);case 10:return function(X,U){let Y=X.fields||{},z=U.fields||{},P=Y[l6]?.arrayValue,F=z[l6]?.arrayValue,j=g(P?.values?.length||0,F?.values?.length||0);if(j!==0)return j;return DQ(P,F)}(Z.mapValue,Q.mapValue);case 11:return function(X,U){if(X===N1.mapValue&&U===N1.mapValue)return 0;if(X===N1.mapValue)return 1;if(U===N1.mapValue)return-1;let Y=X.fields||{},z=Object.keys(Y),P=U.fields||{},F=Object.keys(P);z.sort(),F.sort();for(let j=0;j<z.length&&j<F.length;++j){let I=b9(z[j],F[j]);if(I!==0)return I;let T=s6(Y[z[j]],P[F[j]]);if(T!==0)return T}return g(z.length,F.length)}(Z.mapValue,Q.mapValue);default:throw v(23264,{he:K})}}function FQ(Z,Q){if(typeof Z=="string"&&typeof Q=="string"&&Z.length===Q.length)return g(Z,Q);let K=o0(Z),J=o0(Q),W=g(K.seconds,J.seconds);return W!==0?W:g(K.nanos,J.nanos)}function DQ(Z,Q){let K=Z.values||[],J=Q.values||[];for(let W=0;W<K.length&&W<J.length;++W){let X=s6(K[W],J[W]);if(X)return X}return g(K.length,J.length)}function i6(Z){return e9(Z)}function e9(Z){return"nullValue"in Z?"null":("booleanValue"in Z)?""+Z.booleanValue:("integerValue"in Z)?""+Z.integerValue:("doubleValue"in Z)?""+Z.doubleValue:("timestampValue"in Z)?function(K){let J=o0(K);return`time(${J.seconds},${J.nanos})`}(Z.timestampValue):("stringValue"in Z)?Z.stringValue:("bytesValue"in Z)?function(K){return n0(K).toBase64()}(Z.bytesValue):("referenceValue"in Z)?function(K){return h.fromName(K).toString()}(Z.referenceValue):("geoPointValue"in Z)?function(K){return`geo(${K.latitude},${K.longitude})`}(Z.geoPointValue):("arrayValue"in Z)?function(K){let J="[",W=!0;for(let X of K.values||[])W?W=!1:J+=",",J+=e9(X);return J+"]"}(Z.arrayValue):("mapValue"in Z)?function(K){let J=Object.keys(K.fields||{}).sort(),W="{",X=!0;for(let U of J)X?X=!1:W+=",",W+=`${U}:${e9(K.fields[U])}`;return W+"}"}(Z.mapValue):v(61005,{value:Z})}function j1(Z){switch(V6(Z)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:let Q=m1(Z);return Q?16+j1(Q):16;case 5:return 2*Z.stringValue.length;case 6:return n0(Z.bytesValue).approximateByteSize();case 7:return Z.referenceValue.length;case 9:return function(J){return(J.values||[]).reduce((W,X)=>W+j1(X),0)}(Z.arrayValue);case 10:case 11:return function(J){let W=0;return H6(J.fields,(X,U)=>{W+=X.length+j1(U)}),W}(Z.mapValue);default:throw v(13486,{value:Z})}}function MQ(Z,Q){return{referenceValue:`projects/${Z.projectId}/databases/${Z.database}/documents/${Q.path.canonicalString()}`}}function a9(Z){return!!Z&&"integerValue"in Z}function A7(Z){return!!Z&&"arrayValue"in Z}function RQ(Z){return!!Z&&"nullValue"in Z}function NQ(Z){return!!Z&&"doubleValue"in Z&&isNaN(Number(Z.doubleValue))}function _1(Z){return!!Z&&"mapValue"in Z}function L5(Z){return(Z?.mapValue?.fields||{})[j7]?.stringValue===_7}function A8(Z){if(Z.geoPointValue)return{geoPointValue:{...Z.geoPointValue}};if(Z.timestampValue&&typeof Z.timestampValue=="object")return{timestampValue:{...Z.timestampValue}};if(Z.mapValue){let Q={mapValue:{fields:{}}};return H6(Z.mapValue.fields,(K,J)=>Q.mapValue.fields[K]=A8(J)),Q}if(Z.arrayValue){let Q={arrayValue:{values:[]}};for(let K=0;K<(Z.arrayValue.values||[]).length;++K)Q.arrayValue.values[K]=A8(Z.arrayValue.values[K]);return Q}return{...Z}}function x5(Z){return(((Z.mapValue||{}).fields||{}).__type__||{}).stringValue===E5}var yX={mapValue:{fields:{[j7]:{stringValue:_7},[l6]:{arrayValue:{}}}}};class I0{constructor(Z){this.value=Z}static empty(){return new I0({mapValue:{}})}field(Z){if(Z.isEmpty())return this.value;{let Q=this.value;for(let K=0;K<Z.length-1;++K)if(Q=(Q.mapValue.fields||{})[Z.get(K)],!_1(Q))return null;return Q=(Q.mapValue.fields||{})[Z.lastSegment()],Q||null}}set(Z,Q){this.getFieldsMap(Z.popLast())[Z.lastSegment()]=A8(Q)}setAll(Z){let Q=z0.emptyPath(),K={},J=[];Z.forEach((X,U)=>{if(!Q.isImmediateParentOf(U)){let Y=this.getFieldsMap(Q);this.applyChanges(Y,K,J),K={},J=[],Q=U.popLast()}X?K[U.lastSegment()]=A8(X):J.push(U.lastSegment())});let W=this.getFieldsMap(Q);this.applyChanges(W,K,J)}delete(Z){let Q=this.field(Z.popLast());_1(Q)&&Q.mapValue.fields&&delete Q.mapValue.fields[Z.lastSegment()]}isEqual(Z){return f0(this.value,Z.value)}getFieldsMap(Z){let Q=this.value;Q.mapValue.fields||(Q.mapValue={fields:{}});for(let K=0;K<Z.length;++K){let J=Q.mapValue.fields[Z.get(K)];_1(J)&&J.mapValue.fields||(J={mapValue:{fields:{}}},Q.mapValue.fields[Z.get(K)]=J),Q=J}return Q.mapValue.fields}applyChanges(Z,Q,K){H6(Q,(J,W)=>Z[J]=W);for(let J of K)delete Z[J]}clone(){return new I0(A8(this.value))}}function y5(Z){let Q=[];return H6(Z.fields,(K,J)=>{let W=new z0([K]);if(_1(J)){let X=y5(J.mapValue).fields;if(X.length===0)Q.push(W);else for(let U of X)Q.push(W.child(U))}else Q.push(W)}),new _0(Q)}class q0{constructor(Z,Q,K,J,W,X,U){this.key=Z,this.documentType=Q,this.version=K,this.readTime=J,this.createTime=W,this.data=X,this.documentState=U}static newInvalidDocument(Z){return new q0(Z,0,m.min(),m.min(),m.min(),I0.empty(),0)}static newFoundDocument(Z,Q,K,J){return new q0(Z,1,Q,m.min(),K,J,0)}static newNoDocument(Z,Q){return new q0(Z,2,Q,m.min(),m.min(),I0.empty(),0)}static newUnknownDocument(Z,Q){return new q0(Z,3,Q,m.min(),m.min(),I0.empty(),2)}convertToFoundDocument(Z,Q){return!this.createTime.isEqual(m.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=Z),this.version=Z,this.documentType=1,this.data=Q,this.documentState=0,this}convertToNoDocument(Z){return this.version=Z,this.documentType=2,this.data=I0.empty(),this.documentState=0,this}convertToUnknownDocument(Z){return this.version=Z,this.documentType=3,this.data=I0.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=m.min(),this}setReadTime(Z){return this.readTime=Z,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(Z){return Z instanceof q0&&this.key.isEqual(Z.key)&&this.version.isEqual(Z.version)&&this.documentType===Z.documentType&&this.documentState===Z.documentState&&this.data.isEqual(Z.data)}mutableCopy(){return new q0(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class m8{constructor(Z,Q){this.position=Z,this.inclusive=Q}}function IQ(Z,Q,K){let J=0;for(let W=0;W<Z.position.length;W++){let X=Q[W],U=Z.position[W];if(X.field.isKeyField())J=h.comparator(h.fromName(U.referenceValue),K.key);else J=s6(U,K.data.field(X.field));if(X.dir==="desc"&&(J*=-1),J!==0)break}return J}function OQ(Z,Q){if(Z===null)return Q===null;if(Q===null)return!1;if(Z.inclusive!==Q.inclusive||Z.position.length!==Q.position.length)return!1;for(let K=0;K<Z.position.length;K++)if(!f0(Z.position[K],Q.position[K]))return!1;return!0}class d6{constructor(Z,Q="asc"){this.field=Z,this.dir=Q}}function $2(Z,Q){return Z.dir===Q.dir&&Z.field.isEqual(Q.field)}class S7{}class K0 extends S7{constructor(Z,Q,K){super(),this.field=Z,this.op=Q,this.value=K}static create(Z,Q,K){return Z.isKeyField()?Q==="in"||Q==="not-in"?this.createKeyFieldInFilter(Z,Q,K):new m5(Z,Q,K):Q==="array-contains"?new p5(Z,K):Q==="in"?new l5(Z,K):Q==="not-in"?new s5(Z,K):Q==="array-contains-any"?new i5(Z,K):new K0(Z,Q,K)}static createKeyFieldInFilter(Z,Q,K){return Q==="in"?new u5(Z,K):new f5(Z,K)}matches(Z){let Q=Z.data.field(this.field);return this.op==="!="?Q!==null&&Q.nullValue===void 0&&this.matchesComparison(s6(Q,this.value)):Q!==null&&V6(this.value)===V6(Q)&&this.matchesComparison(s6(Q,this.value))}matchesComparison(Z){switch(this.op){case"<":return Z<0;case"<=":return Z<=0;case"==":return Z===0;case"!=":return Z!==0;case">":return Z>0;case">=":return Z>=0;default:return v(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class T0 extends S7{constructor(Z,Q){super(),this.filters=Z,this.op=Q,this.Pe=null}static create(Z,Q){return new T0(Z,Q)}matches(Z){return C5(this)?this.filters.find((Q)=>!Q.matches(Z))===void 0:this.filters.find((Q)=>Q.matches(Z))!==void 0}getFlattenedFilters(){return this.Pe!==null||(this.Pe=this.filters.reduce((Z,Q)=>Z.concat(Q.getFlattenedFilters()),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}}function C5(Z){return Z.op==="and"}function k5(Z){return U2(Z)&&C5(Z)}function U2(Z){for(let Q of Z.filters)if(Q instanceof T0)return!1;return!0}function Z7(Z){if(Z instanceof K0)return Z.field.canonicalString()+Z.op.toString()+i6(Z.value);if(k5(Z))return Z.filters.map((Q)=>Z7(Q)).join(",");{let Q=Z.filters.map((K)=>Z7(K)).join(",");return`${Z.op}(${Q})`}}function h5(Z,Q){return Z instanceof K0?function(J,W){return W instanceof K0&&J.op===W.op&&J.field.isEqual(W.field)&&f0(J.value,W.value)}(Z,Q):Z instanceof T0?function(J,W){if(W instanceof T0&&J.op===W.op&&J.filters.length===W.filters.length)return J.filters.reduce((X,U,Y)=>X&&h5(U,W.filters[Y]),!0);return!1}(Z,Q):void v(19439)}function v5(Z){return Z instanceof K0?function(K){return`${K.field.canonicalString()} ${K.op} ${i6(K.value)}`}(Z):Z instanceof T0?function(K){return K.op.toString()+" {"+K.getFilters().map(v5).join(" ,")+"}"}(Z):"Filter"}class m5 extends K0{constructor(Z,Q,K){super(Z,Q,K),this.key=h.fromName(K.referenceValue)}matches(Z){let Q=h.comparator(Z.key,this.key);return this.matchesComparison(Q)}}class u5 extends K0{constructor(Z,Q){super(Z,"in",Q),this.keys=g5("in",Q)}matches(Z){return this.keys.some((Q)=>Q.isEqual(Z.key))}}class f5 extends K0{constructor(Z,Q){super(Z,"not-in",Q),this.keys=g5("not-in",Q)}matches(Z){return!this.keys.some((Q)=>Q.isEqual(Z.key))}}function g5(Z,Q){return(Q.arrayValue?.values||[]).map((K)=>h.fromName(K.referenceValue))}class p5 extends K0{constructor(Z,Q){super(Z,"array-contains",Q)}matches(Z){let Q=Z.data.field(this.field);return A7(Q)&&v8(Q.arrayValue,this.value)}}class l5 extends K0{constructor(Z,Q){super(Z,"in",Q)}matches(Z){let Q=Z.data.field(this.field);return Q!==null&&v8(this.value.arrayValue,Q)}}class s5 extends K0{constructor(Z,Q){super(Z,"not-in",Q)}matches(Z){if(v8(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;let Q=Z.data.field(this.field);return Q!==null&&Q.nullValue===void 0&&!v8(this.value.arrayValue,Q)}}class i5 extends K0{constructor(Z,Q){super(Z,"array-contains-any",Q)}matches(Z){let Q=Z.data.field(this.field);return!(!A7(Q)||!Q.arrayValue.values)&&Q.arrayValue.values.some((K)=>v8(this.value.arrayValue,K))}}class d5{constructor(Z,Q=null,K=[],J=[],W=null,X=null,U=null){this.path=Z,this.collectionGroup=Q,this.orderBy=K,this.filters=J,this.limit=W,this.startAt=X,this.endAt=U,this.Te=null}}function jQ(Z,Q=null,K=[],J=[],W=null,X=null,U=null){return new d5(Z,Q,K,J,W,X,U)}function T7(Z){let Q=u(Z);if(Q.Te===null){let K=Q.path.canonicalString();Q.collectionGroup!==null&&(K+="|cg:"+Q.collectionGroup),K+="|f:",K+=Q.filters.map((J)=>Z7(J)).join(","),K+="|ob:",K+=Q.orderBy.map((J)=>function(X){return X.field.canonicalString()+X.dir}(J)).join(","),v1(Q.limit)||(K+="|l:",K+=Q.limit),Q.startAt&&(K+="|lb:",K+=Q.startAt.inclusive?"b:":"a:",K+=Q.startAt.position.map((J)=>i6(J)).join(",")),Q.endAt&&(K+="|ub:",K+=Q.endAt.inclusive?"a:":"b:",K+=Q.endAt.position.map((J)=>i6(J)).join(",")),Q.Te=K}return Q.Te}function E7(Z,Q){if(Z.limit!==Q.limit)return!1;if(Z.orderBy.length!==Q.orderBy.length)return!1;for(let K=0;K<Z.orderBy.length;K++)if(!$2(Z.orderBy[K],Q.orderBy[K]))return!1;if(Z.filters.length!==Q.filters.length)return!1;for(let K=0;K<Z.filters.length;K++)if(!h5(Z.filters[K],Q.filters[K]))return!1;return Z.collectionGroup===Q.collectionGroup&&(!!Z.path.isEqual(Q.path)&&(!!OQ(Z.startAt,Q.startAt)&&OQ(Z.endAt,Q.endAt)))}function Q7(Z){return h.isDocumentKey(Z.path)&&Z.collectionGroup===null&&Z.filters.length===0}class j6{constructor(Z,Q=null,K=[],J=[],W=null,X="F",U=null,Y=null){this.path=Z,this.collectionGroup=Q,this.explicitOrderBy=K,this.filters=J,this.limit=W,this.limitType=X,this.startAt=U,this.endAt=Y,this.Ie=null,this.Ee=null,this.de=null,this.startAt,this.endAt}}function V2(Z,Q,K,J,W,X,U,Y){return new j6(Z,Q,K,J,W,X,U,Y)}function o5(Z){return new j6(Z)}function _Q(Z){return Z.filters.length===0&&Z.limit===null&&Z.startAt==null&&Z.endAt==null&&(Z.explicitOrderBy.length===0||Z.explicitOrderBy.length===1&&Z.explicitOrderBy[0].field.isKeyField())}function n5(Z){return Z.collectionGroup!==null}function S8(Z){let Q=u(Z);if(Q.Ie===null){Q.Ie=[];let K=new Set;for(let X of Q.explicitOrderBy)Q.Ie.push(X),K.add(X.field.canonicalString());let J=Q.explicitOrderBy.length>0?Q.explicitOrderBy[Q.explicitOrderBy.length-1].dir:"asc";(function(U){let Y=new $0(z0.comparator);return U.filters.forEach((z)=>{z.getFlattenedFilters().forEach((P)=>{P.isInequality()&&(Y=Y.add(P.field))})}),Y})(Q).forEach((X)=>{K.has(X.canonicalString())||X.isKeyField()||Q.Ie.push(new d6(X,J))}),K.has(z0.keyField().canonicalString())||Q.Ie.push(new d6(z0.keyField(),J))}return Q.Ie}function k0(Z){let Q=u(Z);return Q.Ee||(Q.Ee=Y2(Q,S8(Z))),Q.Ee}function Y2(Z,Q){if(Z.limitType==="F")return jQ(Z.path,Z.collectionGroup,Q,Z.filters,Z.limit,Z.startAt,Z.endAt);{Q=Q.map((W)=>{let X=W.dir==="desc"?"asc":"desc";return new d6(W.field,X)});let K=Z.endAt?new m8(Z.endAt.position,Z.endAt.inclusive):null,J=Z.startAt?new m8(Z.startAt.position,Z.startAt.inclusive):null;return jQ(Z.path,Z.collectionGroup,Q,Z.filters,Z.limit,K,J)}}function K7(Z,Q){let K=Z.filters.concat([Q]);return new j6(Z.path,Z.collectionGroup,Z.explicitOrderBy.slice(),K,Z.limit,Z.limitType,Z.startAt,Z.endAt)}function T1(Z,Q,K){return new j6(Z.path,Z.collectionGroup,Z.explicitOrderBy.slice(),Z.filters.slice(),Q,K,Z.startAt,Z.endAt)}function u1(Z,Q){return E7(k0(Z),k0(Q))&&Z.limitType===Q.limitType}function t5(Z){return`${T7(k0(Z))}|lt:${Z.limitType}`}function y6(Z){return`Query(target=${function(K){let J=K.path.canonicalString();return K.collectionGroup!==null&&(J+=" collectionGroup="+K.collectionGroup),K.filters.length>0&&(J+=`, filters: [${K.filters.map((W)=>v5(W)).join(", ")}]`),v1(K.limit)||(J+=", limit: "+K.limit),K.orderBy.length>0&&(J+=`, orderBy: [${K.orderBy.map((W)=>function(U){return`${U.field.canonicalString()} (${U.dir})`}(W)).join(", ")}]`),K.startAt&&(J+=", startAt: ",J+=K.startAt.inclusive?"b:":"a:",J+=K.startAt.position.map((W)=>i6(W)).join(",")),K.endAt&&(J+=", endAt: ",J+=K.endAt.inclusive?"a:":"b:",J+=K.endAt.position.map((W)=>i6(W)).join(",")),`Target(${J})`}(k0(Z))}; limitType=${Z.limitType})`}function f1(Z,Q){return Q.isFoundDocument()&&function(J,W){let X=W.key.path;return J.collectionGroup!==null?W.key.hasCollectionId(J.collectionGroup)&&J.path.isPrefixOf(X):h.isDocumentKey(J.path)?J.path.isEqual(X):J.path.isImmediateParentOf(X)}(Z,Q)&&function(J,W){for(let X of S8(J))if(!X.field.isKeyField()&&W.data.field(X.field)===null)return!1;return!0}(Z,Q)&&function(J,W){for(let X of J.filters)if(!X.matches(W))return!1;return!0}(Z,Q)&&function(J,W){if(J.startAt&&!function(U,Y,z){let P=IQ(U,Y,z);return U.inclusive?P<=0:P<0}(J.startAt,S8(J),W))return!1;if(J.endAt&&!function(U,Y,z){let P=IQ(U,Y,z);return U.inclusive?P>=0:P>0}(J.endAt,S8(J),W))return!1;return!0}(Z,Q)}function z2(Z){return Z.collectionGroup||(Z.path.length%2==1?Z.path.lastSegment():Z.path.get(Z.path.length-2))}function r5(Z){return(Q,K)=>{let J=!1;for(let W of S8(Z)){let X=H2(W,Q,K);if(X!==0)return X;J=J||W.field.isKeyField()}return 0}}function H2(Z,Q,K){let J=Z.field.isKeyField()?h.comparator(Q.key,K.key):function(X,U,Y){let z=U.data.field(X),P=Y.data.field(X);return z!==null&&P!==null?s6(z,P):v(42886)}(Z.field,Q,K);switch(Z.dir){case"asc":return J;case"desc":return-1*J;default:return v(19790,{direction:Z.dir})}}class P6{constructor(Z,Q){this.mapKeyFn=Z,this.equalsFn=Q,this.inner={},this.innerSize=0}get(Z){let Q=this.mapKeyFn(Z),K=this.inner[Q];if(K!==void 0){for(let[J,W]of K)if(this.equalsFn(J,Z))return W}}has(Z){return this.get(Z)!==void 0}set(Z,Q){let K=this.mapKeyFn(Z),J=this.inner[K];if(J===void 0)return this.inner[K]=[[Z,Q]],void this.innerSize++;for(let W=0;W<J.length;W++)if(this.equalsFn(J[W][0],Z))return void(J[W]=[Z,Q]);J.push([Z,Q]),this.innerSize++}delete(Z){let Q=this.mapKeyFn(Z),K=this.inner[Q];if(K===void 0)return!1;for(let J=0;J<K.length;J++)if(this.equalsFn(K[J][0],Z))return K.length===1?delete this.inner[Q]:K.splice(J,1),this.innerSize--,!0;return!1}forEach(Z){H6(this.inner,(Q,K)=>{for(let[J,W]of K)Z(J,W)})}isEmpty(){return O5(this.inner)}size(){return this.innerSize}}var P2=new a(h.comparator);function t0(){return P2}var b5=new a(h.comparator);function j8(...Z){let Q=b5;for(let K of Z)Q=Q.insert(K.key,K);return Q}function c5(Z){let Q=b5;return Z.forEach((K,J)=>Q=Q.insert(K,J.overlayedDocument)),Q}function N6(){return T8()}function e5(){return T8()}function T8(){return new P6((Z)=>Z.toString(),(Z,Q)=>Z.isEqual(Q))}var w2=new a(h.comparator),B2=new $0(h.comparator);function p(...Z){let Q=B2;for(let K of Z)Q=Q.add(K);return Q}var q2=new $0(g);function F2(){return q2}function L7(Z,Q){if(Z.useProto3Json){if(isNaN(Q))return{doubleValue:"NaN"};if(Q===1/0)return{doubleValue:"Infinity"};if(Q===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:C8(Q)?"-0":Q}}function a5(Z){return{integerValue:""+Z}}function D2(Z,Q){return nG(Q)?a5(Q):L7(Z,Q)}class s8{constructor(){this._=void 0}}function M2(Z,Q,K){return Z instanceof u8?function(W,X){let U={fields:{[_5]:{stringValue:j5},[S5]:{timestampValue:{seconds:W.seconds,nanos:W.nanoseconds}}}};return X&&O7(X)&&(X=m1(X)),X&&(U.fields[A5]=X),{mapValue:U}}(K,Q):Z instanceof o6?QK(Z,Q):Z instanceof n6?KK(Z,Q):function(W,X){let U=ZK(W,X),Y=AQ(U)+AQ(W.Ae);return a9(U)&&a9(W.Ae)?a5(Y):L7(W.serializer,Y)}(Z,Q)}function R2(Z,Q,K){return Z instanceof o6?QK(Z,Q):Z instanceof n6?KK(Z,Q):K}function ZK(Z,Q){return Z instanceof f8?function(J){return a9(J)||function(X){return!!X&&"doubleValue"in X}(J)}(Q)?Q:{integerValue:0}:null}class u8 extends s8{}class o6 extends s8{constructor(Z){super(),this.elements=Z}}function QK(Z,Q){let K=JK(Q);for(let J of Z.elements)K.some((W)=>f0(W,J))||K.push(J);return{arrayValue:{values:K}}}class n6 extends s8{constructor(Z){super(),this.elements=Z}}function KK(Z,Q){let K=JK(Q);for(let J of Z.elements)K=K.filter((W)=>!f0(W,J));return{arrayValue:{values:K}}}class f8 extends s8{constructor(Z,Q){super(),this.serializer=Z,this.Ae=Q}}function AQ(Z){return e(Z.integerValue||Z.doubleValue)}function JK(Z){return A7(Z)&&Z.arrayValue.values?Z.arrayValue.values.slice():[]}function N2(Z,Q){return Z.field.isEqual(Q.field)&&function(J,W){return J instanceof o6&&W instanceof o6||J instanceof n6&&W instanceof n6?g6(J.elements,W.elements,f0):J instanceof f8&&W instanceof f8?f0(J.Ae,W.Ae):J instanceof u8&&W instanceof u8}(Z.transform,Q.transform)}class GK{constructor(Z,Q){this.version=Z,this.transformResults=Q}}class h0{constructor(Z,Q){this.updateTime=Z,this.exists=Q}static none(){return new h0}static exists(Z){return new h0(void 0,Z)}static updateTime(Z){return new h0(Z)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(Z){return this.exists===Z.exists&&(this.updateTime?!!Z.updateTime&&this.updateTime.isEqual(Z.updateTime):!Z.updateTime)}}function A1(Z,Q){return Z.updateTime!==void 0?Q.isFoundDocument()&&Q.version.isEqual(Z.updateTime):Z.exists===void 0||Z.exists===Q.isFoundDocument()}class i8{}function WK(Z,Q){if(!Z.hasLocalMutations||Q&&Q.fields.length===0)return null;if(Q===null)return Z.isNoDocument()?new x7(Z.key,h0.none()):new a6(Z.key,Z.data,h0.none());{let K=Z.data,J=I0.empty(),W=new $0(z0.comparator);for(let X of Q.fields)if(!W.has(X)){let U=K.field(X);U===null&&X.length>1&&(X=X.popLast(),U=K.field(X)),U===null?J.delete(X):J.set(X,U),W=W.add(X)}return new r0(Z.key,J,new _0(W.toArray()),h0.none())}}function I2(Z,Q,K){Z instanceof a6?function(W,X,U){let Y=W.value.clone(),z=TQ(W.fieldTransforms,X,U.transformResults);Y.setAll(z),X.convertToFoundDocument(U.version,Y).setHasCommittedMutations()}(Z,Q,K):Z instanceof r0?function(W,X,U){if(!A1(W.precondition,X))return void X.convertToUnknownDocument(U.version);let Y=TQ(W.fieldTransforms,X,U.transformResults),z=X.data;z.setAll(XK(W)),z.setAll(Y),X.convertToFoundDocument(U.version,z).setHasCommittedMutations()}(Z,Q,K):function(W,X,U){X.convertToNoDocument(U.version).setHasCommittedMutations()}(0,Q,K)}function E8(Z,Q,K,J){return Z instanceof a6?function(X,U,Y,z){if(!A1(X.precondition,U))return Y;let P=X.value.clone(),F=EQ(X.fieldTransforms,z,U);return P.setAll(F),U.convertToFoundDocument(U.version,P).setHasLocalMutations(),null}(Z,Q,K,J):Z instanceof r0?function(X,U,Y,z){if(!A1(X.precondition,U))return Y;let P=EQ(X.fieldTransforms,z,U),F=U.data;if(F.setAll(XK(X)),F.setAll(P),U.convertToFoundDocument(U.version,F).setHasLocalMutations(),Y===null)return null;return Y.unionWith(X.fieldMask.fields).unionWith(X.fieldTransforms.map((j)=>j.field))}(Z,Q,K,J):function(X,U,Y){if(A1(X.precondition,U))return U.convertToNoDocument(U.version).setHasLocalMutations(),null;return Y}(Z,Q,K)}function O2(Z,Q){let K=null;for(let J of Z.fieldTransforms){let W=Q.data.field(J.field),X=ZK(J.transform,W||null);X!=null&&(K===null&&(K=I0.empty()),K.set(J.field,X))}return K||null}function SQ(Z,Q){return Z.type===Q.type&&(!!Z.key.isEqual(Q.key)&&(!!Z.precondition.isEqual(Q.precondition)&&(!!function(J,W){return J===void 0&&W===void 0||!(!J||!W)&&g6(J,W,(X,U)=>N2(X,U))}(Z.fieldTransforms,Q.fieldTransforms)&&(Z.type===0?Z.value.isEqual(Q.value):Z.type!==1||Z.data.isEqual(Q.data)&&Z.fieldMask.isEqual(Q.fieldMask)))))}class a6 extends i8{constructor(Z,Q,K,J=[]){super(),this.key=Z,this.value=Q,this.precondition=K,this.fieldTransforms=J,this.type=0}getFieldMask(){return null}}class r0 extends i8{constructor(Z,Q,K,J,W=[]){super(),this.key=Z,this.data=Q,this.fieldMask=K,this.precondition=J,this.fieldTransforms=W,this.type=1}getFieldMask(){return this.fieldMask}}function XK(Z){let Q=new Map;return Z.fieldMask.fields.forEach((K)=>{if(!K.isEmpty()){let J=Z.data.field(K);Q.set(K,J)}}),Q}function TQ(Z,Q,K){let J=new Map;o(Z.length===K.length,32656,{Re:K.length,Ve:Z.length});for(let W=0;W<K.length;W++){let X=Z[W],U=X.transform,Y=Q.data.field(X.field);J.set(X.field,R2(U,Y,K[W]))}return J}function EQ(Z,Q,K){let J=new Map;for(let W of Z){let X=W.transform,U=K.data.field(W.field);J.set(W.field,M2(X,U,Q))}return J}class x7 extends i8{constructor(Z,Q){super(),this.key=Z,this.precondition=Q,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class $K extends i8{constructor(Z,Q){super(),this.key=Z,this.precondition=Q,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class UK{constructor(Z,Q,K,J){this.batchId=Z,this.localWriteTime=Q,this.baseMutations=K,this.mutations=J}applyToRemoteDocument(Z,Q){let K=Q.mutationResults;for(let J=0;J<this.mutations.length;J++){let W=this.mutations[J];if(W.key.isEqual(Z.key))I2(W,Z,K[J])}}applyToLocalView(Z,Q){for(let K of this.baseMutations)K.key.isEqual(Z.key)&&(Q=E8(K,Z,Q,this.localWriteTime));for(let K of this.mutations)K.key.isEqual(Z.key)&&(Q=E8(K,Z,Q,this.localWriteTime));return Q}applyToLocalDocumentSet(Z,Q){let K=e5();return this.mutations.forEach((J)=>{let W=Z.get(J.key),X=W.overlayedDocument,U=this.applyToLocalView(X,W.mutatedFields);U=Q.has(J.key)?null:U;let Y=WK(X,U);Y!==null&&K.set(J.key,Y),X.isValidDocument()||X.convertToNoDocument(m.min())}),K}keys(){return this.mutations.reduce((Z,Q)=>Z.add(Q.key),p())}isEqual(Z){return this.batchId===Z.batchId&&g6(this.mutations,Z.mutations,(Q,K)=>SQ(Q,K))&&g6(this.baseMutations,Z.baseMutations,(Q,K)=>SQ(Q,K))}}class y7{constructor(Z,Q,K,J){this.batch=Z,this.commitVersion=Q,this.mutationResults=K,this.docVersions=J}static from(Z,Q,K){o(Z.mutations.length===K.length,58842,{me:Z.mutations.length,fe:K.length});let J=function(){return w2}(),W=Z.mutations;for(let X=0;X<W.length;X++)J=J.insert(W[X].key,K[X].version);return new y7(Z,Q,K,J)}}class VK{constructor(Z,Q){this.largestBatchId=Z,this.mutation=Q}getKey(){return this.mutation.key}isEqual(Z){return Z!==null&&this.mutation===Z.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}class YK{constructor(Z,Q){this.count=Z,this.unchangedNames=Q}}var Q0,s;function j2(Z){switch(Z){case A.OK:return v(64938);case A.CANCELLED:case A.UNKNOWN:case A.DEADLINE_EXCEEDED:case A.RESOURCE_EXHAUSTED:case A.INTERNAL:case A.UNAVAILABLE:case A.UNAUTHENTICATED:return!1;case A.INVALID_ARGUMENT:case A.NOT_FOUND:case A.ALREADY_EXISTS:case A.PERMISSION_DENIED:case A.FAILED_PRECONDITION:case A.ABORTED:case A.OUT_OF_RANGE:case A.UNIMPLEMENTED:case A.DATA_LOSS:return!0;default:return v(15467,{code:Z})}}function zK(Z){if(Z===void 0)return d0("GRPC error has no .code"),A.UNKNOWN;switch(Z){case Q0.OK:return A.OK;case Q0.CANCELLED:return A.CANCELLED;case Q0.UNKNOWN:return A.UNKNOWN;case Q0.DEADLINE_EXCEEDED:return A.DEADLINE_EXCEEDED;case Q0.RESOURCE_EXHAUSTED:return A.RESOURCE_EXHAUSTED;case Q0.INTERNAL:return A.INTERNAL;case Q0.UNAVAILABLE:return A.UNAVAILABLE;case Q0.UNAUTHENTICATED:return A.UNAUTHENTICATED;case Q0.INVALID_ARGUMENT:return A.INVALID_ARGUMENT;case Q0.NOT_FOUND:return A.NOT_FOUND;case Q0.ALREADY_EXISTS:return A.ALREADY_EXISTS;case Q0.PERMISSION_DENIED:return A.PERMISSION_DENIED;case Q0.FAILED_PRECONDITION:return A.FAILED_PRECONDITION;case Q0.ABORTED:return A.ABORTED;case Q0.OUT_OF_RANGE:return A.OUT_OF_RANGE;case Q0.UNIMPLEMENTED:return A.UNIMPLEMENTED;case Q0.DATA_LOSS:return A.DATA_LOSS;default:return v(39323,{code:Z})}}(s=Q0||(Q0={}))[s.OK=0]="OK",s[s.CANCELLED=1]="CANCELLED",s[s.UNKNOWN=2]="UNKNOWN",s[s.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",s[s.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",s[s.NOT_FOUND=5]="NOT_FOUND",s[s.ALREADY_EXISTS=6]="ALREADY_EXISTS",s[s.PERMISSION_DENIED=7]="PERMISSION_DENIED",s[s.UNAUTHENTICATED=16]="UNAUTHENTICATED",s[s.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",s[s.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",s[s.ABORTED=10]="ABORTED",s[s.OUT_OF_RANGE=11]="OUT_OF_RANGE",s[s.UNIMPLEMENTED=12]="UNIMPLEMENTED",s[s.INTERNAL=13]="INTERNAL",s[s.UNAVAILABLE=14]="UNAVAILABLE",s[s.DATA_LOSS=15]="DATA_LOSS";var _2=null;function A2(){return new TextEncoder}var S2=new l0([4294967295,4294967295],0);function LQ(Z){let Q=A2().encode(Z),K=new u9;return K.update(Q),new Uint8Array(K.digest())}function xQ(Z){let Q=new DataView(Z.buffer),K=Q.getUint32(0,!0),J=Q.getUint32(4,!0),W=Q.getUint32(8,!0),X=Q.getUint32(12,!0);return[new l0([K,J],0),new l0([W,X],0)]}class C7{constructor(Z,Q,K){if(this.bitmap=Z,this.padding=Q,this.hashCount=K,Q<0||Q>=8)throw new h6(`Invalid padding: ${Q}`);if(K<0)throw new h6(`Invalid hash count: ${K}`);if(Z.length>0&&this.hashCount===0)throw new h6(`Invalid hash count: ${K}`);if(Z.length===0&&Q!==0)throw new h6(`Invalid padding when bitmap length is 0: ${Q}`);this.ge=8*Z.length-Q,this.pe=l0.fromNumber(this.ge)}ye(Z,Q,K){let J=Z.add(Q.multiply(l0.fromNumber(K)));return J.compare(S2)===1&&(J=new l0([J.getBits(0),J.getBits(1)],0)),J.modulo(this.pe).toNumber()}we(Z){return!!(this.bitmap[Math.floor(Z/8)]&1<<Z%8)}mightContain(Z){if(this.ge===0)return!1;let Q=LQ(Z),[K,J]=xQ(Q);for(let W=0;W<this.hashCount;W++){let X=this.ye(K,J,W);if(!this.we(X))return!1}return!0}static create(Z,Q,K){let J=Z%8==0?0:8-Z%8,W=new Uint8Array(Math.ceil(Z/8)),X=new C7(W,J,Q);return K.forEach((U)=>X.insert(U)),X}insert(Z){if(this.ge===0)return;let Q=LQ(Z),[K,J]=xQ(Q);for(let W=0;W<this.hashCount;W++){let X=this.ye(K,J,W);this.Se(X)}}Se(Z){let Q=Math.floor(Z/8),K=Z%8;this.bitmap[Q]|=1<<K}}class h6 extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class g1{constructor(Z,Q,K,J,W){this.snapshotVersion=Z,this.targetChanges=Q,this.targetMismatches=K,this.documentUpdates=J,this.resolvedLimboDocuments=W}static createSynthesizedRemoteEventForCurrentChange(Z,Q,K){let J=new Map;return J.set(Z,d8.createSynthesizedTargetChangeForCurrentChange(Z,Q,K)),new g1(m.min(),J,new a(g),t0(),p())}}class d8{constructor(Z,Q,K,J,W){this.resumeToken=Z,this.current=Q,this.addedDocuments=K,this.modifiedDocuments=J,this.removedDocuments=W}static createSynthesizedTargetChangeForCurrentChange(Z,Q,K){return new d8(K,Q,p(),p(),p())}}class L8{constructor(Z,Q,K,J){this.be=Z,this.removedTargetIds=Q,this.key=K,this.De=J}}class k7{constructor(Z,Q){this.targetId=Z,this.Ce=Q}}class h7{constructor(Z,Q,K=H0.EMPTY_BYTE_STRING,J=null){this.state=Z,this.targetIds=Q,this.resumeToken=K,this.cause=J}}class J7{constructor(){this.ve=0,this.Fe=yQ(),this.Me=H0.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return this.ve!==0}get Be(){return this.Oe}Le(Z){Z.approximateByteSize()>0&&(this.Oe=!0,this.Me=Z)}ke(){let Z=p(),Q=p(),K=p();return this.Fe.forEach((J,W)=>{switch(W){case 0:Z=Z.add(J);break;case 2:Q=Q.add(J);break;case 1:K=K.add(J);break;default:v(38017,{changeType:W})}}),new d8(this.Me,this.xe,Z,Q,K)}qe(){this.Oe=!1,this.Fe=yQ()}Qe(Z,Q){this.Oe=!0,this.Fe=this.Fe.insert(Z,Q)}$e(Z){this.Oe=!0,this.Fe=this.Fe.remove(Z)}Ue(){this.ve+=1}Ke(){this.ve-=1,o(this.ve>=0,3241,{ve:this.ve})}We(){this.Oe=!0,this.xe=!0}}class HK{constructor(Z){this.Ge=Z,this.ze=new Map,this.je=t0(),this.Je=I1(),this.He=I1(),this.Ye=new a(g)}Ze(Z){for(let Q of Z.be)Z.De&&Z.De.isFoundDocument()?this.Xe(Q,Z.De):this.et(Q,Z.key,Z.De);for(let Q of Z.removedTargetIds)this.et(Q,Z.key,Z.De)}tt(Z){this.forEachTarget(Z,(Q)=>{let K=this.nt(Q);switch(Z.state){case 0:this.rt(Q)&&K.Le(Z.resumeToken);break;case 1:K.Ke(),K.Ne||K.qe(),K.Le(Z.resumeToken);break;case 2:K.Ke(),K.Ne||this.removeTarget(Q);break;case 3:this.rt(Q)&&(K.We(),K.Le(Z.resumeToken));break;case 4:this.rt(Q)&&(this.it(Q),K.Le(Z.resumeToken));break;default:v(56790,{state:Z.state})}})}forEachTarget(Z,Q){Z.targetIds.length>0?Z.targetIds.forEach(Q):this.ze.forEach((K,J)=>{this.rt(J)&&Q(J)})}st(Z){let Q=Z.targetId,K=Z.Ce.count,J=this.ot(Q);if(J){let W=J.target;if(Q7(W))if(K===0){let X=new h(W.path);this.et(Q,X,q0.newNoDocument(X,m.min()))}else o(K===1,20013,{expectedCount:K});else{let X=this._t(Q);if(X!==K){let U=this.ut(Z),Y=U?this.ct(U,Z,X):1;if(Y!==0){this.it(Q);let z=Y===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ye=this.Ye.insert(Q,z)}_2?.lt(function(P,F,j,I,T){let C={localCacheCount:P,existenceFilterCount:F.count,databaseId:j.database,projectId:j.projectId},x=F.unchangedNames;return x&&(C.bloomFilter={applied:T===0,hashCount:x?.hashCount??0,bitmapLength:x?.bits?.bitmap?.length??0,padding:x?.bits?.padding??0,mightContain:(k)=>I?.mightContain(k)??!1}),C}(X,Z.Ce,this.Ge.ht(),U,Y))}}}}ut(Z){let Q=Z.Ce.unchangedNames;if(!Q||!Q.bits)return null;let{bits:{bitmap:K="",padding:J=0},hashCount:W=0}=Q,X,U;try{X=n0(K).toUint8Array()}catch(Y){if(Y instanceof I7)return f6("Decoding the base64 bloom filter in existence filter failed ("+Y.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw Y}try{U=new C7(X,J,W)}catch(Y){return f6(Y instanceof h6?"BloomFilter error: ":"Applying bloom filter failed: ",Y),null}return U.ge===0?null:U}ct(Z,Q,K){return Q.Ce.count===K-this.Pt(Z,Q.targetId)?0:2}Pt(Z,Q){let K=this.Ge.getRemoteKeysForTarget(Q),J=0;return K.forEach((W)=>{let X=this.Ge.ht(),U=`projects/${X.projectId}/databases/${X.database}/documents/${W.path.canonicalString()}`;Z.mightContain(U)||(this.et(Q,W,null),J++)}),J}Tt(Z){let Q=new Map;this.ze.forEach((W,X)=>{let U=this.ot(X);if(U){if(W.current&&Q7(U.target)){let Y=new h(U.target.path);this.It(Y).has(X)||this.Et(X,Y)||this.et(X,Y,q0.newNoDocument(Y,Z))}W.Be&&(Q.set(X,W.ke()),W.qe())}});let K=p();this.He.forEach((W,X)=>{let U=!0;X.forEachWhile((Y)=>{let z=this.ot(Y);return!z||z.purpose==="TargetPurposeLimboResolution"||(U=!1,!1)}),U&&(K=K.add(W))}),this.je.forEach((W,X)=>X.setReadTime(Z));let J=new g1(Z,Q,this.Ye,this.je,K);return this.je=t0(),this.Je=I1(),this.He=I1(),this.Ye=new a(g),J}Xe(Z,Q){if(!this.rt(Z))return;let K=this.Et(Z,Q.key)?2:0;this.nt(Z).Qe(Q.key,K),this.je=this.je.insert(Q.key,Q),this.Je=this.Je.insert(Q.key,this.It(Q.key).add(Z)),this.He=this.He.insert(Q.key,this.dt(Q.key).add(Z))}et(Z,Q,K){if(!this.rt(Z))return;let J=this.nt(Z);this.Et(Z,Q)?J.Qe(Q,1):J.$e(Q),this.He=this.He.insert(Q,this.dt(Q).delete(Z)),this.He=this.He.insert(Q,this.dt(Q).add(Z)),K&&(this.je=this.je.insert(Q,K))}removeTarget(Z){this.ze.delete(Z)}_t(Z){let Q=this.nt(Z).ke();return this.Ge.getRemoteKeysForTarget(Z).size+Q.addedDocuments.size-Q.removedDocuments.size}Ue(Z){this.nt(Z).Ue()}nt(Z){let Q=this.ze.get(Z);return Q||(Q=new J7,this.ze.set(Z,Q)),Q}dt(Z){let Q=this.He.get(Z);return Q||(Q=new $0(g),this.He=this.He.insert(Z,Q)),Q}It(Z){let Q=this.Je.get(Z);return Q||(Q=new $0(g),this.Je=this.Je.insert(Z,Q)),Q}rt(Z){let Q=this.ot(Z)!==null;return Q||y("WatchChangeAggregator","Detected inactive target",Z),Q}ot(Z){let Q=this.ze.get(Z);return Q&&Q.Ne?null:this.Ge.At(Z)}it(Z){this.ze.set(Z,new J7),this.Ge.getRemoteKeysForTarget(Z).forEach((Q)=>{this.et(Z,Q,null)})}Et(Z,Q){return this.Ge.getRemoteKeysForTarget(Z).has(Q)}}function I1(){return new a(h.comparator)}function yQ(){return new a(h.comparator)}var T2=(()=>{return{asc:"ASCENDING",desc:"DESCENDING"}})(),E2=(()=>{return{"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"}})(),L2=(()=>{return{and:"AND",or:"OR"}})();class PK{constructor(Z,Q){this.databaseId=Z,this.useProto3Json=Q}}function G7(Z,Q){return Z.useProto3Json||v1(Q)?Q:{value:Q}}function E1(Z,Q){if(Z.useProto3Json)return`${new Date(1000*Q.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+Q.nanoseconds).slice(-9)}Z`;return{seconds:""+Q.seconds,nanos:Q.nanoseconds}}function wK(Z,Q){return Z.useProto3Json?Q.toBase64():Q.toUint8Array()}function x2(Z,Q){return E1(Z,Q.toTimestamp())}function v0(Z){return o(!!Z,49232),m.fromTimestamp(function(K){let J=o0(K);return new c(J.seconds,J.nanos)}(Z))}function v7(Z,Q){return W7(Z,Q).canonicalString()}function W7(Z,Q){let K=function(W){return new r(["projects",W.projectId,"databases",W.database])}(Z).child("documents");return Q===void 0?K:K.child(Q)}function BK(Z){let Q=r.fromString(Z);return o(RK(Q),10190,{key:Q.toString()}),Q}function X7(Z,Q){return v7(Z.databaseId,Q.path)}function d9(Z,Q){let K=BK(Q);if(K.get(1)!==Z.databaseId.projectId)throw new L(A.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+K.get(1)+" vs "+Z.databaseId.projectId);if(K.get(3)!==Z.databaseId.database)throw new L(A.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+K.get(3)+" vs "+Z.databaseId.database);return new h(FK(K))}function qK(Z,Q){return v7(Z.databaseId,Q)}function y2(Z){let Q=BK(Z);return Q.length===4?r.emptyPath():FK(Q)}function $7(Z){return new r(["projects",Z.databaseId.projectId,"databases",Z.databaseId.database]).canonicalString()}function FK(Z){return o(Z.length>4&&Z.get(4)==="documents",29091,{key:Z.toString()}),Z.popFirst(5)}function CQ(Z,Q,K){return{name:X7(Z,Q),fields:K.value.mapValue.fields}}function C2(Z,Q){let K;if("targetChange"in Q){Q.targetChange;let J=function(P){return P==="NO_CHANGE"?0:P==="ADD"?1:P==="REMOVE"?2:P==="CURRENT"?3:P==="RESET"?4:v(39313,{state:P})}(Q.targetChange.targetChangeType||"NO_CHANGE"),W=Q.targetChange.targetIds||[],X=function(P,F){return P.useProto3Json?(o(F===void 0||typeof F=="string",58123),H0.fromBase64String(F||"")):(o(F===void 0||F instanceof Buffer||F instanceof Uint8Array,16193),H0.fromUint8Array(F||new Uint8Array))}(Z,Q.targetChange.resumeToken),U=Q.targetChange.cause,Y=U&&function(P){let F=P.code===void 0?A.UNKNOWN:zK(P.code);return new L(F,P.message||"")}(U);K=new h7(J,W,X,Y||null)}else if("documentChange"in Q){Q.documentChange;let J=Q.documentChange;J.document,J.document.name,J.document.updateTime;let W=d9(Z,J.document.name),X=v0(J.document.updateTime),U=J.document.createTime?v0(J.document.createTime):m.min(),Y=new I0({mapValue:{fields:J.document.fields}}),z=q0.newFoundDocument(W,X,U,Y),P=J.targetIds||[],F=J.removedTargetIds||[];K=new L8(P,F,z.key,z)}else if("documentDelete"in Q){Q.documentDelete;let J=Q.documentDelete;J.document;let W=d9(Z,J.document),X=J.readTime?v0(J.readTime):m.min(),U=q0.newNoDocument(W,X),Y=J.removedTargetIds||[];K=new L8([],Y,U.key,U)}else if("documentRemove"in Q){Q.documentRemove;let J=Q.documentRemove;J.document;let W=d9(Z,J.document),X=J.removedTargetIds||[];K=new L8([],X,W,null)}else{if(!("filter"in Q))return v(11601,{Rt:Q});{Q.filter;let J=Q.filter;J.targetId;let{count:W=0,unchangedNames:X}=J,U=new YK(W,X),Y=J.targetId;K=new k7(Y,U)}}return K}function k2(Z,Q){let K;if(Q instanceof a6)K={update:CQ(Z,Q.key,Q.value)};else if(Q instanceof x7)K={delete:X7(Z,Q.key)};else if(Q instanceof r0)K={update:CQ(Z,Q.key,Q.data),updateMask:s2(Q.fieldMask)};else{if(!(Q instanceof $K))return v(16599,{Vt:Q.type});K={verify:X7(Z,Q.key)}}return Q.fieldTransforms.length>0&&(K.updateTransforms=Q.fieldTransforms.map((J)=>function(X,U){let Y=U.transform;if(Y instanceof u8)return{fieldPath:U.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(Y instanceof o6)return{fieldPath:U.field.canonicalString(),appendMissingElements:{values:Y.elements}};if(Y instanceof n6)return{fieldPath:U.field.canonicalString(),removeAllFromArray:{values:Y.elements}};if(Y instanceof f8)return{fieldPath:U.field.canonicalString(),increment:Y.Ae};throw v(20930,{transform:U.transform})}(0,J))),Q.precondition.isNone||(K.currentDocument=function(W,X){return X.updateTime!==void 0?{updateTime:x2(W,X.updateTime)}:X.exists!==void 0?{exists:X.exists}:v(27497)}(Z,Q.precondition)),K}function h2(Z,Q){return Z&&Z.length>0?(o(Q!==void 0,14353),Z.map((K)=>function(W,X){let U=W.updateTime?v0(W.updateTime):v0(X);return U.isEqual(m.min())&&(U=v0(X)),new GK(U,W.transformResults||[])}(K,Q))):[]}function v2(Z,Q){return{documents:[qK(Z,Q.path)]}}function m2(Z,Q){let K={structuredQuery:{}},J=Q.path,W;Q.collectionGroup!==null?(W=J,K.structuredQuery.from=[{collectionId:Q.collectionGroup,allDescendants:!0}]):(W=J.popLast(),K.structuredQuery.from=[{collectionId:J.lastSegment()}]),K.parent=qK(Z,W);let X=function(P){if(P.length===0)return;return MK(T0.create(P,"and"))}(Q.filters);X&&(K.structuredQuery.where=X);let U=function(P){if(P.length===0)return;return P.map((F)=>function(I){return{field:C6(I.field),direction:g2(I.dir)}}(F))}(Q.orderBy);U&&(K.structuredQuery.orderBy=U);let Y=G7(Z,Q.limit);return Y!==null&&(K.structuredQuery.limit=Y),Q.startAt&&(K.structuredQuery.startAt=function(P){return{before:P.inclusive,values:P.position}}(Q.startAt)),Q.endAt&&(K.structuredQuery.endAt=function(P){return{before:!P.inclusive,values:P.position}}(Q.endAt)),{ft:K,parent:W}}function u2(Z){let Q=y2(Z.parent),K=Z.structuredQuery,J=K.from?K.from.length:0,W=null;if(J>0){o(J===1,65062);let F=K.from[0];F.allDescendants?W=F.collectionId:Q=Q.child(F.collectionId)}let X=[];K.where&&(X=function(j){let I=DK(j);if(I instanceof T0&&k5(I))return I.getFilters();return[I]}(K.where));let U=[];K.orderBy&&(U=function(j){return j.map((I)=>function(C){return new d6(k6(C.field),function(k){switch(k){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(C.direction))}(I))}(K.orderBy));let Y=null;K.limit&&(Y=function(j){let I;return I=typeof j=="object"?j.value:j,v1(I)?null:I}(K.limit));let z=null;K.startAt&&(z=function(j){let I=!!j.before,T=j.values||[];return new m8(T,I)}(K.startAt));let P=null;return K.endAt&&(P=function(j){let I=!j.before,T=j.values||[];return new m8(T,I)}(K.endAt)),V2(Q,W,U,X,Y,"F",z,P)}function f2(Z,Q){let K=function(W){switch(W){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return v(28987,{purpose:W})}}(Q.purpose);return K==null?null:{"goog-listen-tags":K}}function DK(Z){return Z.unaryFilter!==void 0?function(K){switch(K.unaryFilter.op){case"IS_NAN":let J=k6(K.unaryFilter.field);return K0.create(J,"==",{doubleValue:NaN});case"IS_NULL":let W=k6(K.unaryFilter.field);return K0.create(W,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":let X=k6(K.unaryFilter.field);return K0.create(X,"!=",{doubleValue:NaN});case"IS_NOT_NULL":let U=k6(K.unaryFilter.field);return K0.create(U,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return v(61313);default:return v(60726)}}(Z):Z.fieldFilter!==void 0?function(K){return K0.create(k6(K.fieldFilter.field),function(W){switch(W){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return v(58110);default:return v(50506)}}(K.fieldFilter.op),K.fieldFilter.value)}(Z):Z.compositeFilter!==void 0?function(K){return T0.create(K.compositeFilter.filters.map((J)=>DK(J)),function(W){switch(W){case"AND":return"and";case"OR":return"or";default:return v(1026)}}(K.compositeFilter.op))}(Z):v(30097,{filter:Z})}function g2(Z){return T2[Z]}function p2(Z){return E2[Z]}function l2(Z){return L2[Z]}function C6(Z){return{fieldPath:Z.canonicalString()}}function k6(Z){return z0.fromServerFormat(Z.fieldPath)}function MK(Z){return Z instanceof K0?function(K){if(K.op==="=="){if(NQ(K.value))return{unaryFilter:{field:C6(K.field),op:"IS_NAN"}};if(RQ(K.value))return{unaryFilter:{field:C6(K.field),op:"IS_NULL"}}}else if(K.op==="!="){if(NQ(K.value))return{unaryFilter:{field:C6(K.field),op:"IS_NOT_NAN"}};if(RQ(K.value))return{unaryFilter:{field:C6(K.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:C6(K.field),op:p2(K.op),value:K.value}}}(Z):Z instanceof T0?function(K){let J=K.getFilters().map((W)=>MK(W));if(J.length===1)return J[0];return{compositeFilter:{op:l2(K.op),filters:J}}}(Z):v(54877,{filter:Z})}function s2(Z){let Q=[];return Z.fields.forEach((K)=>Q.push(K.canonicalString())),{fieldPaths:Q}}function RK(Z){return Z.length>=4&&Z.get(0)==="projects"&&Z.get(2)==="databases"}class X6{constructor(Z,Q,K,J,W=m.min(),X=m.min(),U=H0.EMPTY_BYTE_STRING,Y=null){this.target=Z,this.targetId=Q,this.purpose=K,this.sequenceNumber=J,this.snapshotVersion=W,this.lastLimboFreeSnapshotVersion=X,this.resumeToken=U,this.expectedCount=Y}withSequenceNumber(Z){return new X6(this.target,this.targetId,this.purpose,Z,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(Z,Q){return new X6(this.target,this.targetId,this.purpose,this.sequenceNumber,Q,this.lastLimboFreeSnapshotVersion,Z,null)}withExpectedCount(Z){return new X6(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,Z)}withLastLimboFreeSnapshotVersion(Z){return new X6(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,Z,this.resumeToken,this.expectedCount)}}class NK{constructor(Z){this.yt=Z}}function i2(Z){let Q=u2({parent:Z.parent,structuredQuery:Z.structuredQuery});return Z.limitType==="LAST"?T1(Q,Q.limit,"L"):Q}class U7{constructor(){}Dt(Z,Q){this.Ct(Z,Q),Q.vt()}Ct(Z,Q){if("nullValue"in Z)this.Ft(Q,5);else if("booleanValue"in Z)this.Ft(Q,10),Q.Mt(Z.booleanValue?1:0);else if("integerValue"in Z)this.Ft(Q,15),Q.Mt(e(Z.integerValue));else if("doubleValue"in Z){let K=e(Z.doubleValue);isNaN(K)?this.Ft(Q,13):(this.Ft(Q,15),C8(K)?Q.Mt(0):Q.Mt(K))}else if("timestampValue"in Z){let K=Z.timestampValue;this.Ft(Q,20),typeof K=="string"&&(K=o0(K)),Q.xt(`${K.seconds||""}`),Q.Mt(K.nanos||0)}else if("stringValue"in Z)this.Ot(Z.stringValue,Q),this.Nt(Q);else if("bytesValue"in Z)this.Ft(Q,30),Q.Bt(n0(Z.bytesValue)),this.Nt(Q);else if("referenceValue"in Z)this.Lt(Z.referenceValue,Q);else if("geoPointValue"in Z){let K=Z.geoPointValue;this.Ft(Q,45),Q.Mt(K.latitude||0),Q.Mt(K.longitude||0)}else"mapValue"in Z?x5(Z)?this.Ft(Q,Number.MAX_SAFE_INTEGER):L5(Z)?this.kt(Z.mapValue,Q):(this.qt(Z.mapValue,Q),this.Nt(Q)):("arrayValue"in Z)?(this.Qt(Z.arrayValue,Q),this.Nt(Q)):v(19022,{$t:Z})}Ot(Z,Q){this.Ft(Q,25),this.Ut(Z,Q)}Ut(Z,Q){Q.xt(Z)}qt(Z,Q){let K=Z.fields||{};this.Ft(Q,55);for(let J of Object.keys(K))this.Ot(J,Q),this.Ct(K[J],Q)}kt(Z,Q){let K=Z.fields||{};this.Ft(Q,53);let J=l6,W=K[J].arrayValue?.values?.length||0;this.Ft(Q,15),Q.Mt(e(W)),this.Ot(J,Q),this.Ct(K[J],Q)}Qt(Z,Q){let K=Z.values||[];this.Ft(Q,50);for(let J of K)this.Ct(J,Q)}Lt(Z,Q){this.Ft(Q,37),h.fromName(Z).path.forEach((K)=>{this.Ft(Q,60),this.Ut(K,Q)})}Ft(Z,Q){Z.Mt(Q)}Nt(Z){Z.Mt(2)}}U7.Kt=new U7;class IK{constructor(){this.Cn=new OK}addToCollectionParentIndex(Z,Q){return this.Cn.add(Q),S.resolve()}getCollectionParents(Z,Q){return S.resolve(this.Cn.getEntries(Q))}addFieldIndex(Z,Q){return S.resolve()}deleteFieldIndex(Z,Q){return S.resolve()}deleteAllFieldIndexes(Z){return S.resolve()}createTargetIndexes(Z,Q){return S.resolve()}getDocumentsMatchingTarget(Z,Q){return S.resolve(null)}getIndexType(Z,Q){return S.resolve(0)}getFieldIndexes(Z,Q){return S.resolve([])}getNextCollectionGroupToUpdate(Z){return S.resolve(null)}getMinOffset(Z,Q){return S.resolve(U6.min())}getMinOffsetFromCollectionGroup(Z,Q){return S.resolve(U6.min())}updateCollectionGroup(Z,Q,K){return S.resolve()}updateIndexEntries(Z,Q){return S.resolve()}}class OK{constructor(){this.index={}}add(Z){let Q=Z.lastSegment(),K=Z.popLast(),J=this.index[Q]||new $0(r.comparator),W=!J.has(K);return this.index[Q]=J.add(K),W}has(Z){let Q=Z.lastSegment(),K=Z.popLast(),J=this.index[Q];return J&&J.has(K)}getEntries(Z){return(this.index[Z]||new $0(r.comparator)).toArray()}}var CX=new Uint8Array(0);var kQ={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},jK=41943040;class N0{static withCacheSize(Z){return new N0(Z,N0.DEFAULT_COLLECTION_PERCENTILE,N0.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(Z,Q,K){this.cacheSizeCollectionThreshold=Z,this.percentileToCollect=Q,this.maximumSequenceNumbersToCollect=K}}N0.DEFAULT_COLLECTION_PERCENTILE=10,N0.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1000,N0.DEFAULT=new N0(jK,N0.DEFAULT_COLLECTION_PERCENTILE,N0.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),N0.DISABLED=new N0(-1,0,0);class t6{constructor(Z){this.ar=Z}next(){return this.ar+=2,this.ar}static ur(){return new t6(0)}static cr(){return new t6(-1)}}var hQ="LruGarbageCollector",d2=1048576;function vQ([Z,Q],[K,J]){let W=g(Z,K);return W===0?g(Q,J):W}class _K{constructor(Z){this.Ir=Z,this.buffer=new $0(vQ),this.Er=0}dr(){return++this.Er}Ar(Z){let Q=[Z,this.dr()];if(this.buffer.size<this.Ir)this.buffer=this.buffer.add(Q);else{let K=this.buffer.last();vQ(Q,K)<0&&(this.buffer=this.buffer.delete(K).add(Q))}}get maxValue(){return this.buffer.last()[0]}}class AK{constructor(Z,Q,K){this.garbageCollector=Z,this.asyncQueue=Q,this.localStore=K,this.Rr=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Vr(60000)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return this.Rr!==null}Vr(Z){y(hQ,`Garbage collection scheduled in ${Z}ms`),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",Z,async()=>{this.Rr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(Q){e6(Q)?y(hQ,"Ignoring IndexedDB error during garbage collection: ",Q):await c6(Q)}await this.Vr(300000)})}}class SK{constructor(Z,Q){this.mr=Z,this.params=Q}calculateTargetCount(Z,Q){return this.mr.gr(Z).next((K)=>Math.floor(Q/100*K))}nthSequenceNumber(Z,Q){if(Q===0)return S.resolve(l8.ce);let K=new _K(Q);return this.mr.forEachTarget(Z,(J)=>K.Ar(J.sequenceNumber)).next(()=>this.mr.pr(Z,(J)=>K.Ar(J))).next(()=>K.maxValue)}removeTargets(Z,Q,K){return this.mr.removeTargets(Z,Q,K)}removeOrphanedDocuments(Z,Q){return this.mr.removeOrphanedDocuments(Z,Q)}collect(Z,Q){return this.params.cacheSizeCollectionThreshold===-1?(y("LruGarbageCollector","Garbage collection skipped; disabled"),S.resolve(kQ)):this.getCacheSize(Z).next((K)=>K<this.params.cacheSizeCollectionThreshold?(y("LruGarbageCollector",`Garbage collection skipped; Cache size ${K} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),kQ):this.yr(Z,Q))}getCacheSize(Z){return this.mr.getCacheSize(Z)}yr(Z,Q){let K,J,W,X,U,Y,z,P=Date.now();return this.calculateTargetCount(Z,this.params.percentileToCollect).next((F)=>(F>this.params.maximumSequenceNumbersToCollect?(y("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${F}`),J=this.params.maximumSequenceNumbersToCollect):J=F,X=Date.now(),this.nthSequenceNumber(Z,J))).next((F)=>(K=F,U=Date.now(),this.removeTargets(Z,K,Q))).next((F)=>(W=F,Y=Date.now(),this.removeOrphanedDocuments(Z,K))).next((F)=>{if(z=Date.now(),x6()<=l.DEBUG)y("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${X-P}ms
	Determined least recently used ${J} in `+(U-X)+`ms
	Removed ${W} targets in `+(Y-U)+`ms
	Removed ${F} documents in `+(z-Y)+`ms
Total Duration: ${z-P}ms`);return S.resolve({didRun:!0,sequenceNumbersCollected:J,targetsRemoved:W,documentsRemoved:F})})}}function o2(Z,Q){return new SK(Z,Q)}class TK{constructor(){this.changes=new P6((Z)=>Z.toString(),(Z,Q)=>Z.isEqual(Q)),this.changesApplied=!1}addEntry(Z){this.assertNotApplied(),this.changes.set(Z.key,Z)}removeEntry(Z,Q){this.assertNotApplied(),this.changes.set(Z,q0.newInvalidDocument(Z).setReadTime(Q))}getEntry(Z,Q){this.assertNotApplied();let K=this.changes.get(Q);return K!==void 0?S.resolve(K):this.getFromCache(Z,Q)}getEntries(Z,Q){return this.getAllFromCache(Z,Q)}apply(Z){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(Z)}assertNotApplied(){}}class EK{constructor(Z,Q){this.overlayedDocument=Z,this.mutatedFields=Q}}class LK{constructor(Z,Q,K,J){this.remoteDocumentCache=Z,this.mutationQueue=Q,this.documentOverlayCache=K,this.indexManager=J}getDocument(Z,Q){let K=null;return this.documentOverlayCache.getOverlay(Z,Q).next((J)=>(K=J,this.remoteDocumentCache.getEntry(Z,Q))).next((J)=>(K!==null&&E8(K.mutation,J,_0.empty(),c.now()),J))}getDocuments(Z,Q){return this.remoteDocumentCache.getEntries(Z,Q).next((K)=>this.getLocalViewOfDocuments(Z,K,p()).next(()=>K))}getLocalViewOfDocuments(Z,Q,K=p()){let J=N6();return this.populateOverlays(Z,J,Q).next(()=>this.computeViews(Z,Q,J,K).next((W)=>{let X=j8();return W.forEach((U,Y)=>{X=X.insert(U,Y.overlayedDocument)}),X}))}getOverlayedDocuments(Z,Q){let K=N6();return this.populateOverlays(Z,K,Q).next(()=>this.computeViews(Z,Q,K,p()))}populateOverlays(Z,Q,K){let J=[];return K.forEach((W)=>{Q.has(W)||J.push(W)}),this.documentOverlayCache.getOverlays(Z,J).next((W)=>{W.forEach((X,U)=>{Q.set(X,U)})})}computeViews(Z,Q,K,J){let W=t0(),X=T8(),U=function(){return T8()}();return Q.forEach((Y,z)=>{let P=K.get(z.key);J.has(z.key)&&(P===void 0||P.mutation instanceof r0)?W=W.insert(z.key,z):P!==void 0?(X.set(z.key,P.mutation.getFieldMask()),E8(P.mutation,z,P.mutation.getFieldMask(),c.now())):X.set(z.key,_0.empty())}),this.recalculateAndSaveOverlays(Z,W).next((Y)=>(Y.forEach((z,P)=>X.set(z,P)),Q.forEach((z,P)=>U.set(z,new EK(P,X.get(z)??null))),U))}recalculateAndSaveOverlays(Z,Q){let K=T8(),J=new a((X,U)=>X-U),W=p();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(Z,Q).next((X)=>{for(let U of X)U.keys().forEach((Y)=>{let z=Q.get(Y);if(z===null)return;let P=K.get(Y)||_0.empty();P=U.applyToLocalView(z,P),K.set(Y,P);let F=(J.get(U.batchId)||p()).add(Y);J=J.insert(U.batchId,F)})}).next(()=>{let X=[],U=J.getReverseIterator();for(;U.hasNext();){let Y=U.getNext(),z=Y.key,P=Y.value,F=e5();P.forEach((j)=>{if(!W.has(j)){let I=WK(Q.get(j),K.get(j));I!==null&&F.set(j,I),W=W.add(j)}}),X.push(this.documentOverlayCache.saveOverlays(Z,z,F))}return S.waitFor(X)}).next(()=>K)}recalculateAndSaveOverlaysForDocumentKeys(Z,Q){return this.remoteDocumentCache.getEntries(Z,Q).next((K)=>this.recalculateAndSaveOverlays(Z,K))}getDocumentsMatchingQuery(Z,Q,K,J){return function(X){return h.isDocumentKey(X.path)&&X.collectionGroup===null&&X.filters.length===0}(Q)?this.getDocumentsMatchingDocumentQuery(Z,Q.path):n5(Q)?this.getDocumentsMatchingCollectionGroupQuery(Z,Q,K,J):this.getDocumentsMatchingCollectionQuery(Z,Q,K,J)}getNextDocuments(Z,Q,K,J){return this.remoteDocumentCache.getAllFromCollectionGroup(Z,Q,K,J).next((W)=>{let X=J-W.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(Z,Q,K.largestBatchId,J-W.size):S.resolve(N6()),U=y8,Y=W;return X.next((z)=>S.forEach(z,(P,F)=>(U<F.largestBatchId&&(U=F.largestBatchId),W.get(P)?S.resolve():this.remoteDocumentCache.getEntry(Z,P).next((j)=>{Y=Y.insert(P,j)}))).next(()=>this.populateOverlays(Z,z,W)).next(()=>this.computeViews(Z,Y,z,p())).next((P)=>({batchId:U,changes:c5(P)})))})}getDocumentsMatchingDocumentQuery(Z,Q){return this.getDocument(Z,new h(Q)).next((K)=>{let J=j8();return K.isFoundDocument()&&(J=J.insert(K.key,K)),J})}getDocumentsMatchingCollectionGroupQuery(Z,Q,K,J){let W=Q.collectionGroup,X=j8();return this.indexManager.getCollectionParents(Z,W).next((U)=>S.forEach(U,(Y)=>{let z=function(F,j){return new j6(j,null,F.explicitOrderBy.slice(),F.filters.slice(),F.limit,F.limitType,F.startAt,F.endAt)}(Q,Y.child(W));return this.getDocumentsMatchingCollectionQuery(Z,z,K,J).next((P)=>{P.forEach((F,j)=>{X=X.insert(F,j)})})}).next(()=>X))}getDocumentsMatchingCollectionQuery(Z,Q,K,J){let W;return this.documentOverlayCache.getOverlaysForCollection(Z,Q.path,K.largestBatchId).next((X)=>(W=X,this.remoteDocumentCache.getDocumentsMatchingQuery(Z,Q,K,W,J))).next((X)=>{W.forEach((Y,z)=>{let P=z.getKey();X.get(P)===null&&(X=X.insert(P,q0.newInvalidDocument(P)))});let U=j8();return X.forEach((Y,z)=>{let P=W.get(Y);P!==void 0&&E8(P.mutation,z,_0.empty(),c.now()),f1(Q,z)&&(U=U.insert(Y,z))}),U})}}class xK{constructor(Z){this.serializer=Z,this.Lr=new Map,this.kr=new Map}getBundleMetadata(Z,Q){return S.resolve(this.Lr.get(Q))}saveBundleMetadata(Z,Q){return this.Lr.set(Q.id,function(J){return{id:J.id,version:J.version,createTime:v0(J.createTime)}}(Q)),S.resolve()}getNamedQuery(Z,Q){return S.resolve(this.kr.get(Q))}saveNamedQuery(Z,Q){return this.kr.set(Q.name,function(J){return{name:J.name,query:i2(J.bundledQuery),readTime:v0(J.readTime)}}(Q)),S.resolve()}}class yK{constructor(){this.overlays=new a(h.comparator),this.qr=new Map}getOverlay(Z,Q){return S.resolve(this.overlays.get(Q))}getOverlays(Z,Q){let K=N6();return S.forEach(Q,(J)=>this.getOverlay(Z,J).next((W)=>{W!==null&&K.set(J,W)})).next(()=>K)}saveOverlays(Z,Q,K){return K.forEach((J,W)=>{this.St(Z,Q,W)}),S.resolve()}removeOverlaysForBatchId(Z,Q,K){let J=this.qr.get(K);return J!==void 0&&(J.forEach((W)=>this.overlays=this.overlays.remove(W)),this.qr.delete(K)),S.resolve()}getOverlaysForCollection(Z,Q,K){let J=N6(),W=Q.length+1,X=new h(Q.child("")),U=this.overlays.getIteratorFrom(X);for(;U.hasNext();){let Y=U.getNext().value,z=Y.getKey();if(!Q.isPrefixOf(z.path))break;z.path.length===W&&(Y.largestBatchId>K&&J.set(Y.getKey(),Y))}return S.resolve(J)}getOverlaysForCollectionGroup(Z,Q,K,J){let W=new a((z,P)=>z-P),X=this.overlays.getIterator();for(;X.hasNext();){let z=X.getNext().value;if(z.getKey().getCollectionGroup()===Q&&z.largestBatchId>K){let P=W.get(z.largestBatchId);P===null&&(P=N6(),W=W.insert(z.largestBatchId,P)),P.set(z.getKey(),z)}}let U=N6(),Y=W.getIterator();for(;Y.hasNext();)if(Y.getNext().value.forEach((z,P)=>U.set(z,P)),U.size()>=J)break;return S.resolve(U)}St(Z,Q,K){let J=this.overlays.get(K.key);if(J!==null){let X=this.qr.get(J.largestBatchId).delete(K.key);this.qr.set(J.largestBatchId,X)}this.overlays=this.overlays.insert(K.key,new VK(Q,K));let W=this.qr.get(Q);W===void 0&&(W=p(),this.qr.set(Q,W)),this.qr.set(Q,W.add(K.key))}}class CK{constructor(){this.sessionToken=H0.EMPTY_BYTE_STRING}getSessionToken(Z){return S.resolve(this.sessionToken)}setSessionToken(Z,Q){return this.sessionToken=Q,S.resolve()}}class p1{constructor(){this.Qr=new $0(W0.$r),this.Ur=new $0(W0.Kr)}isEmpty(){return this.Qr.isEmpty()}addReference(Z,Q){let K=new W0(Z,Q);this.Qr=this.Qr.add(K),this.Ur=this.Ur.add(K)}Wr(Z,Q){Z.forEach((K)=>this.addReference(K,Q))}removeReference(Z,Q){this.Gr(new W0(Z,Q))}zr(Z,Q){Z.forEach((K)=>this.removeReference(K,Q))}jr(Z){let Q=new h(new r([])),K=new W0(Q,Z),J=new W0(Q,Z+1),W=[];return this.Ur.forEachInRange([K,J],(X)=>{this.Gr(X),W.push(X.key)}),W}Jr(){this.Qr.forEach((Z)=>this.Gr(Z))}Gr(Z){this.Qr=this.Qr.delete(Z),this.Ur=this.Ur.delete(Z)}Hr(Z){let Q=new h(new r([])),K=new W0(Q,Z),J=new W0(Q,Z+1),W=p();return this.Ur.forEachInRange([K,J],(X)=>{W=W.add(X.key)}),W}containsKey(Z){let Q=new W0(Z,0),K=this.Qr.firstAfterOrEqual(Q);return K!==null&&Z.isEqual(K.key)}}class W0{constructor(Z,Q){this.key=Z,this.Yr=Q}static $r(Z,Q){return h.comparator(Z.key,Q.key)||g(Z.Yr,Q.Yr)}static Kr(Z,Q){return g(Z.Yr,Q.Yr)||h.comparator(Z.key,Q.key)}}class kK{constructor(Z,Q){this.indexManager=Z,this.referenceDelegate=Q,this.mutationQueue=[],this.tr=1,this.Zr=new $0(W0.$r)}checkEmpty(Z){return S.resolve(this.mutationQueue.length===0)}addMutationBatch(Z,Q,K,J){let W=this.tr;this.tr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];let X=new UK(W,Q,K,J);this.mutationQueue.push(X);for(let U of J)this.Zr=this.Zr.add(new W0(U.key,W)),this.indexManager.addToCollectionParentIndex(Z,U.key.path.popLast());return S.resolve(X)}lookupMutationBatch(Z,Q){return S.resolve(this.Xr(Q))}getNextMutationBatchAfterBatchId(Z,Q){let K=Q+1,J=this.ei(K),W=J<0?0:J;return S.resolve(this.mutationQueue.length>W?this.mutationQueue[W]:null)}getHighestUnacknowledgedBatchId(){return S.resolve(this.mutationQueue.length===0?N7:this.tr-1)}getAllMutationBatches(Z){return S.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(Z,Q){let K=new W0(Q,0),J=new W0(Q,Number.POSITIVE_INFINITY),W=[];return this.Zr.forEachInRange([K,J],(X)=>{let U=this.Xr(X.Yr);W.push(U)}),S.resolve(W)}getAllMutationBatchesAffectingDocumentKeys(Z,Q){let K=new $0(g);return Q.forEach((J)=>{let W=new W0(J,0),X=new W0(J,Number.POSITIVE_INFINITY);this.Zr.forEachInRange([W,X],(U)=>{K=K.add(U.Yr)})}),S.resolve(this.ti(K))}getAllMutationBatchesAffectingQuery(Z,Q){let K=Q.path,J=K.length+1,W=K;h.isDocumentKey(W)||(W=W.child(""));let X=new W0(new h(W),0),U=new $0(g);return this.Zr.forEachWhile((Y)=>{let z=Y.key.path;return!!K.isPrefixOf(z)&&(z.length===J&&(U=U.add(Y.Yr)),!0)},X),S.resolve(this.ti(U))}ti(Z){let Q=[];return Z.forEach((K)=>{let J=this.Xr(K);J!==null&&Q.push(J)}),Q}removeMutationBatch(Z,Q){o(this.ni(Q.batchId,"removed")===0,55003),this.mutationQueue.shift();let K=this.Zr;return S.forEach(Q.mutations,(J)=>{let W=new W0(J.key,Q.batchId);return K=K.delete(W),this.referenceDelegate.markPotentiallyOrphaned(Z,J.key)}).next(()=>{this.Zr=K})}ir(Z){}containsKey(Z,Q){let K=new W0(Q,0),J=this.Zr.firstAfterOrEqual(K);return S.resolve(Q.isEqual(J&&J.key))}performConsistencyCheck(Z){return this.mutationQueue.length,S.resolve()}ni(Z,Q){return this.ei(Z)}ei(Z){if(this.mutationQueue.length===0)return 0;return Z-this.mutationQueue[0].batchId}Xr(Z){let Q=this.ei(Z);if(Q<0||Q>=this.mutationQueue.length)return null;return this.mutationQueue[Q]}}class hK{constructor(Z){this.ri=Z,this.docs=function(){return new a(h.comparator)}(),this.size=0}setIndexManager(Z){this.indexManager=Z}addEntry(Z,Q){let K=Q.key,J=this.docs.get(K),W=J?J.size:0,X=this.ri(Q);return this.docs=this.docs.insert(K,{document:Q.mutableCopy(),size:X}),this.size+=X-W,this.indexManager.addToCollectionParentIndex(Z,K.path.popLast())}removeEntry(Z){let Q=this.docs.get(Z);Q&&(this.docs=this.docs.remove(Z),this.size-=Q.size)}getEntry(Z,Q){let K=this.docs.get(Q);return S.resolve(K?K.document.mutableCopy():q0.newInvalidDocument(Q))}getEntries(Z,Q){let K=t0();return Q.forEach((J)=>{let W=this.docs.get(J);K=K.insert(J,W?W.document.mutableCopy():q0.newInvalidDocument(J))}),S.resolve(K)}getDocumentsMatchingQuery(Z,Q,K,J){let W=t0(),X=Q.path,U=new h(X.child("__id-9223372036854775808__")),Y=this.docs.getIteratorFrom(U);for(;Y.hasNext();){let{key:z,value:{document:P}}=Y.getNext();if(!X.isPrefixOf(z.path))break;z.path.length>X.length+1||(iG(sG(P),K)<=0||(J.has(P.key)||f1(Q,P))&&(W=W.insert(P.key,P.mutableCopy())))}return S.resolve(W)}getAllFromCollectionGroup(Z,Q,K,J){v(9500)}ii(Z,Q){return S.forEach(this.docs,(K)=>Q(K))}newChangeBuffer(Z){return new vK(this)}getSize(Z){return S.resolve(this.size)}}class vK extends TK{constructor(Z){super(),this.Nr=Z}applyChanges(Z){let Q=[];return this.changes.forEach((K,J)=>{J.isValidDocument()?Q.push(this.Nr.addEntry(Z,J)):this.Nr.removeEntry(K)}),S.waitFor(Q)}getFromCache(Z,Q){return this.Nr.getEntry(Z,Q)}getAllFromCache(Z,Q){return this.Nr.getEntries(Z,Q)}}class mK{constructor(Z){this.persistence=Z,this.si=new P6((Q)=>T7(Q),E7),this.lastRemoteSnapshotVersion=m.min(),this.highestTargetId=0,this.oi=0,this._i=new p1,this.targetCount=0,this.ai=t6.ur()}forEachTarget(Z,Q){return this.si.forEach((K,J)=>Q(J)),S.resolve()}getLastRemoteSnapshotVersion(Z){return S.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(Z){return S.resolve(this.oi)}allocateTargetId(Z){return this.highestTargetId=this.ai.next(),S.resolve(this.highestTargetId)}setTargetsMetadata(Z,Q,K){return K&&(this.lastRemoteSnapshotVersion=K),Q>this.oi&&(this.oi=Q),S.resolve()}Pr(Z){this.si.set(Z.target,Z);let Q=Z.targetId;Q>this.highestTargetId&&(this.ai=new t6(Q),this.highestTargetId=Q),Z.sequenceNumber>this.oi&&(this.oi=Z.sequenceNumber)}addTargetData(Z,Q){return this.Pr(Q),this.targetCount+=1,S.resolve()}updateTargetData(Z,Q){return this.Pr(Q),S.resolve()}removeTargetData(Z,Q){return this.si.delete(Q.target),this._i.jr(Q.targetId),this.targetCount-=1,S.resolve()}removeTargets(Z,Q,K){let J=0,W=[];return this.si.forEach((X,U)=>{U.sequenceNumber<=Q&&K.get(U.targetId)===null&&(this.si.delete(X),W.push(this.removeMatchingKeysForTargetId(Z,U.targetId)),J++)}),S.waitFor(W).next(()=>J)}getTargetCount(Z){return S.resolve(this.targetCount)}getTargetData(Z,Q){let K=this.si.get(Q)||null;return S.resolve(K)}addMatchingKeys(Z,Q,K){return this._i.Wr(Q,K),S.resolve()}removeMatchingKeys(Z,Q,K){this._i.zr(Q,K);let J=this.persistence.referenceDelegate,W=[];return J&&Q.forEach((X)=>{W.push(J.markPotentiallyOrphaned(Z,X))}),S.waitFor(W)}removeMatchingKeysForTargetId(Z,Q){return this._i.jr(Q),S.resolve()}getMatchingKeysForTargetId(Z,Q){let K=this._i.Hr(Q);return S.resolve(K)}containsKey(Z,Q){return S.resolve(this._i.containsKey(Q))}}class m7{constructor(Z,Q){this.ui={},this.overlays={},this.ci=new l8(0),this.li=!1,this.li=!0,this.hi=new CK,this.referenceDelegate=Z(this),this.Pi=new mK(this),this.indexManager=new IK,this.remoteDocumentCache=function(J){return new hK(J)}((K)=>this.referenceDelegate.Ti(K)),this.serializer=new NK(Q),this.Ii=new xK(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.li=!1,Promise.resolve()}get started(){return this.li}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(Z){return this.indexManager}getDocumentOverlayCache(Z){let Q=this.overlays[Z.toKey()];return Q||(Q=new yK,this.overlays[Z.toKey()]=Q),Q}getMutationQueue(Z,Q){let K=this.ui[Z.toKey()];return K||(K=new kK(Q,this.referenceDelegate),this.ui[Z.toKey()]=K),K}getGlobalsCache(){return this.hi}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ii}runTransaction(Z,Q,K){y("MemoryPersistence","Starting transaction:",Z);let J=new uK(this.ci.next());return this.referenceDelegate.Ei(),K(J).next((W)=>this.referenceDelegate.di(J).next(()=>W)).toPromise().then((W)=>(J.raiseOnCommittedEvent(),W))}Ai(Z,Q){return S.or(Object.values(this.ui).map((K)=>()=>K.containsKey(Z,Q)))}}class uK extends U5{constructor(Z){super(),this.currentSequenceNumber=Z}}class u7{constructor(Z){this.persistence=Z,this.Ri=new p1,this.Vi=null}static mi(Z){return new u7(Z)}get fi(){if(this.Vi)return this.Vi;throw v(60996)}addReference(Z,Q,K){return this.Ri.addReference(K,Q),this.fi.delete(K.toString()),S.resolve()}removeReference(Z,Q,K){return this.Ri.removeReference(K,Q),this.fi.add(K.toString()),S.resolve()}markPotentiallyOrphaned(Z,Q){return this.fi.add(Q.toString()),S.resolve()}removeTarget(Z,Q){this.Ri.jr(Q.targetId).forEach((J)=>this.fi.add(J.toString()));let K=this.persistence.getTargetCache();return K.getMatchingKeysForTargetId(Z,Q.targetId).next((J)=>{J.forEach((W)=>this.fi.add(W.toString()))}).next(()=>K.removeTargetData(Z,Q))}Ei(){this.Vi=new Set}di(Z){let Q=this.persistence.getRemoteDocumentCache().newChangeBuffer();return S.forEach(this.fi,(K)=>{let J=h.fromPath(K);return this.gi(Z,J).next((W)=>{W||Q.removeEntry(J,m.min())})}).next(()=>(this.Vi=null,Q.apply(Z)))}updateLimboDocument(Z,Q){return this.gi(Z,Q).next((K)=>{K?this.fi.delete(Q.toString()):this.fi.add(Q.toString())})}Ti(Z){return 0}gi(Z,Q){return S.or([()=>S.resolve(this.Ri.containsKey(Q)),()=>this.persistence.getTargetCache().containsKey(Z,Q),()=>this.persistence.Ai(Z,Q)])}}class L1{constructor(Z,Q){this.persistence=Z,this.pi=new P6((K)=>tG(K.path),(K,J)=>K.isEqual(J)),this.garbageCollector=o2(this,Q)}static mi(Z,Q){return new L1(Z,Q)}Ei(){}di(Z){return S.resolve()}forEachTarget(Z,Q){return this.persistence.getTargetCache().forEachTarget(Z,Q)}gr(Z){let Q=this.wr(Z);return this.persistence.getTargetCache().getTargetCount(Z).next((K)=>Q.next((J)=>K+J))}wr(Z){let Q=0;return this.pr(Z,(K)=>{Q++}).next(()=>Q)}pr(Z,Q){return S.forEach(this.pi,(K,J)=>this.br(Z,K,J).next((W)=>W?S.resolve():Q(J)))}removeTargets(Z,Q,K){return this.persistence.getTargetCache().removeTargets(Z,Q,K)}removeOrphanedDocuments(Z,Q){let K=0,J=this.persistence.getRemoteDocumentCache(),W=J.newChangeBuffer();return J.ii(Z,(X)=>this.br(Z,X,Q).next((U)=>{U||(K++,W.removeEntry(X,m.min()))})).next(()=>W.apply(Z)).next(()=>K)}markPotentiallyOrphaned(Z,Q){return this.pi.set(Q,Z.currentSequenceNumber),S.resolve()}removeTarget(Z,Q){let K=Q.withSequenceNumber(Z.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(Z,K)}addReference(Z,Q,K){return this.pi.set(K,Z.currentSequenceNumber),S.resolve()}removeReference(Z,Q,K){return this.pi.set(K,Z.currentSequenceNumber),S.resolve()}updateLimboDocument(Z,Q){return this.pi.set(Q,Z.currentSequenceNumber),S.resolve()}Ti(Z){let Q=Z.key.toString().length;return Z.isFoundDocument()&&(Q+=j1(Z.data.value)),Q}br(Z,Q,K){return S.or([()=>this.persistence.Ai(Z,Q),()=>this.persistence.getTargetCache().containsKey(Z,Q),()=>{let J=this.pi.get(Q);return S.resolve(J!==void 0&&J>K)}])}getCacheSize(Z){return this.persistence.getRemoteDocumentCache().getSize(Z)}}class f7{constructor(Z,Q,K,J){this.targetId=Z,this.fromCache=Q,this.Es=K,this.ds=J}static As(Z,Q){let K=p(),J=p();for(let W of Q.docChanges)switch(W.type){case 0:K=K.add(W.doc.key);break;case 1:J=J.add(W.doc.key)}return new f7(Z,Q.fromCache,K,J)}}class fK{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(Z){this._documentReadCount+=Z}}class gK{constructor(){this.Rs=!1,this.Vs=!1,this.fs=100,this.gs=function(){return h4()?8:oG(k4())>0?6:4}()}initialize(Z,Q){this.ps=Z,this.indexManager=Q,this.Rs=!0}getDocumentsMatchingQuery(Z,Q,K,J){let W={result:null};return this.ys(Z,Q).next((X)=>{W.result=X}).next(()=>{if(!W.result)return this.ws(Z,Q,J,K).next((X)=>{W.result=X})}).next(()=>{if(W.result)return;let X=new fK;return this.Ss(Z,Q,X).next((U)=>{if(W.result=U,this.Vs)return this.bs(Z,Q,X,U.size)})}).next(()=>W.result)}bs(Z,Q,K,J){return K.documentReadCount<this.fs?(x6()<=l.DEBUG&&y("QueryEngine","SDK will not create cache indexes for query:",y6(Q),"since it only creates cache indexes for collection contains","more than or equal to",this.fs,"documents"),S.resolve()):(x6()<=l.DEBUG&&y("QueryEngine","Query:",y6(Q),"scans",K.documentReadCount,"local documents and returns",J,"documents as results."),K.documentReadCount>this.gs*J?(x6()<=l.DEBUG&&y("QueryEngine","The SDK decides to create cache indexes for query:",y6(Q),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(Z,k0(Q))):S.resolve())}ys(Z,Q){if(_Q(Q))return S.resolve(null);let K=k0(Q);return this.indexManager.getIndexType(Z,K).next((J)=>J===0?null:(Q.limit!==null&&J===1&&(Q=T1(Q,null,"F"),K=k0(Q)),this.indexManager.getDocumentsMatchingTarget(Z,K).next((W)=>{let X=p(...W);return this.ps.getDocuments(Z,X).next((U)=>this.indexManager.getMinOffset(Z,K).next((Y)=>{let z=this.Ds(Q,U);return this.Cs(Q,z,X,Y.readTime)?this.ys(Z,T1(Q,null,"F")):this.vs(Z,z,Q,Y)}))})))}ws(Z,Q,K,J){return _Q(Q)||J.isEqual(m.min())?S.resolve(null):this.ps.getDocuments(Z,K).next((W)=>{let X=this.Ds(Q,W);return this.Cs(Q,X,K,J)?S.resolve(null):(x6()<=l.DEBUG&&y("QueryEngine","Re-using previous result from %s to execute query: %s",J.toString(),y6(Q)),this.vs(Z,X,Q,lG(J,y8)).next((U)=>U))})}Ds(Z,Q){let K=new $0(r5(Z));return Q.forEach((J,W)=>{f1(Z,W)&&(K=K.add(W))}),K}Cs(Z,Q,K,J){if(Z.limit===null)return!1;if(K.size!==Q.size)return!0;let W=Z.limitType==="F"?Q.last():Q.first();return!!W&&(W.hasPendingWrites||W.version.compareTo(J)>0)}Ss(Z,Q,K){return x6()<=l.DEBUG&&y("QueryEngine","Using full collection scan to execute query:",y6(Q)),this.ps.getDocumentsMatchingQuery(Z,Q,U6.min(),K)}vs(Z,Q,K,J){return this.ps.getDocumentsMatchingQuery(Z,K,J).next((W)=>(Q.forEach((X)=>{W=W.insert(X.key,X)}),W))}}var g7="LocalStore",n2=300000000;class pK{constructor(Z,Q,K,J){this.persistence=Z,this.Fs=Q,this.serializer=J,this.Ms=new a(g),this.xs=new P6((W)=>T7(W),E7),this.Os=new Map,this.Ns=Z.getRemoteDocumentCache(),this.Pi=Z.getTargetCache(),this.Ii=Z.getBundleCache(),this.Bs(K)}Bs(Z){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(Z),this.indexManager=this.persistence.getIndexManager(Z),this.mutationQueue=this.persistence.getMutationQueue(Z,this.indexManager),this.localDocuments=new LK(this.Ns,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Ns.setIndexManager(this.indexManager),this.Fs.initialize(this.localDocuments,this.indexManager)}collectGarbage(Z){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(Q)=>Z.collect(Q,this.Ms))}}function t2(Z,Q,K,J){return new pK(Z,Q,K,J)}async function lK(Z,Q){let K=u(Z);return await K.persistence.runTransaction("Handle user change","readonly",(J)=>{let W;return K.mutationQueue.getAllMutationBatches(J).next((X)=>(W=X,K.Bs(Q),K.mutationQueue.getAllMutationBatches(J))).next((X)=>{let U=[],Y=[],z=p();for(let P of W){U.push(P.batchId);for(let F of P.mutations)z=z.add(F.key)}for(let P of X){Y.push(P.batchId);for(let F of P.mutations)z=z.add(F.key)}return K.localDocuments.getDocuments(J,z).next((P)=>({Ls:P,removedBatchIds:U,addedBatchIds:Y}))})})}function r2(Z,Q){let K=u(Z);return K.persistence.runTransaction("Acknowledge batch","readwrite-primary",(J)=>{let W=Q.batch.keys(),X=K.Ns.newChangeBuffer({trackRemovals:!0});return function(Y,z,P,F){let j=P.batch,I=j.keys(),T=S.resolve();return I.forEach((C)=>{T=T.next(()=>F.getEntry(z,C)).next((x)=>{let k=P.docVersions.get(C);o(k!==null,48541),x.version.compareTo(k)<0&&(j.applyToRemoteDocument(x,P),x.isValidDocument()&&(x.setReadTime(P.commitVersion),F.addEntry(x)))})}),T.next(()=>Y.mutationQueue.removeMutationBatch(z,j))}(K,J,Q,X).next(()=>X.apply(J)).next(()=>K.mutationQueue.performConsistencyCheck(J)).next(()=>K.documentOverlayCache.removeOverlaysForBatchId(J,W,Q.batch.batchId)).next(()=>K.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(J,function(Y){let z=p();for(let P=0;P<Y.mutationResults.length;++P)Y.mutationResults[P].transformResults.length>0&&(z=z.add(Y.batch.mutations[P].key));return z}(Q))).next(()=>K.localDocuments.getDocuments(J,W))})}function sK(Z){let Q=u(Z);return Q.persistence.runTransaction("Get last remote snapshot version","readonly",(K)=>Q.Pi.getLastRemoteSnapshotVersion(K))}function b2(Z,Q){let K=u(Z),J=Q.snapshotVersion,W=K.Ms;return K.persistence.runTransaction("Apply remote event","readwrite-primary",(X)=>{let U=K.Ns.newChangeBuffer({trackRemovals:!0});W=K.Ms;let Y=[];Q.targetChanges.forEach((F,j)=>{let I=W.get(j);if(!I)return;Y.push(K.Pi.removeMatchingKeys(X,F.removedDocuments,j).next(()=>K.Pi.addMatchingKeys(X,F.addedDocuments,j)));let T=I.withSequenceNumber(X.currentSequenceNumber);Q.targetMismatches.get(j)!==null?T=T.withResumeToken(H0.EMPTY_BYTE_STRING,m.min()).withLastLimboFreeSnapshotVersion(m.min()):F.resumeToken.approximateByteSize()>0&&(T=T.withResumeToken(F.resumeToken,J)),W=W.insert(j,T),function(x,k,d){if(x.resumeToken.approximateByteSize()===0)return!0;if(k.snapshotVersion.toMicroseconds()-x.snapshotVersion.toMicroseconds()>=n2)return!0;return d.addedDocuments.size+d.modifiedDocuments.size+d.removedDocuments.size>0}(I,T,F)&&Y.push(K.Pi.updateTargetData(X,T))});let z=t0(),P=p();if(Q.documentUpdates.forEach((F)=>{Q.resolvedLimboDocuments.has(F)&&Y.push(K.persistence.referenceDelegate.updateLimboDocument(X,F))}),Y.push(c2(X,U,Q.documentUpdates).next((F)=>{z=F.ks,P=F.qs})),!J.isEqual(m.min())){let F=K.Pi.getLastRemoteSnapshotVersion(X).next((j)=>K.Pi.setTargetsMetadata(X,X.currentSequenceNumber,J));Y.push(F)}return S.waitFor(Y).next(()=>U.apply(X)).next(()=>K.localDocuments.getLocalViewOfDocuments(X,z,P)).next(()=>z)}).then((X)=>(K.Ms=W,X))}function c2(Z,Q,K){let J=p(),W=p();return K.forEach((X)=>J=J.add(X)),Q.getEntries(Z,J).next((X)=>{let U=t0();return K.forEach((Y,z)=>{let P=X.get(Y);z.isFoundDocument()!==P.isFoundDocument()&&(W=W.add(Y)),z.isNoDocument()&&z.version.isEqual(m.min())?(Q.removeEntry(Y,z.readTime),U=U.insert(Y,z)):!P.isValidDocument()||z.version.compareTo(P.version)>0||z.version.compareTo(P.version)===0&&P.hasPendingWrites?(Q.addEntry(z),U=U.insert(Y,z)):y(g7,"Ignoring outdated watch update for ",Y,". Current version:",P.version," Watch version:",z.version)}),{ks:U,qs:W}})}function e2(Z,Q){let K=u(Z);return K.persistence.runTransaction("Get next mutation batch","readonly",(J)=>(Q===void 0&&(Q=N7),K.mutationQueue.getNextMutationBatchAfterBatchId(J,Q)))}function a2(Z,Q){let K=u(Z);return K.persistence.runTransaction("Allocate target","readwrite",(J)=>{let W;return K.Pi.getTargetData(J,Q).next((X)=>X?(W=X,S.resolve(W)):K.Pi.allocateTargetId(J).next((U)=>(W=new X6(Q,U,"TargetPurposeListen",J.currentSequenceNumber),K.Pi.addTargetData(J,W).next(()=>W))))}).then((J)=>{let W=K.Ms.get(J.targetId);return(W===null||J.snapshotVersion.compareTo(W.snapshotVersion)>0)&&(K.Ms=K.Ms.insert(J.targetId,J),K.xs.set(Q,J.targetId)),J})}async function V7(Z,Q,K){let J=u(Z),W=J.Ms.get(Q),X=K?"readwrite":"readwrite-primary";try{K||await J.persistence.runTransaction("Release target",X,(U)=>J.persistence.referenceDelegate.removeTarget(U,W))}catch(U){if(!e6(U))throw U;y(g7,`Failed to update sequence numbers for target ${Q}: ${U}`)}J.Ms=J.Ms.remove(Q),J.xs.delete(W.target)}function mQ(Z,Q,K){let J=u(Z),W=m.min(),X=p();return J.persistence.runTransaction("Execute query","readwrite",(U)=>function(z,P,F){let j=u(z),I=j.xs.get(F);return I!==void 0?S.resolve(j.Ms.get(I)):j.Pi.getTargetData(P,F)}(J,U,k0(Q)).next((Y)=>{if(Y)return W=Y.lastLimboFreeSnapshotVersion,J.Pi.getMatchingKeysForTargetId(U,Y.targetId).next((z)=>{X=z})}).next(()=>J.Fs.getDocumentsMatchingQuery(U,Q,K?W:m.min(),K?X:p())).next((Y)=>(ZW(J,z2(Q),Y),{documents:Y,Qs:X})))}function ZW(Z,Q,K){let J=Z.Os.get(Q)||m.min();K.forEach((W,X)=>{X.readTime.compareTo(J)>0&&(J=X.readTime)}),Z.Os.set(Q,J)}class Y7{constructor(){this.activeTargetIds=F2()}zs(Z){this.activeTargetIds=this.activeTargetIds.add(Z)}js(Z){this.activeTargetIds=this.activeTargetIds.delete(Z)}Gs(){let Z={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(Z)}}class iK{constructor(){this.Mo=new Y7,this.xo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(Z){}updateMutationState(Z,Q,K){}addLocalQueryTarget(Z,Q=!0){return Q&&this.Mo.zs(Z),this.xo[Z]||"not-current"}updateQueryState(Z,Q,K){this.xo[Z]=Q}removeLocalQueryTarget(Z){this.Mo.js(Z)}isLocalQueryTarget(Z){return this.Mo.activeTargetIds.has(Z)}clearQueryState(Z){delete this.xo[Z]}getAllActiveQueryTargets(){return this.Mo.activeTargetIds}isActiveQueryTarget(Z){return this.Mo.activeTargetIds.has(Z)}start(){return this.Mo=new Y7,Promise.resolve()}handleUserChange(Z,Q,K){}setOnlineState(Z){}shutdown(){}writeSequenceNumber(Z){}notifyBundleLoaded(Z){}}class dK{Oo(Z){}shutdown(){}}var uQ="ConnectivityMonitor";class z7{constructor(){this.No=()=>this.Bo(),this.Lo=()=>this.ko(),this.qo=[],this.Qo()}Oo(Z){this.qo.push(Z)}shutdown(){window.removeEventListener("online",this.No),window.removeEventListener("offline",this.Lo)}Qo(){window.addEventListener("online",this.No),window.addEventListener("offline",this.Lo)}Bo(){y(uQ,"Network connectivity changed: AVAILABLE");for(let Z of this.qo)Z(0)}ko(){y(uQ,"Network connectivity changed: UNAVAILABLE");for(let Z of this.qo)Z(1)}static v(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}var O1=null;function H7(){return O1===null?O1=function(){return 268435456+Math.round(2147483648*Math.random())}():O1++,"0x"+O1.toString(16)}var o9="RestConnection",QW={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class oK{get $o(){return!1}constructor(Z){this.databaseInfo=Z,this.databaseId=Z.databaseId;let Q=Z.ssl?"https":"http",K=encodeURIComponent(this.databaseId.projectId),J=encodeURIComponent(this.databaseId.database);this.Uo=Q+"://"+Z.host,this.Ko=`projects/${K}/databases/${J}`,this.Wo=this.databaseId.database===S1?`project_id=${K}`:`project_id=${K}&database_id=${J}`}Go(Z,Q,K,J,W){let X=H7(),U=this.zo(Z,Q.toUriEncodedString());y(o9,`Sending RPC '${Z}' ${X}:`,U,K);let Y={"google-cloud-resource-prefix":this.Ko,"x-goog-request-params":this.Wo};this.jo(Y,J,W);let{host:z}=new URL(U),P=B1(z);return this.Jo(Z,U,Y,K,P).then((F)=>(y(o9,`Received RPC '${Z}' ${X}: `,F),F),(F)=>{throw f6(o9,`RPC '${Z}' ${X} failed with error: `,F,"url: ",U,"request:",K),F})}Ho(Z,Q,K,J,W,X){return this.Go(Z,Q,K,J,W)}jo(Z,Q,K){Z["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+b6}(),Z["Content-Type"]="text/plain",this.databaseInfo.appId&&(Z["X-Firebase-GMPID"]=this.databaseInfo.appId),Q&&Q.headers.forEach((J,W)=>Z[W]=J),K&&K.headers.forEach((J,W)=>Z[W]=J)}zo(Z,Q){let K=QW[Z];return`${this.Uo}/v1/${Q}:${K}`}terminate(){}}class nK{constructor(Z){this.Yo=Z.Yo,this.Zo=Z.Zo}Xo(Z){this.e_=Z}t_(Z){this.n_=Z}r_(Z){this.i_=Z}onMessage(Z){this.s_=Z}close(){this.Zo()}send(Z){this.Yo(Z)}o_(){this.e_()}__(){this.n_()}a_(Z){this.i_(Z)}u_(Z){this.s_(Z)}}var B0="WebChannelConnection";class tK extends oK{constructor(Z){super(Z),this.c_=[],this.forceLongPolling=Z.forceLongPolling,this.autoDetectLongPolling=Z.autoDetectLongPolling,this.useFetchStreams=Z.useFetchStreams,this.longPollingOptions=Z.longPollingOptions}Jo(Z,Q,K,J,W){let X=H7();return new Promise((U,Y)=>{let z=new f9;z.setWithCredentials(!0),z.listenOnce(g9.COMPLETE,()=>{try{switch(z.getLastErrorCode()){case I8.NO_ERROR:let F=z.getResponseJson();y(B0,`XHR for RPC '${Z}' ${X} received:`,JSON.stringify(F)),U(F);break;case I8.TIMEOUT:y(B0,`RPC '${Z}' ${X} timed out`),Y(new L(A.DEADLINE_EXCEEDED,"Request time out"));break;case I8.HTTP_ERROR:let j=z.getStatus();if(y(B0,`RPC '${Z}' ${X} failed with status:`,j,"response text:",z.getResponseText()),j>0){let I=z.getResponseJson();Array.isArray(I)&&(I=I[0]);let T=I?.error;if(T&&T.status&&T.message){let C=function(k){let d=k.toLowerCase().replace(/_/g,"-");return Object.values(A).indexOf(d)>=0?d:A.UNKNOWN}(T.status);Y(new L(C,T.message))}else Y(new L(A.UNKNOWN,"Server responded with status "+z.getStatus()))}else Y(new L(A.UNAVAILABLE,"Connection failed."));break;default:v(9055,{l_:Z,streamId:X,h_:z.getLastErrorCode(),P_:z.getLastError()})}}finally{y(B0,`RPC '${Z}' ${X} completed.`)}});let P=JSON.stringify(J);y(B0,`RPC '${Z}' ${X} sending request:`,J),z.send(Q,"POST",P,K,15)})}T_(Z,Q,K){let J=H7(),W=[this.Uo,"/","google.firestore.v1.Firestore","/",Z,"/channel"],X=s9(),U=l9(),Y={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:600000},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},z=this.longPollingOptions.timeoutSeconds;z!==void 0&&(Y.longPollingTimeout=Math.round(1000*z)),this.useFetchStreams&&(Y.useFetchStreams=!0),this.jo(Y.initMessageHeaders,Q,K),Y.encodeInitMessageHeaders=!0;let P=W.join("");y(B0,`Creating RPC '${Z}' stream ${J}: ${P}`,Y);let F=X.createWebChannel(P,Y);this.I_(F);let j=!1,I=!1,T=new nK({Yo:(x)=>{I?y(B0,`Not sending because RPC '${Z}' stream ${J} is closed:`,x):(j||(y(B0,`Opening RPC '${Z}' stream ${J} transport.`),F.open(),j=!0),y(B0,`RPC '${Z}' stream ${J} sending:`,x),F.send(x))},Zo:()=>F.close()}),C=(x,k,d)=>{x.listen(k,(i)=>{try{d(i)}catch(n){setTimeout(()=>{throw n},0)}})};return C(F,L6.EventType.OPEN,()=>{I||(y(B0,`RPC '${Z}' stream ${J} transport opened.`),T.o_())}),C(F,L6.EventType.CLOSE,()=>{I||(I=!0,y(B0,`RPC '${Z}' stream ${J} transport closed`),T.a_(),this.E_(F))}),C(F,L6.EventType.ERROR,(x)=>{I||(I=!0,f6(B0,`RPC '${Z}' stream ${J} transport errored. Name:`,x.name,"Message:",x.message),T.a_(new L(A.UNAVAILABLE,"The operation could not be completed")))}),C(F,L6.EventType.MESSAGE,(x)=>{if(!I){let k=x.data[0];o(!!k,16349);let d=k,i=d?.error||d[0]?.error;if(i){y(B0,`RPC '${Z}' stream ${J} received error:`,i);let n=i.status,F0=function(M){let w=Q0[M];if(w!==void 0)return zK(w)}(n),O0=i.message;F0===void 0&&(F0=A.INTERNAL,O0="Unknown error status: "+n+" with message "+i.message),I=!0,T.a_(new L(F0,O0)),F.close()}else y(B0,`RPC '${Z}' stream ${J} received:`,k),T.u_(k)}}),C(U,p9.STAT_EVENT,(x)=>{x.stat===R1.PROXY?y(B0,`RPC '${Z}' stream ${J} detected buffering proxy`):x.stat===R1.NOPROXY&&y(B0,`RPC '${Z}' stream ${J} detected no buffering proxy`)}),setTimeout(()=>{T.__()},0),T}terminate(){this.c_.forEach((Z)=>Z.close()),this.c_=[]}I_(Z){this.c_.push(Z)}E_(Z){this.c_=this.c_.filter((Q)=>Q===Z)}}function n9(){return typeof document<"u"?document:null}function l1(Z){return new PK(Z,!0)}class p7{constructor(Z,Q,K=1000,J=1.5,W=60000){this.Mi=Z,this.timerId=Q,this.d_=K,this.A_=J,this.R_=W,this.V_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.V_=0}g_(){this.V_=this.R_}p_(Z){this.cancel();let Q=Math.floor(this.V_+this.y_()),K=Math.max(0,Date.now()-this.f_),J=Math.max(0,Q-K);J>0&&y("ExponentialBackoff",`Backing off for ${J} ms (base delay: ${this.V_} ms, delay with jitter: ${Q} ms, last attempt: ${K} ms ago)`),this.m_=this.Mi.enqueueAfterDelay(this.timerId,J,()=>(this.f_=Date.now(),Z())),this.V_*=this.A_,this.V_<this.d_&&(this.V_=this.d_),this.V_>this.R_&&(this.V_=this.R_)}w_(){this.m_!==null&&(this.m_.skipDelay(),this.m_=null)}cancel(){this.m_!==null&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-0.5)*this.V_}}var fQ="PersistentStream";class l7{constructor(Z,Q,K,J,W,X,U,Y){this.Mi=Z,this.S_=K,this.b_=J,this.connection=W,this.authCredentialsProvider=X,this.appCheckCredentialsProvider=U,this.listener=Y,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new p7(Z,Q)}x_(){return this.state===1||this.state===5||this.O_()}O_(){return this.state===2||this.state===3}start(){this.F_=0,this.state!==4?this.auth():this.N_()}async stop(){this.x_()&&await this.close(0)}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&this.C_===null&&(this.C_=this.Mi.enqueueAfterDelay(this.S_,60000,()=>this.k_()))}q_(Z){this.Q_(),this.stream.send(Z)}async k_(){if(this.O_())return this.close(0)}Q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(Z,Q){this.Q_(),this.U_(),this.M_.cancel(),this.D_++,Z!==4?this.M_.reset():Q&&Q.code===A.RESOURCE_EXHAUSTED?(d0(Q.toString()),d0("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):Q&&Q.code===A.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.K_(),this.stream.close(),this.stream=null),this.state=Z,await this.listener.r_(Q)}K_(){}auth(){this.state=1;let Z=this.W_(this.D_),Q=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([K,J])=>{this.D_===Q&&this.G_(K,J)},(K)=>{Z(()=>{let J=new L(A.UNKNOWN,"Fetching auth token failed: "+K.message);return this.z_(J)})})}G_(Z,Q){let K=this.W_(this.D_);this.stream=this.j_(Z,Q),this.stream.Xo(()=>{K(()=>this.listener.Xo())}),this.stream.t_(()=>{K(()=>(this.state=2,this.v_=this.Mi.enqueueAfterDelay(this.b_,1e4,()=>(this.O_()&&(this.state=3),Promise.resolve())),this.listener.t_()))}),this.stream.r_((J)=>{K(()=>this.z_(J))}),this.stream.onMessage((J)=>{K(()=>++this.F_==1?this.J_(J):this.onNext(J))})}N_(){this.state=5,this.M_.p_(async()=>{this.state=0,this.start()})}z_(Z){return y(fQ,`close with error: ${Z}`),this.stream=null,this.close(4,Z)}W_(Z){return(Q)=>{this.Mi.enqueueAndForget(()=>this.D_===Z?Q():(y(fQ,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class rK extends l7{constructor(Z,Q,K,J,W,X){super(Z,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",Q,K,J,X),this.serializer=W}j_(Z,Q){return this.connection.T_("Listen",Z,Q)}J_(Z){return this.onNext(Z)}onNext(Z){this.M_.reset();let Q=C2(this.serializer,Z),K=function(W){if(!("targetChange"in W))return m.min();let X=W.targetChange;return X.targetIds&&X.targetIds.length?m.min():X.readTime?v0(X.readTime):m.min()}(Z);return this.listener.H_(Q,K)}Y_(Z){let Q={};Q.database=$7(this.serializer),Q.addTarget=function(W,X){let U,Y=X.target;if(U=Q7(Y)?{documents:v2(W,Y)}:{query:m2(W,Y).ft},U.targetId=X.targetId,X.resumeToken.approximateByteSize()>0){U.resumeToken=wK(W,X.resumeToken);let z=G7(W,X.expectedCount);z!==null&&(U.expectedCount=z)}else if(X.snapshotVersion.compareTo(m.min())>0){U.readTime=E1(W,X.snapshotVersion.toTimestamp());let z=G7(W,X.expectedCount);z!==null&&(U.expectedCount=z)}return U}(this.serializer,Z);let K=f2(this.serializer,Z);K&&(Q.labels=K),this.q_(Q)}Z_(Z){let Q={};Q.database=$7(this.serializer),Q.removeTarget=Z,this.q_(Q)}}class bK extends l7{constructor(Z,Q,K,J,W,X){super(Z,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",Q,K,J,X),this.serializer=W}get X_(){return this.F_>0}start(){this.lastStreamToken=void 0,super.start()}K_(){this.X_&&this.ea([])}j_(Z,Q){return this.connection.T_("Write",Z,Q)}J_(Z){return o(!!Z.streamToken,31322),this.lastStreamToken=Z.streamToken,o(!Z.writeResults||Z.writeResults.length===0,55816),this.listener.ta()}onNext(Z){o(!!Z.streamToken,12678),this.lastStreamToken=Z.streamToken,this.M_.reset();let Q=h2(Z.writeResults,Z.commitTime),K=v0(Z.commitTime);return this.listener.na(K,Q)}ra(){let Z={};Z.database=$7(this.serializer),this.q_(Z)}ea(Z){let Q={streamToken:this.lastStreamToken,writes:Z.map((K)=>k2(this.serializer,K))};this.q_(Q)}}class cK{}class eK extends cK{constructor(Z,Q,K,J){super(),this.authCredentials=Z,this.appCheckCredentials=Q,this.connection=K,this.serializer=J,this.ia=!1}sa(){if(this.ia)throw new L(A.FAILED_PRECONDITION,"The client has already been terminated.")}Go(Z,Q,K,J){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([W,X])=>this.connection.Go(Z,W7(Q,K),J,W,X)).catch((W)=>{throw W.name==="FirebaseError"?(W.code===A.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),W):new L(A.UNKNOWN,W.toString())})}Ho(Z,Q,K,J,W){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([X,U])=>this.connection.Ho(Z,W7(Q,K),J,X,U,W)).catch((X)=>{throw X.name==="FirebaseError"?(X.code===A.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),X):new L(A.UNKNOWN,X.toString())})}terminate(){this.ia=!0,this.connection.terminate()}}class aK{constructor(Z,Q){this.asyncQueue=Z,this.onlineStateHandler=Q,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){this.oa===0&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve())))}ha(Z){this.state==="Online"?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la(`Connection failed 1 times. Most recent error: ${Z.toString()}`),this.ca("Offline")))}set(Z){this.Pa(),this.oa=0,Z==="Online"&&(this.aa=!1),this.ca(Z)}ca(Z){Z!==this.state&&(this.state=Z,this.onlineStateHandler(Z))}la(Z){let Q=`Could not reach Cloud Firestore backend. ${Z}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.aa?(d0(Q),this.aa=!1):y("OnlineStateTracker",Q)}Pa(){this._a!==null&&(this._a.cancel(),this._a=null)}}var O6="RemoteStore";class Z3{constructor(Z,Q,K,J,W){this.localStore=Z,this.datastore=Q,this.asyncQueue=K,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.da=[],this.Aa=W,this.Aa.Oo((X)=>{K.enqueueAndForget(async()=>{_6(this)&&(y(O6,"Restarting streams for network reachability change."),await async function(Y){let z=u(Y);z.Ea.add(4),await o8(z),z.Ra.set("Unknown"),z.Ea.delete(4),await s1(z)}(this))})}),this.Ra=new aK(K,J)}}async function s1(Z){if(_6(Z))for(let Q of Z.da)await Q(!0)}async function o8(Z){for(let Q of Z.da)await Q(!1)}function Q3(Z,Q){let K=u(Z);K.Ia.has(Q.targetId)||(K.Ia.set(Q.targetId,Q),o7(K)?d7(K):Z8(K).O_()&&i7(K,Q))}function s7(Z,Q){let K=u(Z),J=Z8(K);K.Ia.delete(Q),J.O_()&&K3(K,Q),K.Ia.size===0&&(J.O_()?J.L_():_6(K)&&K.Ra.set("Unknown"))}function i7(Z,Q){if(Z.Va.Ue(Q.targetId),Q.resumeToken.approximateByteSize()>0||Q.snapshotVersion.compareTo(m.min())>0){let K=Z.remoteSyncer.getRemoteKeysForTarget(Q.targetId).size;Q=Q.withExpectedCount(K)}Z8(Z).Y_(Q)}function K3(Z,Q){Z.Va.Ue(Q),Z8(Z).Z_(Q)}function d7(Z){Z.Va=new HK({getRemoteKeysForTarget:(Q)=>Z.remoteSyncer.getRemoteKeysForTarget(Q),At:(Q)=>Z.Ia.get(Q)||null,ht:()=>Z.datastore.serializer.databaseId}),Z8(Z).start(),Z.Ra.ua()}function o7(Z){return _6(Z)&&!Z8(Z).x_()&&Z.Ia.size>0}function _6(Z){return u(Z).Ea.size===0}function J3(Z){Z.Va=void 0}async function KW(Z){Z.Ra.set("Online")}async function JW(Z){Z.Ia.forEach((Q,K)=>{i7(Z,Q)})}async function GW(Z,Q){J3(Z),o7(Z)?(Z.Ra.ha(Q),d7(Z)):Z.Ra.set("Unknown")}async function WW(Z,Q,K){if(Z.Ra.set("Online"),Q instanceof h7&&Q.state===2&&Q.cause)try{await async function(W,X){let U=X.cause;for(let Y of X.targetIds)W.Ia.has(Y)&&(await W.remoteSyncer.rejectListen(Y,U),W.Ia.delete(Y),W.Va.removeTarget(Y))}(Z,Q)}catch(J){y(O6,"Failed to remove targets %s: %s ",Q.targetIds.join(","),J),await x1(Z,J)}else if(Q instanceof L8?Z.Va.Ze(Q):Q instanceof k7?Z.Va.st(Q):Z.Va.tt(Q),!K.isEqual(m.min()))try{let J=await sK(Z.localStore);K.compareTo(J)>=0&&await function(X,U){let Y=X.Va.Tt(U);return Y.targetChanges.forEach((z,P)=>{if(z.resumeToken.approximateByteSize()>0){let F=X.Ia.get(P);F&&X.Ia.set(P,F.withResumeToken(z.resumeToken,U))}}),Y.targetMismatches.forEach((z,P)=>{let F=X.Ia.get(z);if(!F)return;X.Ia.set(z,F.withResumeToken(H0.EMPTY_BYTE_STRING,F.snapshotVersion)),K3(X,z);let j=new X6(F.target,z,P,F.sequenceNumber);i7(X,j)}),X.remoteSyncer.applyRemoteEvent(Y)}(Z,K)}catch(J){y(O6,"Failed to raise snapshot:",J),await x1(Z,J)}}async function x1(Z,Q,K){if(!e6(Q))throw Q;Z.Ea.add(1),await o8(Z),Z.Ra.set("Offline"),K||(K=()=>sK(Z.localStore)),Z.asyncQueue.enqueueRetryable(async()=>{y(O6,"Retrying IndexedDB access"),await K(),Z.Ea.delete(1),await s1(Z)})}function G3(Z,Q){return Q().catch((K)=>x1(Z,K,Q))}async function i1(Z){let Q=u(Z),K=Y6(Q),J=Q.Ta.length>0?Q.Ta[Q.Ta.length-1].batchId:N7;for(;XW(Q);)try{let W=await e2(Q.localStore,J);if(W===null){Q.Ta.length===0&&K.L_();break}J=W.batchId,$W(Q,W)}catch(W){await x1(Q,W)}W3(Q)&&X3(Q)}function XW(Z){return _6(Z)&&Z.Ta.length<10}function $W(Z,Q){Z.Ta.push(Q);let K=Y6(Z);K.O_()&&K.X_&&K.ea(Q.mutations)}function W3(Z){return _6(Z)&&!Y6(Z).x_()&&Z.Ta.length>0}function X3(Z){Y6(Z).start()}async function UW(Z){Y6(Z).ra()}async function VW(Z){let Q=Y6(Z);for(let K of Z.Ta)Q.ea(K.mutations)}async function YW(Z,Q,K){let J=Z.Ta.shift(),W=y7.from(J,Q,K);await G3(Z,()=>Z.remoteSyncer.applySuccessfulWrite(W)),await i1(Z)}async function zW(Z,Q){Q&&Y6(Z).X_&&await async function(J,W){if(function(U){return j2(U)&&U!==A.ABORTED}(W.code)){let X=J.Ta.shift();Y6(J).B_(),await G3(J,()=>J.remoteSyncer.rejectFailedWrite(X.batchId,W)),await i1(J)}}(Z,Q),W3(Z)&&X3(Z)}async function gQ(Z,Q){let K=u(Z);K.asyncQueue.verifyOperationInProgress(),y(O6,"RemoteStore received new credentials");let J=_6(K);K.Ea.add(3),await o8(K),J&&K.Ra.set("Unknown"),await K.remoteSyncer.handleCredentialChange(Q),K.Ea.delete(3),await s1(K)}async function HW(Z,Q){let K=u(Z);Q?(K.Ea.delete(2),await s1(K)):Q||(K.Ea.add(2),await o8(K),K.Ra.set("Unknown"))}function Z8(Z){return Z.ma||(Z.ma=function(K,J,W){let X=u(K);return X.sa(),new rK(J,X.connection,X.authCredentials,X.appCheckCredentials,X.serializer,W)}(Z.datastore,Z.asyncQueue,{Xo:KW.bind(null,Z),t_:JW.bind(null,Z),r_:GW.bind(null,Z),H_:WW.bind(null,Z)}),Z.da.push(async(Q)=>{Q?(Z.ma.B_(),o7(Z)?d7(Z):Z.Ra.set("Unknown")):(await Z.ma.stop(),J3(Z))})),Z.ma}function Y6(Z){return Z.fa||(Z.fa=function(K,J,W){let X=u(K);return X.sa(),new bK(J,X.connection,X.authCredentials,X.appCheckCredentials,X.serializer,W)}(Z.datastore,Z.asyncQueue,{Xo:()=>Promise.resolve(),t_:UW.bind(null,Z),r_:zW.bind(null,Z),ta:VW.bind(null,Z),na:YW.bind(null,Z)}),Z.da.push(async(Q)=>{Q?(Z.fa.B_(),await i1(Z)):(await Z.fa.stop(),Z.Ta.length>0&&(y(O6,`Stopping write stream with ${Z.Ta.length} pending writes`),Z.Ta=[]))})),Z.fa}class n7{constructor(Z,Q,K,J,W){this.asyncQueue=Z,this.timerId=Q,this.targetTimeMs=K,this.op=J,this.removalCallback=W,this.deferred=new i0,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((X)=>{})}get promise(){return this.deferred.promise}static createAndSchedule(Z,Q,K,J,W){let X=Date.now()+K,U=new n7(Z,Q,X,J,W);return U.start(K),U}start(Z){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),Z)}skipDelay(){return this.handleDelayElapsed()}cancel(Z){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new L(A.CANCELLED,"Operation cancelled"+(Z?": "+Z:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then((Z)=>this.deferred.resolve(Z))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function t7(Z,Q){if(d0("AsyncQueue",`${Q}: ${Z}`),e6(Z))return new L(A.UNAVAILABLE,`${Q}: ${Z}`);throw Z}class v6{static emptySet(Z){return new v6(Z.comparator)}constructor(Z){this.comparator=Z?(Q,K)=>Z(Q,K)||h.comparator(Q.key,K.key):(Q,K)=>h.comparator(Q.key,K.key),this.keyedMap=j8(),this.sortedSet=new a(this.comparator)}has(Z){return this.keyedMap.get(Z)!=null}get(Z){return this.keyedMap.get(Z)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(Z){let Q=this.keyedMap.get(Z);return Q?this.sortedSet.indexOf(Q):-1}get size(){return this.sortedSet.size}forEach(Z){this.sortedSet.inorderTraversal((Q,K)=>(Z(Q),!1))}add(Z){let Q=this.delete(Z.key);return Q.copy(Q.keyedMap.insert(Z.key,Z),Q.sortedSet.insert(Z,null))}delete(Z){let Q=this.get(Z);return Q?this.copy(this.keyedMap.remove(Z),this.sortedSet.remove(Q)):this}isEqual(Z){if(!(Z instanceof v6))return!1;if(this.size!==Z.size)return!1;let Q=this.sortedSet.getIterator(),K=Z.sortedSet.getIterator();for(;Q.hasNext();){let J=Q.getNext().key,W=K.getNext().key;if(!J.isEqual(W))return!1}return!0}toString(){let Z=[];return this.forEach((Q)=>{Z.push(Q.toString())}),Z.length===0?"DocumentSet ()":`DocumentSet (
  `+Z.join(`  
`)+`
)`}copy(Z,Q){let K=new v6;return K.comparator=this.comparator,K.keyedMap=Z,K.sortedSet=Q,K}}class P7{constructor(){this.ga=new a(h.comparator)}track(Z){let Q=Z.doc.key,K=this.ga.get(Q);K?Z.type!==0&&K.type===3?this.ga=this.ga.insert(Q,Z):Z.type===3&&K.type!==1?this.ga=this.ga.insert(Q,{type:K.type,doc:Z.doc}):Z.type===2&&K.type===2?this.ga=this.ga.insert(Q,{type:2,doc:Z.doc}):Z.type===2&&K.type===0?this.ga=this.ga.insert(Q,{type:0,doc:Z.doc}):Z.type===1&&K.type===0?this.ga=this.ga.remove(Q):Z.type===1&&K.type===2?this.ga=this.ga.insert(Q,{type:1,doc:K.doc}):Z.type===0&&K.type===1?this.ga=this.ga.insert(Q,{type:2,doc:Z.doc}):v(63341,{Rt:Z,pa:K}):this.ga=this.ga.insert(Q,Z)}ya(){let Z=[];return this.ga.inorderTraversal((Q,K)=>{Z.push(K)}),Z}}class r6{constructor(Z,Q,K,J,W,X,U,Y,z){this.query=Z,this.docs=Q,this.oldDocs=K,this.docChanges=J,this.mutatedKeys=W,this.fromCache=X,this.syncStateChanged=U,this.excludesMetadataChanges=Y,this.hasCachedResults=z}static fromInitialDocuments(Z,Q,K,J,W){let X=[];return Q.forEach((U)=>{X.push({type:0,doc:U})}),new r6(Z,Q,v6.emptySet(Q),X,K,J,!0,!1,W)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(Z){if(!(this.fromCache===Z.fromCache&&this.hasCachedResults===Z.hasCachedResults&&this.syncStateChanged===Z.syncStateChanged&&this.mutatedKeys.isEqual(Z.mutatedKeys)&&u1(this.query,Z.query)&&this.docs.isEqual(Z.docs)&&this.oldDocs.isEqual(Z.oldDocs)))return!1;let Q=this.docChanges,K=Z.docChanges;if(Q.length!==K.length)return!1;for(let J=0;J<Q.length;J++)if(Q[J].type!==K[J].type||!Q[J].doc.isEqual(K[J].doc))return!1;return!0}}class $3{constructor(){this.wa=void 0,this.Sa=[]}ba(){return this.Sa.some((Z)=>Z.Da())}}class U3{constructor(){this.queries=pQ(),this.onlineState="Unknown",this.Ca=new Set}terminate(){(function(Q,K){let J=u(Q),W=J.queries;J.queries=pQ(),W.forEach((X,U)=>{for(let Y of U.Sa)Y.onError(K)})})(this,new L(A.ABORTED,"Firestore shutting down"))}}function pQ(){return new P6((Z)=>t5(Z),u1)}async function PW(Z,Q){let K=u(Z),J=3,W=Q.query,X=K.queries.get(W);X?!X.ba()&&Q.Da()&&(J=2):(X=new $3,J=Q.Da()?0:1);try{switch(J){case 0:X.wa=await K.onListen(W,!0);break;case 1:X.wa=await K.onListen(W,!1);break;case 2:await K.onFirstRemoteStoreListen(W)}}catch(U){let Y=t7(U,`Initialization of query '${y6(Q.query)}' failed`);return void Q.onError(Y)}if(K.queries.set(W,X),X.Sa.push(Q),Q.va(K.onlineState),X.wa)Q.Fa(X.wa)&&r7(K)}async function wW(Z,Q){let K=u(Z),J=Q.query,W=3,X=K.queries.get(J);if(X){let U=X.Sa.indexOf(Q);U>=0&&(X.Sa.splice(U,1),X.Sa.length===0?W=Q.Da()?0:1:!X.ba()&&Q.Da()&&(W=2))}switch(W){case 0:return K.queries.delete(J),K.onUnlisten(J,!0);case 1:return K.queries.delete(J),K.onUnlisten(J,!1);case 2:return K.onLastRemoteStoreUnlisten(J);default:return}}function BW(Z,Q){let K=u(Z),J=!1;for(let W of Q){let X=W.query,U=K.queries.get(X);if(U){for(let Y of U.Sa)Y.Fa(W)&&(J=!0);U.wa=W}}J&&r7(K)}function qW(Z,Q,K){let J=u(Z),W=J.queries.get(Q);if(W)for(let X of W.Sa)X.onError(K);J.queries.delete(Q)}function r7(Z){Z.Ca.forEach((Q)=>{Q.next()})}var w7,lQ;(lQ=w7||(w7={})).Ma="default",lQ.Cache="cache";class V3{constructor(Z,Q,K){this.query=Z,this.xa=Q,this.Oa=!1,this.Na=null,this.onlineState="Unknown",this.options=K||{}}Fa(Z){if(!this.options.includeMetadataChanges){let K=[];for(let J of Z.docChanges)J.type!==3&&K.push(J);Z=new r6(Z.query,Z.docs,Z.oldDocs,K,Z.mutatedKeys,Z.fromCache,Z.syncStateChanged,!0,Z.hasCachedResults)}let Q=!1;return this.Oa?this.Ba(Z)&&(this.xa.next(Z),Q=!0):this.La(Z,this.onlineState)&&(this.ka(Z),Q=!0),this.Na=Z,Q}onError(Z){this.xa.error(Z)}va(Z){this.onlineState=Z;let Q=!1;return this.Na&&!this.Oa&&this.La(this.Na,Z)&&(this.ka(this.Na),Q=!0),Q}La(Z,Q){if(!Z.fromCache)return!0;if(!this.Da())return!0;let K=Q!=="Offline";return(!this.options.qa||!K)&&(!Z.docs.isEmpty()||Z.hasCachedResults||Q==="Offline")}Ba(Z){if(Z.docChanges.length>0)return!0;let Q=this.Na&&this.Na.hasPendingWrites!==Z.hasPendingWrites;return!(!Z.syncStateChanged&&!Q)&&this.options.includeMetadataChanges===!0}ka(Z){Z=r6.fromInitialDocuments(Z.query,Z.docs,Z.mutatedKeys,Z.fromCache,Z.hasCachedResults),this.Oa=!0,this.xa.next(Z)}Da(){return this.options.source!==w7.Cache}}class b7{constructor(Z){this.key=Z}}class c7{constructor(Z){this.key=Z}}class Y3{constructor(Z,Q){this.query=Z,this.Ya=Q,this.Za=null,this.hasCachedResults=!1,this.current=!1,this.Xa=p(),this.mutatedKeys=p(),this.eu=r5(Z),this.tu=new v6(this.eu)}get nu(){return this.Ya}ru(Z,Q){let K=Q?Q.iu:new P7,J=Q?Q.tu:this.tu,W=Q?Q.mutatedKeys:this.mutatedKeys,X=J,U=!1,Y=this.query.limitType==="F"&&J.size===this.query.limit?J.last():null,z=this.query.limitType==="L"&&J.size===this.query.limit?J.first():null;if(Z.inorderTraversal((P,F)=>{let j=J.get(P),I=f1(this.query,F)?F:null,T=!!j&&this.mutatedKeys.has(j.key),C=!!I&&(I.hasLocalMutations||this.mutatedKeys.has(I.key)&&I.hasCommittedMutations),x=!1;if(j&&I)j.data.isEqual(I.data)?T!==C&&(K.track({type:3,doc:I}),x=!0):this.su(j,I)||(K.track({type:2,doc:I}),x=!0,(Y&&this.eu(I,Y)>0||z&&this.eu(I,z)<0)&&(U=!0));else!j&&I?(K.track({type:0,doc:I}),x=!0):j&&!I&&(K.track({type:1,doc:j}),x=!0,(Y||z)&&(U=!0));x&&(I?(X=X.add(I),W=C?W.add(P):W.delete(P)):(X=X.delete(P),W=W.delete(P)))}),this.query.limit!==null)for(;X.size>this.query.limit;){let P=this.query.limitType==="F"?X.last():X.first();X=X.delete(P.key),W=W.delete(P.key),K.track({type:1,doc:P})}return{tu:X,iu:K,Cs:U,mutatedKeys:W}}su(Z,Q){return Z.hasLocalMutations&&Q.hasCommittedMutations&&!Q.hasLocalMutations}applyChanges(Z,Q,K,J){let W=this.tu;this.tu=Z.tu,this.mutatedKeys=Z.mutatedKeys;let X=Z.iu.ya();X.sort((P,F)=>function(I,T){let C=(x)=>{switch(x){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return v(20277,{Rt:x})}};return C(I)-C(T)}(P.type,F.type)||this.eu(P.doc,F.doc)),this.ou(K),J=J??!1;let U=Q&&!J?this._u():[],Y=this.Xa.size===0&&this.current&&!J?1:0,z=Y!==this.Za;if(this.Za=Y,X.length!==0||z)return{snapshot:new r6(this.query,Z.tu,W,X,Z.mutatedKeys,Y===0,z,!1,!!K&&K.resumeToken.approximateByteSize()>0),au:U};return{au:U}}va(Z){return this.current&&Z==="Offline"?(this.current=!1,this.applyChanges({tu:this.tu,iu:new P7,mutatedKeys:this.mutatedKeys,Cs:!1},!1)):{au:[]}}uu(Z){return!this.Ya.has(Z)&&(!!this.tu.has(Z)&&!this.tu.get(Z).hasLocalMutations)}ou(Z){Z&&(Z.addedDocuments.forEach((Q)=>this.Ya=this.Ya.add(Q)),Z.modifiedDocuments.forEach((Q)=>{}),Z.removedDocuments.forEach((Q)=>this.Ya=this.Ya.delete(Q)),this.current=Z.current)}_u(){if(!this.current)return[];let Z=this.Xa;this.Xa=p(),this.tu.forEach((K)=>{this.uu(K.key)&&(this.Xa=this.Xa.add(K.key))});let Q=[];return Z.forEach((K)=>{this.Xa.has(K)||Q.push(new c7(K))}),this.Xa.forEach((K)=>{Z.has(K)||Q.push(new b7(K))}),Q}cu(Z){this.Ya=Z.Qs,this.Xa=p();let Q=this.ru(Z.documents);return this.applyChanges(Q,!0)}lu(){return r6.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,this.Za===0,this.hasCachedResults)}}var e7="SyncEngine";class z3{constructor(Z,Q,K){this.query=Z,this.targetId=Q,this.view=K}}class H3{constructor(Z){this.key=Z,this.hu=!1}}class P3{constructor(Z,Q,K,J,W,X){this.localStore=Z,this.remoteStore=Q,this.eventManager=K,this.sharedClientState=J,this.currentUser=W,this.maxConcurrentLimboResolutions=X,this.Pu={},this.Tu=new P6((U)=>t5(U),u1),this.Iu=new Map,this.Eu=new Set,this.du=new a(h.comparator),this.Au=new Map,this.Ru=new p1,this.Vu={},this.mu=new Map,this.fu=t6.cr(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return this.gu===!0}}async function FW(Z,Q,K=!0){let J=M3(Z),W,X=J.Tu.get(Q);return X?(J.sharedClientState.addLocalQueryTarget(X.targetId),W=X.view.lu()):W=await w3(J,Q,K,!0),W}async function DW(Z,Q){let K=M3(Z);await w3(K,Q,!0,!1)}async function w3(Z,Q,K,J){let W=await a2(Z.localStore,k0(Q)),X=W.targetId,U=Z.sharedClientState.addLocalQueryTarget(X,K),Y;return J&&(Y=await MW(Z,Q,X,U==="current",W.resumeToken)),Z.isPrimaryClient&&K&&Q3(Z.remoteStore,W),Y}async function MW(Z,Q,K,J,W){Z.pu=(j,I,T)=>async function(x,k,d,i){let n=k.view.ru(d);n.Cs&&(n=await mQ(x.localStore,k.query,!1).then(({documents:M})=>k.view.ru(M,n)));let F0=i&&i.targetChanges.get(k.targetId),O0=i&&i.targetMismatches.get(k.targetId)!=null,P0=k.view.applyChanges(n,x.isPrimaryClient,F0,O0);return iQ(x,k.targetId,P0.au),P0.snapshot}(Z,j,I,T);let X=await mQ(Z.localStore,Q,!0),U=new Y3(Q,X.Qs),Y=U.ru(X.documents),z=d8.createSynthesizedTargetChangeForCurrentChange(K,J&&Z.onlineState!=="Offline",W),P=U.applyChanges(Y,Z.isPrimaryClient,z);iQ(Z,K,P.au);let F=new z3(Q,K,U);return Z.Tu.set(Q,F),Z.Iu.has(K)?Z.Iu.get(K).push(Q):Z.Iu.set(K,[Q]),P.snapshot}async function RW(Z,Q,K){let J=u(Z),W=J.Tu.get(Q),X=J.Iu.get(W.targetId);if(X.length>1)return J.Iu.set(W.targetId,X.filter((U)=>!u1(U,Q))),void J.Tu.delete(Q);if(J.isPrimaryClient)J.sharedClientState.removeLocalQueryTarget(W.targetId),J.sharedClientState.isActiveQueryTarget(W.targetId)||await V7(J.localStore,W.targetId,!1).then(()=>{J.sharedClientState.clearQueryState(W.targetId),K&&s7(J.remoteStore,W.targetId),B7(J,W.targetId)}).catch(c6);else B7(J,W.targetId),await V7(J.localStore,W.targetId,!0)}async function NW(Z,Q){let K=u(Z),J=K.Tu.get(Q),W=K.Iu.get(J.targetId);K.isPrimaryClient&&W.length===1&&(K.sharedClientState.removeLocalQueryTarget(J.targetId),s7(K.remoteStore,J.targetId))}async function IW(Z,Q,K){let J=EW(Z);try{let W=await function(U,Y){let z=u(U),P=c.now(),F=Y.reduce((T,C)=>T.add(C.key),p()),j,I;return z.persistence.runTransaction("Locally write mutations","readwrite",(T)=>{let C=t0(),x=p();return z.Ns.getEntries(T,F).next((k)=>{C=k,C.forEach((d,i)=>{i.isValidDocument()||(x=x.add(d))})}).next(()=>z.localDocuments.getOverlayedDocuments(T,C)).next((k)=>{j=k;let d=[];for(let i of Y){let n=O2(i,j.get(i.key).overlayedDocument);n!=null&&d.push(new r0(i.key,n,y5(n.value.mapValue),h0.exists(!0)))}return z.mutationQueue.addMutationBatch(T,P,d,Y)}).next((k)=>{I=k;let d=k.applyToLocalDocumentSet(j,x);return z.documentOverlayCache.saveOverlays(T,k.batchId,d)})}).then(()=>({batchId:I.batchId,changes:c5(j)}))}(J.localStore,Q);J.sharedClientState.addPendingMutation(W.batchId),function(U,Y,z){let P=U.Vu[U.currentUser.toKey()];P||(P=new a(g)),P=P.insert(Y,z),U.Vu[U.currentUser.toKey()]=P}(J,W.batchId,K),await n8(J,W.changes),await i1(J.remoteStore)}catch(W){let X=t7(W,"Failed to persist write");K.reject(X)}}async function B3(Z,Q){let K=u(Z);try{let J=await b2(K.localStore,Q);Q.targetChanges.forEach((W,X)=>{let U=K.Au.get(X);U&&(o(W.addedDocuments.size+W.modifiedDocuments.size+W.removedDocuments.size<=1,22616),W.addedDocuments.size>0?U.hu=!0:W.modifiedDocuments.size>0?o(U.hu,14607):W.removedDocuments.size>0&&(o(U.hu,42227),U.hu=!1))}),await n8(K,J,Q)}catch(J){await c6(J)}}function sQ(Z,Q,K){let J=u(Z);if(J.isPrimaryClient&&K===0||!J.isPrimaryClient&&K===1){let W=[];J.Tu.forEach((X,U)=>{let Y=U.view.va(Q);Y.snapshot&&W.push(Y.snapshot)}),function(U,Y){let z=u(U);z.onlineState=Y;let P=!1;z.queries.forEach((F,j)=>{for(let I of j.Sa)I.va(Y)&&(P=!0)}),P&&r7(z)}(J.eventManager,Q),W.length&&J.Pu.H_(W),J.onlineState=Q,J.isPrimaryClient&&J.sharedClientState.setOnlineState(Q)}}async function OW(Z,Q,K){let J=u(Z);J.sharedClientState.updateQueryState(Q,"rejected",K);let W=J.Au.get(Q),X=W&&W.key;if(X){let U=new a(h.comparator);U=U.insert(X,q0.newNoDocument(X,m.min()));let Y=p().add(X),z=new g1(m.min(),new Map,new a(g),U,Y);await B3(J,z),J.du=J.du.remove(X),J.Au.delete(Q),a7(J)}else await V7(J.localStore,Q,!1).then(()=>B7(J,Q,K)).catch(c6)}async function jW(Z,Q){let K=u(Z),J=Q.batch.batchId;try{let W=await r2(K.localStore,Q);F3(K,J,null),q3(K,J),K.sharedClientState.updateMutationState(J,"acknowledged"),await n8(K,W)}catch(W){await c6(W)}}async function _W(Z,Q,K){let J=u(Z);try{let W=await function(U,Y){let z=u(U);return z.persistence.runTransaction("Reject batch","readwrite-primary",(P)=>{let F;return z.mutationQueue.lookupMutationBatch(P,Y).next((j)=>(o(j!==null,37113),F=j.keys(),z.mutationQueue.removeMutationBatch(P,j))).next(()=>z.mutationQueue.performConsistencyCheck(P)).next(()=>z.documentOverlayCache.removeOverlaysForBatchId(P,F,Y)).next(()=>z.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(P,F)).next(()=>z.localDocuments.getDocuments(P,F))})}(J.localStore,Q);F3(J,Q,K),q3(J,Q),J.sharedClientState.updateMutationState(Q,"rejected",K),await n8(J,W)}catch(W){await c6(W)}}function q3(Z,Q){(Z.mu.get(Q)||[]).forEach((K)=>{K.resolve()}),Z.mu.delete(Q)}function F3(Z,Q,K){let J=u(Z),W=J.Vu[J.currentUser.toKey()];if(W){let X=W.get(Q);X&&(K?X.reject(K):X.resolve(),W=W.remove(Q)),J.Vu[J.currentUser.toKey()]=W}}function B7(Z,Q,K=null){Z.sharedClientState.removeLocalQueryTarget(Q);for(let J of Z.Iu.get(Q))Z.Tu.delete(J),K&&Z.Pu.yu(J,K);if(Z.Iu.delete(Q),Z.isPrimaryClient)Z.Ru.jr(Q).forEach((J)=>{Z.Ru.containsKey(J)||D3(Z,J)})}function D3(Z,Q){Z.Eu.delete(Q.path.canonicalString());let K=Z.du.get(Q);K!==null&&(s7(Z.remoteStore,K),Z.du=Z.du.remove(Q),Z.Au.delete(K),a7(Z))}function iQ(Z,Q,K){for(let J of K)if(J instanceof b7)Z.Ru.addReference(J.key,Q),AW(Z,J);else if(J instanceof c7)y(e7,"Document no longer in limbo: "+J.key),Z.Ru.removeReference(J.key,Q),Z.Ru.containsKey(J.key)||D3(Z,J.key);else v(19791,{wu:J})}function AW(Z,Q){let K=Q.key,J=K.path.canonicalString();Z.du.get(K)||Z.Eu.has(J)||(y(e7,"New document in limbo: "+K),Z.Eu.add(J),a7(Z))}function a7(Z){for(;Z.Eu.size>0&&Z.du.size<Z.maxConcurrentLimboResolutions;){let Q=Z.Eu.values().next().value;Z.Eu.delete(Q);let K=new h(r.fromString(Q)),J=Z.fu.next();Z.Au.set(J,new H3(K)),Z.du=Z.du.insert(K,J),Q3(Z.remoteStore,new X6(k0(o5(K.path)),J,"TargetPurposeLimboResolution",l8.ce))}}async function n8(Z,Q,K){let J=u(Z),W=[],X=[],U=[];J.Tu.isEmpty()||(J.Tu.forEach((Y,z)=>{U.push(J.pu(z,Q,K).then((P)=>{if((P||K)&&J.isPrimaryClient){let F=P?!P.fromCache:K?.targetChanges.get(z.targetId)?.current;J.sharedClientState.updateQueryState(z.targetId,F?"current":"not-current")}if(P){W.push(P);let F=f7.As(z.targetId,P);X.push(F)}}))}),await Promise.all(U),J.Pu.H_(W),await async function(z,P){let F=u(z);try{await F.persistence.runTransaction("notifyLocalViewChanges","readwrite",(j)=>S.forEach(P,(I)=>S.forEach(I.Es,(T)=>F.persistence.referenceDelegate.addReference(j,I.targetId,T)).next(()=>S.forEach(I.ds,(T)=>F.persistence.referenceDelegate.removeReference(j,I.targetId,T)))))}catch(j){if(!e6(j))throw j;y(g7,"Failed to update sequence numbers: "+j)}for(let j of P){let I=j.targetId;if(!j.fromCache){let T=F.Ms.get(I),C=T.snapshotVersion,x=T.withLastLimboFreeSnapshotVersion(C);F.Ms=F.Ms.insert(I,x)}}}(J.localStore,X))}async function SW(Z,Q){let K=u(Z);if(!K.currentUser.isEqual(Q)){y(e7,"User change. New user:",Q.toKey());let J=await lK(K.localStore,Q);K.currentUser=Q,function(X,U){X.mu.forEach((Y)=>{Y.forEach((z)=>{z.reject(new L(A.CANCELLED,U))})}),X.mu.clear()}(K,"'waitForPendingWrites' promise is rejected due to a user change."),K.sharedClientState.handleUserChange(Q,J.removedBatchIds,J.addedBatchIds),await n8(K,J.Ls)}}function TW(Z,Q){let K=u(Z),J=K.Au.get(Q);if(J&&J.hu)return p().add(J.key);{let W=p(),X=K.Iu.get(Q);if(!X)return W;for(let U of X){let Y=K.Tu.get(U);W=W.unionWith(Y.view.nu)}return W}}function M3(Z){let Q=u(Z);return Q.remoteStore.remoteSyncer.applyRemoteEvent=B3.bind(null,Q),Q.remoteStore.remoteSyncer.getRemoteKeysForTarget=TW.bind(null,Q),Q.remoteStore.remoteSyncer.rejectListen=OW.bind(null,Q),Q.Pu.H_=BW.bind(null,Q.eventManager),Q.Pu.yu=qW.bind(null,Q.eventManager),Q}function EW(Z){let Q=u(Z);return Q.remoteStore.remoteSyncer.applySuccessfulWrite=jW.bind(null,Q),Q.remoteStore.remoteSyncer.rejectFailedWrite=_W.bind(null,Q),Q}class g8{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(Z){this.serializer=l1(Z.databaseInfo.databaseId),this.sharedClientState=this.Du(Z),this.persistence=this.Cu(Z),await this.persistence.start(),this.localStore=this.vu(Z),this.gcScheduler=this.Fu(Z,this.localStore),this.indexBackfillerScheduler=this.Mu(Z,this.localStore)}Fu(Z,Q){return null}Mu(Z,Q){return null}vu(Z){return t2(this.persistence,new gK,Z.initialUser,this.serializer)}Cu(Z){return new m7(u7.mi,this.serializer)}Du(Z){return new iK}async terminate(){this.gcScheduler?.stop(),this.indexBackfillerScheduler?.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}g8.provider={build:()=>new g8};class R3 extends g8{constructor(Z){super(),this.cacheSizeBytes=Z}Fu(Z,Q){o(this.persistence.referenceDelegate instanceof L1,46915);let K=this.persistence.referenceDelegate.garbageCollector;return new AK(K,Z.asyncQueue,Q)}Cu(Z){let Q=this.cacheSizeBytes!==void 0?N0.withCacheSize(this.cacheSizeBytes):N0.DEFAULT;return new m7((K)=>L1.mi(K,Q),this.serializer)}}class y1{async initialize(Z,Q){this.localStore||(this.localStore=Z.localStore,this.sharedClientState=Z.sharedClientState,this.datastore=this.createDatastore(Q),this.remoteStore=this.createRemoteStore(Q),this.eventManager=this.createEventManager(Q),this.syncEngine=this.createSyncEngine(Q,!Z.synchronizeTabs),this.sharedClientState.onlineStateHandler=(K)=>sQ(this.syncEngine,K,1),this.remoteStore.remoteSyncer.handleCredentialChange=SW.bind(null,this.syncEngine),await HW(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(Z){return function(){return new U3}()}createDatastore(Z){let Q=l1(Z.databaseInfo.databaseId),K=function(W){return new tK(W)}(Z.databaseInfo);return function(W,X,U,Y){return new eK(W,X,U,Y)}(Z.authCredentials,Z.appCheckCredentials,K,Q)}createRemoteStore(Z){return function(K,J,W,X,U){return new Z3(K,J,W,X,U)}(this.localStore,this.datastore,Z.asyncQueue,(Q)=>sQ(this.syncEngine,Q,0),function(){return z7.v()?new z7:new dK}())}createSyncEngine(Z,Q){return function(J,W,X,U,Y,z,P){let F=new P3(J,W,X,U,Y,z);return P&&(F.gu=!0),F}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,Z.initialUser,Z.maxConcurrentLimboResolutions,Q)}async terminate(){await async function(Q){let K=u(Q);y(O6,"RemoteStore shutting down."),K.Ea.add(5),await o8(K),K.Aa.shutdown(),K.Ra.set("Unknown")}(this.remoteStore),this.datastore?.terminate(),this.eventManager?.terminate()}}y1.provider={build:()=>new y1};class N3{constructor(Z){this.observer=Z,this.muted=!1}next(Z){this.muted||this.observer.next&&this.Ou(this.observer.next,Z)}error(Z){this.muted||(this.observer.error?this.Ou(this.observer.error,Z):d0("Uncaught Error in snapshot listener:",Z.toString()))}Nu(){this.muted=!0}Ou(Z,Q){setTimeout(()=>{this.muted||Z(Q)},0)}}var z6="FirestoreClient";class I3{constructor(Z,Q,K,J,W){this.authCredentials=Z,this.appCheckCredentials=Q,this.asyncQueue=K,this.databaseInfo=J,this.user=V0.UNAUTHENTICATED,this.clientId=k1.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=W,this.authCredentials.start(K,async(X)=>{y(z6,"Received user=",X.uid),await this.authCredentialListener(X),this.user=X}),this.appCheckCredentials.start(K,(X)=>(y(z6,"Received new app check token=",X),this.appCheckCredentialListener(X,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(Z){this.authCredentialListener=Z}setAppCheckTokenChangeListener(Z){this.appCheckCredentialListener=Z}terminate(){this.asyncQueue.enterRestrictedMode();let Z=new i0;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),Z.resolve()}catch(Q){let K=t7(Q,"Failed to shutdown persistence");Z.reject(K)}}),Z.promise}}async function t9(Z,Q){Z.asyncQueue.verifyOperationInProgress(),y(z6,"Initializing OfflineComponentProvider");let K=Z.configuration;await Q.initialize(K);let J=K.initialUser;Z.setCredentialChangeListener(async(W)=>{J.isEqual(W)||(await lK(Q.localStore,W),J=W)}),Q.persistence.setDatabaseDeletedListener(()=>Z.terminate()),Z._offlineComponents=Q}async function dQ(Z,Q){Z.asyncQueue.verifyOperationInProgress();let K=await LW(Z);y(z6,"Initializing OnlineComponentProvider"),await Q.initialize(K,Z.configuration),Z.setCredentialChangeListener((J)=>gQ(Q.remoteStore,J)),Z.setAppCheckTokenChangeListener((J,W)=>gQ(Q.remoteStore,W)),Z._onlineComponents=Q}async function LW(Z){if(!Z._offlineComponents)if(Z._uninitializedComponentsProvider){y(z6,"Using user provided OfflineComponentProvider");try{await t9(Z,Z._uninitializedComponentsProvider._offline)}catch(Q){let K=Q;if(!function(W){return W.name==="FirebaseError"?W.code===A.FAILED_PRECONDITION||W.code===A.UNIMPLEMENTED:!(typeof DOMException<"u"&&W instanceof DOMException)||W.code===22||W.code===20||W.code===11}(K))throw K;f6("Error using user provided cache. Falling back to memory cache: "+K),await t9(Z,new g8)}}else y(z6,"Using default OfflineComponentProvider"),await t9(Z,new R3(void 0));return Z._offlineComponents}async function O3(Z){return Z._onlineComponents||(Z._uninitializedComponentsProvider?(y(z6,"Using user provided OnlineComponentProvider"),await dQ(Z,Z._uninitializedComponentsProvider._online)):(y(z6,"Using default OnlineComponentProvider"),await dQ(Z,new y1))),Z._onlineComponents}function xW(Z){return O3(Z).then((Q)=>Q.syncEngine)}async function yW(Z){let Q=await O3(Z),K=Q.eventManager;return K.onListen=FW.bind(null,Q.syncEngine),K.onUnlisten=RW.bind(null,Q.syncEngine),K.onFirstRemoteStoreListen=DW.bind(null,Q.syncEngine),K.onLastRemoteStoreUnlisten=NW.bind(null,Q.syncEngine),K}function CW(Z,Q,K={}){let J=new i0;return Z.asyncQueue.enqueueAndForget(async()=>function(X,U,Y,z,P){let F=new N3({next:(I)=>{F.Nu(),U.enqueueAndForget(()=>wW(X,j)),I.fromCache&&z.source==="server"?P.reject(new L(A.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):P.resolve(I)},error:(I)=>P.reject(I)}),j=new V3(Y,F,{includeMetadataChanges:!0,qa:!0});return PW(X,j)}(await yW(Z),Z.asyncQueue,Q,K,J)),J.promise}function j3(Z){let Q={};return Z.timeoutSeconds!==void 0&&(Q.timeoutSeconds=Z.timeoutSeconds),Q}var oQ=new Map,_3="firestore.googleapis.com",nQ=!0;class q7{constructor(Z){if(Z.host===void 0){if(Z.ssl!==void 0)throw new L(A.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=_3,this.ssl=nQ}else this.host=Z.host,this.ssl=Z.ssl??nQ;if(this.isUsingEmulator=Z.emulatorOptions!==void 0,this.credentials=Z.credentials,this.ignoreUndefinedProperties=!!Z.ignoreUndefinedProperties,this.localCache=Z.localCache,Z.cacheSizeBytes===void 0)this.cacheSizeBytes=jK;else{if(Z.cacheSizeBytes!==-1&&Z.cacheSizeBytes<d2)throw new L(A.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=Z.cacheSizeBytes}gG("experimentalForceLongPolling",Z.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",Z.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!Z.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:Z.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!Z.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=j3(Z.experimentalLongPollingOptions??{}),function(K){if(K.timeoutSeconds!==void 0){if(isNaN(K.timeoutSeconds))throw new L(A.INVALID_ARGUMENT,`invalid long polling timeout: ${K.timeoutSeconds} (must not be NaN)`);if(K.timeoutSeconds<5)throw new L(A.INVALID_ARGUMENT,`invalid long polling timeout: ${K.timeoutSeconds} (minimum allowed value is 5)`);if(K.timeoutSeconds>30)throw new L(A.INVALID_ARGUMENT,`invalid long polling timeout: ${K.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!Z.useFetchStreams}isEqual(Z){return this.host===Z.host&&this.ssl===Z.ssl&&this.credentials===Z.credentials&&this.cacheSizeBytes===Z.cacheSizeBytes&&this.experimentalForceLongPolling===Z.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===Z.experimentalAutoDetectLongPolling&&function(K,J){return K.timeoutSeconds===J.timeoutSeconds}(this.experimentalLongPollingOptions,Z.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===Z.ignoreUndefinedProperties&&this.useFetchStreams===Z.useFetchStreams}}class t8{constructor(Z,Q,K,J){this._authCredentials=Z,this._appCheckCredentials=Q,this._databaseId=K,this._app=J,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new q7({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new L(A.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(Z){if(this._settingsFrozen)throw new L(A.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new q7(Z),this._emulatorOptions=Z.emulatorOptions||{},Z.credentials!==void 0&&(this._authCredentials=function(K){if(!K)return new aQ;switch(K.type){case"firstParty":return new J5(K.sessionIndex||"0",K.iamToken||null,K.authTokenFactory||null);case"provider":return K.client;default:throw new L(A.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(Z.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(Q){let K=oQ.get(Q);K&&(y("ComponentProvider","Removing Datastore"),oQ.delete(Q),K.terminate())}(this),Promise.resolve()}}function kW(Z,Q,K,J={}){Z=p6(Z,t8);let W=B1(Q),X=Z._getSettings(),U={...X,emulatorOptions:Z._getEmulatorOptions()},Y=`${Q}:${K}`;W&&(x4(`https://${Y}`),C4("Firestore",!0)),X.host!==_3&&X.host!==Y&&f6("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");let z={...X,host:Y,ssl:W,emulatorOptions:J};if(!E6(z,U)&&(Z._setSettings(z),J.mockUserToken)){let P,F;if(typeof J.mockUserToken=="string")P=J.mockUserToken,F=V0.MOCK_USER;else{P=y4(J.mockUserToken,Z._app?.options.projectId);let j=J.mockUserToken.sub||J.mockUserToken.user_id;if(!j)throw new L(A.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");F=new V0(j)}Z._authCredentials=new Z5(new R7(P,F))}}class w6{constructor(Z,Q,K){this.converter=Q,this._query=K,this.type="query",this.firestore=Z}withConverter(Z){return new w6(this.firestore,Z,this._query)}}class X0{constructor(Z,Q,K){this.converter=Q,this._key=K,this.type="document",this.firestore=Z}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new $6(this.firestore,this.converter,this._key.path.popLast())}withConverter(Z){return new X0(this.firestore,Z,this._key)}toJSON(){return{type:X0._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(Z,Q,K){if(p8(Q,X0._jsonSchema))return new X0(Z,K||null,new h(r.fromString(Q.referencePath)))}}X0._jsonSchemaVersion="firestore/documentReference/1.0",X0._jsonSchema={type:J0("string",X0._jsonSchemaVersion),referencePath:J0("string")};class $6 extends w6{constructor(Z,Q,K){super(Z,Q,o5(K)),this._path=K,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){let Z=this._path.popLast();return Z.isEmpty()?null:new X0(this.firestore,null,new h(Z))}withConverter(Z){return new $6(this.firestore,Z,this._path)}}function d1(Z,Q,...K){if(Z=x0(Z),W5("collection","path",Q),Z instanceof t8){let J=r.fromString(Q,...K);return HQ(J),new $6(Z,null,J)}{if(!(Z instanceof X0||Z instanceof $6))throw new L(A.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let J=Z._path.child(r.fromString(Q,...K));return HQ(J),new $6(Z.firestore,null,J)}}function o1(Z,Q,...K){if(Z=x0(Z),arguments.length===1&&(Q=k1.newId()),W5("doc","path",Q),Z instanceof t8){let J=r.fromString(Q,...K);return zQ(J),new X0(Z,null,new h(J))}{if(!(Z instanceof X0||Z instanceof $6))throw new L(A.INVALID_ARGUMENT,"Expected first argument to doc() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let J=Z._path.child(r.fromString(Q,...K));return zQ(J),new X0(Z.firestore,Z instanceof $6?Z.converter:null,new h(J))}}var tQ="AsyncQueue";class F7{constructor(Z=Promise.resolve()){this.Xu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new p7(this,"async_queue_retry"),this._c=()=>{let K=n9();K&&y(tQ,"Visibility state changed to "+K.visibilityState),this.M_.w_()},this.ac=Z;let Q=n9();Q&&typeof Q.addEventListener=="function"&&Q.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(Z){this.enqueue(Z)}enqueueAndForgetEvenWhileRestricted(Z){this.uc(),this.cc(Z)}enterRestrictedMode(Z){if(!this.ec){this.ec=!0,this.sc=Z||!1;let Q=n9();Q&&typeof Q.removeEventListener=="function"&&Q.removeEventListener("visibilitychange",this._c)}}enqueue(Z){if(this.uc(),this.ec)return new Promise(()=>{});let Q=new i0;return this.cc(()=>this.ec&&this.sc?Promise.resolve():(Z().then(Q.resolve,Q.reject),Q.promise)).then(()=>Q.promise)}enqueueRetryable(Z){this.enqueueAndForget(()=>(this.Xu.push(Z),this.lc()))}async lc(){if(this.Xu.length!==0){try{await this.Xu[0](),this.Xu.shift(),this.M_.reset()}catch(Z){if(!e6(Z))throw Z;y(tQ,"Operation failed with retryable error: "+Z)}this.Xu.length>0&&this.M_.p_(()=>this.lc())}}cc(Z){let Q=this.ac.then(()=>(this.rc=!0,Z().catch((K)=>{throw this.nc=K,this.rc=!1,d0("INTERNAL UNHANDLED ERROR: ",rQ(K)),K}).then((K)=>(this.rc=!1,K))));return this.ac=Q,Q}enqueueAfterDelay(Z,Q,K){this.uc(),this.oc.indexOf(Z)>-1&&(Q=0);let J=n7.createAndSchedule(this,Z,Q,K,(W)=>this.hc(W));return this.tc.push(J),J}uc(){this.nc&&v(47125,{Pc:rQ(this.nc)})}verifyOperationInProgress(){}async Tc(){let Z;do Z=this.ac,await Z;while(Z!==this.ac)}Ic(Z){for(let Q of this.tc)if(Q.timerId===Z)return!0;return!1}Ec(Z){return this.Tc().then(()=>{this.tc.sort((Q,K)=>Q.targetTimeMs-K.targetTimeMs);for(let Q of this.tc)if(Q.skipDelay(),Z!=="all"&&Q.timerId===Z)break;return this.Tc()})}dc(Z){this.oc.push(Z)}hc(Z){let Q=this.tc.indexOf(Z);this.tc.splice(Q,1)}}function rQ(Z){let Q=Z.message||"";return Z.stack&&(Q=Z.stack.includes(Z.message)?Z.stack:Z.message+`
`+Z.stack),Q}class r8 extends t8{constructor(Z,Q,K,J){super(Z,Q,K,J),this.type="firestore",this._queue=new F7,this._persistenceKey=J?.name||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){let Z=this._firestoreClient.terminate();this._queue=new F7(Z),this._firestoreClient=void 0,await Z}}}function A3(Z,Q){let K=typeof Z=="object"?Z:QQ(),J=typeof Z=="string"?Z:Q||S1,W=c4(K,"firestore").getImmediate({identifier:J});if(!W._initialized){let X=L4("firestore");X&&kW(W,...X)}return W}function S3(Z){if(Z._terminated)throw new L(A.FAILED_PRECONDITION,"The client has already been terminated.");return Z._firestoreClient||hW(Z),Z._firestoreClient}function hW(Z){let Q=Z._freezeSettings(),K=function(W,X,U,Y){return new T5(W,X,U,Y.host,Y.ssl,Y.experimentalForceLongPolling,Y.experimentalAutoDetectLongPolling,j3(Y.experimentalLongPollingOptions),Y.useFetchStreams,Y.isUsingEmulator)}(Z._databaseId,Z._app?.options.appId||"",Z._persistenceKey,Q);Z._componentsProvider||Q.localCache?._offlineComponentProvider&&Q.localCache?._onlineComponentProvider&&(Z._componentsProvider={_offline:Q.localCache._offlineComponentProvider,_online:Q.localCache._onlineComponentProvider}),Z._firestoreClient=new I3(Z._authCredentials,Z._appCheckCredentials,Z._queue,K,Z._componentsProvider&&function(W){let X=W?._online.build();return{_offline:W?._offline.build(X),_online:X}}(Z._componentsProvider))}class A0{constructor(Z){this._byteString=Z}static fromBase64String(Z){try{return new A0(H0.fromBase64String(Z))}catch(Q){throw new L(A.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+Q)}}static fromUint8Array(Z){return new A0(H0.fromUint8Array(Z))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(Z){return this._byteString.isEqual(Z._byteString)}toJSON(){return{type:A0._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(Z){if(p8(Z,A0._jsonSchema))return A0.fromBase64String(Z.bytes)}}A0._jsonSchemaVersion="firestore/bytes/1.0",A0._jsonSchema={type:J0("string",A0._jsonSchemaVersion),bytes:J0("string")};class b8{constructor(...Z){for(let Q=0;Q<Z.length;++Q)if(Z[Q].length===0)throw new L(A.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new z0(Z)}isEqual(Z){return this._internalPath.isEqual(Z._internalPath)}}class n1{constructor(Z){this._methodName=Z}}class m0{constructor(Z,Q){if(!isFinite(Z)||Z<-90||Z>90)throw new L(A.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+Z);if(!isFinite(Q)||Q<-180||Q>180)throw new L(A.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+Q);this._lat=Z,this._long=Q}get latitude(){return this._lat}get longitude(){return this._long}isEqual(Z){return this._lat===Z._lat&&this._long===Z._long}_compareTo(Z){return g(this._lat,Z._lat)||g(this._long,Z._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:m0._jsonSchemaVersion}}static fromJSON(Z){if(p8(Z,m0._jsonSchema))return new m0(Z.latitude,Z.longitude)}}m0._jsonSchemaVersion="firestore/geoPoint/1.0",m0._jsonSchema={type:J0("string",m0._jsonSchemaVersion),latitude:J0("number"),longitude:J0("number")};class u0{constructor(Z){this._values=(Z||[]).map((Q)=>Q)}toArray(){return this._values.map((Z)=>Z)}isEqual(Z){return function(K,J){if(K.length!==J.length)return!1;for(let W=0;W<K.length;++W)if(K[W]!==J[W])return!1;return!0}(this._values,Z._values)}toJSON(){return{type:u0._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(Z){if(p8(Z,u0._jsonSchema)){if(Array.isArray(Z.vectorValues)&&Z.vectorValues.every((Q)=>typeof Q=="number"))return new u0(Z.vectorValues);throw new L(A.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}u0._jsonSchemaVersion="firestore/vectorValue/1.0",u0._jsonSchema={type:J0("string",u0._jsonSchemaVersion),vectorValues:J0("object")};var vW=/^__.*__$/;class T3{constructor(Z,Q,K){this.data=Z,this.fieldMask=Q,this.fieldTransforms=K}toMutation(Z,Q){return this.fieldMask!==null?new r0(Z,this.data,this.fieldMask,Q,this.fieldTransforms):new a6(Z,this.data,Q,this.fieldTransforms)}}class ZZ{constructor(Z,Q,K){this.data=Z,this.fieldMask=Q,this.fieldTransforms=K}toMutation(Z,Q){return new r0(Z,this.data,this.fieldMask,Q,this.fieldTransforms)}}function E3(Z){switch(Z){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw v(40011,{Ac:Z})}}class QZ{constructor(Z,Q,K,J,W,X){this.settings=Z,this.databaseId=Q,this.serializer=K,this.ignoreUndefinedProperties=J,W===void 0&&this.Rc(),this.fieldTransforms=W||[],this.fieldMask=X||[]}get path(){return this.settings.path}get Ac(){return this.settings.Ac}Vc(Z){return new QZ({...this.settings,...Z},this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}mc(Z){let Q=this.path?.child(Z),K=this.Vc({path:Q,fc:!1});return K.gc(Z),K}yc(Z){let Q=this.path?.child(Z),K=this.Vc({path:Q,fc:!1});return K.Rc(),K}wc(Z){return this.Vc({path:void 0,fc:!0})}Sc(Z){return C1(Z,this.settings.methodName,this.settings.bc||!1,this.path,this.settings.Dc)}contains(Z){return this.fieldMask.find((Q)=>Z.isPrefixOf(Q))!==void 0||this.fieldTransforms.find((Q)=>Z.isPrefixOf(Q.field))!==void 0}Rc(){if(this.path)for(let Z=0;Z<this.path.length;Z++)this.gc(this.path.get(Z))}gc(Z){if(Z.length===0)throw this.Sc("Document fields must not be empty");if(E3(this.Ac)&&vW.test(Z))throw this.Sc('Document fields cannot begin and end with "__"')}}class L3{constructor(Z,Q,K){this.databaseId=Z,this.ignoreUndefinedProperties=Q,this.serializer=K||l1(Z)}Cc(Z,Q,K,J=!1){return new QZ({Ac:Z,methodName:Q,Dc:K,path:z0.emptyPath(),fc:!1,bc:J},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function KZ(Z){let Q=Z._freezeSettings(),K=l1(Z._databaseId);return new L3(Z._databaseId,!!Q.ignoreUndefinedProperties,K)}function mW(Z,Q,K,J,W,X={}){let U=Z.Cc(X.merge||X.mergeFields?2:0,Q,K,W);JZ("Data must be an object, but it was:",U,J);let Y=x3(J,U),z,P;if(X.merge)z=new _0(U.fieldMask),P=U.fieldTransforms;else if(X.mergeFields){let F=[];for(let j of X.mergeFields){let I=D7(Q,j,K);if(!U.contains(I))throw new L(A.INVALID_ARGUMENT,`Field '${I}' is specified in your field mask but missing from your input data.`);C3(F,I)||F.push(I)}z=new _0(F),P=U.fieldTransforms.filter((j)=>z.covers(j.field))}else z=null,P=U.fieldTransforms;return new T3(new I0(Y),z,P)}class t1 extends n1{_toFieldTransform(Z){if(Z.Ac!==2)throw Z.Ac===1?Z.Sc(`${this._methodName}() can only appear at the top level of your update data`):Z.Sc(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return Z.fieldMask.push(Z.path),null}isEqual(Z){return Z instanceof t1}}function uW(Z,Q,K,J){let W=Z.Cc(1,Q,K);JZ("Data must be an object, but it was:",W,J);let X=[],U=I0.empty();H6(J,(z,P)=>{let F=GZ(Q,z,K);P=x0(P);let j=W.yc(F);if(P instanceof t1)X.push(F);else{let I=c8(P,j);I!=null&&(X.push(F),U.set(F,I))}});let Y=new _0(X);return new ZZ(U,Y,W.fieldTransforms)}function fW(Z,Q,K,J,W,X){let U=Z.Cc(1,Q,K),Y=[D7(Q,J,K)],z=[W];if(X.length%2!=0)throw new L(A.INVALID_ARGUMENT,`Function ${Q}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let I=0;I<X.length;I+=2)Y.push(D7(Q,X[I])),z.push(X[I+1]);let P=[],F=I0.empty();for(let I=Y.length-1;I>=0;--I)if(!C3(P,Y[I])){let T=Y[I],C=z[I];C=x0(C);let x=U.yc(T);if(C instanceof t1)P.push(T);else{let k=c8(C,x);k!=null&&(P.push(T),F.set(T,k))}}let j=new _0(P);return new ZZ(F,j,U.fieldTransforms)}function gW(Z,Q,K,J=!1){return c8(K,Z.Cc(J?4:3,Q))}function c8(Z,Q){if(y3(Z=x0(Z)))return JZ("Unsupported field value:",Q,Z),x3(Z,Q);if(Z instanceof n1)return function(J,W){if(!E3(W.Ac))throw W.Sc(`${J._methodName}() can only be used with update() and set()`);if(!W.path)throw W.Sc(`${J._methodName}() is not currently supported inside arrays`);let X=J._toFieldTransform(W);X&&W.fieldTransforms.push(X)}(Z,Q),null;if(Z===void 0&&Q.ignoreUndefinedProperties)return null;if(Q.path&&Q.fieldMask.push(Q.path),Z instanceof Array){if(Q.settings.fc&&Q.Ac!==4)throw Q.Sc("Nested arrays are not supported");return function(J,W){let X=[],U=0;for(let Y of J){let z=c8(Y,W.wc(U));z==null&&(z={nullValue:"NULL_VALUE"}),X.push(z),U++}return{arrayValue:{values:X}}}(Z,Q)}return function(J,W){if((J=x0(J))===null)return{nullValue:"NULL_VALUE"};if(typeof J=="number")return D2(W.serializer,J);if(typeof J=="boolean")return{booleanValue:J};if(typeof J=="string")return{stringValue:J};if(J instanceof Date){let X=c.fromDate(J);return{timestampValue:E1(W.serializer,X)}}if(J instanceof c){let X=new c(J.seconds,1000*Math.floor(J.nanoseconds/1000));return{timestampValue:E1(W.serializer,X)}}if(J instanceof m0)return{geoPointValue:{latitude:J.latitude,longitude:J.longitude}};if(J instanceof A0)return{bytesValue:wK(W.serializer,J._byteString)};if(J instanceof X0){let X=W.databaseId,U=J.firestore._databaseId;if(!U.isEqual(X))throw W.Sc(`Document reference is for database ${U.projectId}/${U.database} but should be for database ${X.projectId}/${X.database}`);return{referenceValue:v7(J.firestore._databaseId||W.databaseId,J._key.path)}}if(J instanceof u0)return function(U,Y){return{mapValue:{fields:{[j7]:{stringValue:_7},[l6]:{arrayValue:{values:U.toArray().map((P)=>{if(typeof P!="number")throw Y.Sc("VectorValues must only contain numeric values.");return L7(Y.serializer,P)})}}}}}}(J,W);throw W.Sc(`Unsupported field value: ${h1(J)}`)}(Z,Q)}function x3(Z,Q){let K={};return O5(Z)?Q.path&&Q.path.length>0&&Q.fieldMask.push(Q.path):H6(Z,(J,W)=>{let X=c8(W,Q.mc(J));X!=null&&(K[J]=X)}),{mapValue:{fields:K}}}function y3(Z){return!(typeof Z!="object"||Z===null||Z instanceof Array||Z instanceof Date||Z instanceof c||Z instanceof m0||Z instanceof A0||Z instanceof X0||Z instanceof n1||Z instanceof u0)}function JZ(Z,Q,K){if(!y3(K)||!X5(K)){let J=h1(K);throw J==="an object"?Q.Sc(Z+" a custom object"):Q.Sc(Z+" "+J)}}function D7(Z,Q,K){if((Q=x0(Q))instanceof b8)return Q._internalPath;if(typeof Q=="string")return GZ(Z,Q);throw C1("Field path arguments must be of type string or ",Z,!1,void 0,K)}var pW=new RegExp("[~\\*/\\[\\]]");function GZ(Z,Q,K){if(Q.search(pW)>=0)throw C1(`Invalid field path (${Q}). Paths must not contain '~', '*', '/', '[', or ']'`,Z,!1,void 0,K);try{return new b8(...Q.split("."))._internalPath}catch(J){throw C1(`Invalid field path (${Q}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,Z,!1,void 0,K)}}function C1(Z,Q,K,J,W){let X=J&&!J.isEmpty(),U=W!==void 0,Y=`Function ${Q}() called with invalid data`;K&&(Y+=" (via `toFirestore()`)"),Y+=". ";let z="";return(X||U)&&(z+=" (found",X&&(z+=` in field ${J}`),U&&(z+=` in document ${W}`),z+=")"),new L(A.INVALID_ARGUMENT,Y+Z+z)}function C3(Z,Q){return Z.some((K)=>K.isEqual(Q))}class WZ{constructor(Z,Q,K,J,W){this._firestore=Z,this._userDataWriter=Q,this._key=K,this._document=J,this._converter=W}get id(){return this._key.path.lastSegment()}get ref(){return new X0(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){let Z=new k3(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(Z)}return this._userDataWriter.convertValue(this._document.data.value)}}get(Z){if(this._document){let Q=this._document.data.field(XZ("DocumentSnapshot.get",Z));if(Q!==null)return this._userDataWriter.convertValue(Q)}}}class k3 extends WZ{data(){return super.data()}}function XZ(Z,Q){return typeof Q=="string"?GZ(Z,Q):Q instanceof b8?Q._internalPath:Q._delegate._internalPath}function lW(Z){if(Z.limitType==="L"&&Z.explicitOrderBy.length===0)throw new L(A.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class r1{}class b1 extends r1{}function $Z(Z,Q,...K){let J=[];Q instanceof r1&&J.push(Q),J=J.concat(K),function(X){let U=X.filter((z)=>z instanceof VZ).length,Y=X.filter((z)=>z instanceof UZ).length;if(U>1||U>0&&Y>0)throw new L(A.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(J);for(let W of J)Z=W._apply(Z);return Z}class UZ extends b1{constructor(Z,Q,K){super(),this._field=Z,this._op=Q,this._value=K,this.type="where"}static _create(Z,Q,K){return new UZ(Z,Q,K)}_apply(Z){let Q=this._parse(Z);return v3(Z._query,Q),new w6(Z.firestore,Z.converter,K7(Z._query,Q))}_parse(Z){let Q=KZ(Z.firestore);return function(W,X,U,Y,z,P,F){let j;if(z.isKeyField()){if(P==="array-contains"||P==="array-contains-any")throw new L(A.INVALID_ARGUMENT,`Invalid Query. You can't perform '${P}' queries on documentId().`);if(P==="in"||P==="not-in"){cQ(F,P);let T=[];for(let C of F)T.push(bQ(Y,W,C));j={arrayValue:{values:T}}}else j=bQ(Y,W,F)}else P!=="in"&&P!=="not-in"&&P!=="array-contains-any"||cQ(F,P),j=gW(U,X,F,P==="in"||P==="not-in");return K0.create(z,P,j)}(Z._query,"where",Q,Z.firestore._databaseId,this._field,this._op,this._value)}}class VZ extends r1{constructor(Z,Q){super(),this.type=Z,this._queryConstraints=Q}static _create(Z,Q){return new VZ(Z,Q)}_parse(Z){let Q=this._queryConstraints.map((K)=>K._parse(Z)).filter((K)=>K.getFilters().length>0);return Q.length===1?Q[0]:T0.create(Q,this._getOperator())}_apply(Z){let Q=this._parse(Z);return Q.getFilters().length===0?Z:(function(J,W){let X=J,U=W.getFlattenedFilters();for(let Y of U)v3(X,Y),X=K7(X,Y)}(Z._query,Q),new w6(Z.firestore,Z.converter,K7(Z._query,Q)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}class YZ extends b1{constructor(Z,Q){super(),this._field=Z,this._direction=Q,this.type="orderBy"}static _create(Z,Q){return new YZ(Z,Q)}_apply(Z){let Q=function(J,W,X){if(J.startAt!==null)throw new L(A.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(J.endAt!==null)throw new L(A.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new d6(W,X)}(Z._query,this._field,this._direction);return new w6(Z.firestore,Z.converter,function(J,W){let X=J.explicitOrderBy.concat([W]);return new j6(J.path,J.collectionGroup,X,J.filters.slice(),J.limit,J.limitType,J.startAt,J.endAt)}(Z._query,Q))}}function zZ(Z,Q="asc"){let K=Q,J=XZ("orderBy",Z);return YZ._create(J,K)}class HZ extends b1{constructor(Z,Q,K){super(),this.type=Z,this._limit=Q,this._limitType=K}static _create(Z,Q,K){return new HZ(Z,Q,K)}_apply(Z){return new w6(Z.firestore,Z.converter,T1(Z._query,this._limit,this._limitType))}}function h3(Z){return pG("limit",Z),HZ._create("limit",Z,"F")}function bQ(Z,Q,K){if(typeof(K=x0(K))=="string"){if(K==="")throw new L(A.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!n5(Q)&&K.indexOf("/")!==-1)throw new L(A.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${K}' contains a '/' character.`);let J=Q.path.child(r.fromString(K));if(!h.isDocumentKey(J))throw new L(A.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${J}' is not because it has an odd number of segments (${J.length}).`);return MQ(Z,new h(J))}if(K instanceof X0)return MQ(Z,K._key);throw new L(A.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${h1(K)}.`)}function cQ(Z,Q){if(!Array.isArray(Z)||Z.length===0)throw new L(A.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${Q.toString()}' filters.`)}function v3(Z,Q){let K=function(W,X){for(let U of W)for(let Y of U.getFlattenedFilters())if(X.indexOf(Y.op)>=0)return Y.op;return null}(Z.filters,function(W){switch(W){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(Q.op));if(K!==null)throw K===Q.op?new L(A.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${Q.op.toString()}' filter.`):new L(A.INVALID_ARGUMENT,`Invalid query. You cannot use '${Q.op.toString()}' filters with '${K.toString()}' filters.`)}class m3{convertValue(Z,Q="none"){switch(V6(Z)){case 0:return null;case 1:return Z.booleanValue;case 2:return e(Z.integerValue||Z.doubleValue);case 3:return this.convertTimestamp(Z.timestampValue);case 4:return this.convertServerTimestamp(Z,Q);case 5:return Z.stringValue;case 6:return this.convertBytes(n0(Z.bytesValue));case 7:return this.convertReference(Z.referenceValue);case 8:return this.convertGeoPoint(Z.geoPointValue);case 9:return this.convertArray(Z.arrayValue,Q);case 11:return this.convertObject(Z.mapValue,Q);case 10:return this.convertVectorValue(Z.mapValue);default:throw v(62114,{value:Z})}}convertObject(Z,Q){return this.convertObjectMap(Z.fields,Q)}convertObjectMap(Z,Q="none"){let K={};return H6(Z,(J,W)=>{K[J]=this.convertValue(W,Q)}),K}convertVectorValue(Z){let Q=Z.fields?.[l6].arrayValue?.values?.map((K)=>e(K.doubleValue));return new u0(Q)}convertGeoPoint(Z){return new m0(e(Z.latitude),e(Z.longitude))}convertArray(Z,Q){return(Z.values||[]).map((K)=>this.convertValue(K,Q))}convertServerTimestamp(Z,Q){switch(Q){case"previous":let K=m1(Z);return K==null?null:this.convertValue(K,Q);case"estimate":return this.convertTimestamp(k8(Z));default:return null}}convertTimestamp(Z){let Q=o0(Z);return new c(Q.seconds,Q.nanos)}convertDocumentKey(Z,Q){let K=r.fromString(Z);o(RK(K),9688,{name:Z});let J=new h8(K.get(1),K.get(3)),W=new h(K.popFirst(5));return J.isEqual(Q)||d0(`Document ${W} contains a document reference within a different database (${J.projectId}/${J.database}) which is not supported. It will be treated as a reference in the current database (${Q.projectId}/${Q.database}) instead.`),W}}function sW(Z,Q,K){let J;return J=Z?K&&(K.merge||K.mergeFields)?Z.toFirestore(Q,K):Z.toFirestore(Q):Q,J}class _8{constructor(Z,Q){this.hasPendingWrites=Z,this.fromCache=Q}isEqual(Z){return this.hasPendingWrites===Z.hasPendingWrites&&this.fromCache===Z.fromCache}}class m6 extends WZ{constructor(Z,Q,K,J,W,X){super(Z,Q,K,J,X),this._firestore=Z,this._firestoreImpl=Z,this.metadata=W}exists(){return super.exists()}data(Z={}){if(this._document){if(this._converter){let Q=new x8(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(Q,Z)}return this._userDataWriter.convertValue(this._document.data.value,Z.serverTimestamps)}}get(Z,Q={}){if(this._document){let K=this._document.data.field(XZ("DocumentSnapshot.get",Z));if(K!==null)return this._userDataWriter.convertValue(K,Q.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new L(A.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");let Z=this._document,Q={};if(Q.type=m6._jsonSchemaVersion,Q.bundle="",Q.bundleSource="DocumentSnapshot",Q.bundleName=this._key.toString(),!Z||!Z.isValidDocument()||!Z.isFoundDocument())return Q;return this._userDataWriter.convertObjectMap(Z.data.value.mapValue.fields,"previous"),Q.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),Q}}m6._jsonSchemaVersion="firestore/documentSnapshot/1.0",m6._jsonSchema={type:J0("string",m6._jsonSchemaVersion),bundleSource:J0("string","DocumentSnapshot"),bundleName:J0("string"),bundle:J0("string")};class x8 extends m6{data(Z={}){return super.data(Z)}}class u6{constructor(Z,Q,K,J){this._firestore=Z,this._userDataWriter=Q,this._snapshot=J,this.metadata=new _8(J.hasPendingWrites,J.fromCache),this.query=K}get docs(){let Z=[];return this.forEach((Q)=>Z.push(Q)),Z}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(Z,Q){this._snapshot.docs.forEach((K)=>{Z.call(Q,new x8(this._firestore,this._userDataWriter,K.key,K,new _8(this._snapshot.mutatedKeys.has(K.key),this._snapshot.fromCache),this.query.converter))})}docChanges(Z={}){let Q=!!Z.includeMetadataChanges;if(Q&&this._snapshot.excludesMetadataChanges)throw new L(A.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===Q||(this._cachedChanges=function(J,W){if(J._snapshot.oldDocs.isEmpty()){let X=0;return J._snapshot.docChanges.map((U)=>{let Y=new x8(J._firestore,J._userDataWriter,U.doc.key,U.doc,new _8(J._snapshot.mutatedKeys.has(U.doc.key),J._snapshot.fromCache),J.query.converter);return U.doc,{type:"added",doc:Y,oldIndex:-1,newIndex:X++}})}{let X=J._snapshot.oldDocs;return J._snapshot.docChanges.filter((U)=>W||U.type!==3).map((U)=>{let Y=new x8(J._firestore,J._userDataWriter,U.doc.key,U.doc,new _8(J._snapshot.mutatedKeys.has(U.doc.key),J._snapshot.fromCache),J.query.converter),z=-1,P=-1;return U.type!==0&&(z=X.indexOf(U.doc.key),X=X.delete(U.doc.key)),U.type!==1&&(X=X.add(U.doc),P=X.indexOf(U.doc.key)),{type:iW(U.type),doc:Y,oldIndex:z,newIndex:P}})}}(this,Q),this._cachedChangesIncludeMetadataChanges=Q),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new L(A.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");let Z={};Z.type=u6._jsonSchemaVersion,Z.bundleSource="QuerySnapshot",Z.bundleName=k1.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;let Q=[],K=[],J=[];return this.docs.forEach((W)=>{W._document!==null&&(Q.push(W._document),K.push(this._userDataWriter.convertObjectMap(W._document.data.value.mapValue.fields,"previous")),J.push(W.ref.path))}),Z.bundle=(this._firestore,this.query._query,Z.bundleName,"NOT SUPPORTED"),Z}}function iW(Z){switch(Z){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return v(61501,{type:Z})}}u6._jsonSchemaVersion="firestore/querySnapshot/1.0",u6._jsonSchema={type:J0("string",u6._jsonSchemaVersion),bundleSource:J0("string","QuerySnapshot"),bundleName:J0("string"),bundle:J0("string")};class u3 extends m3{constructor(Z){super(),this.firestore=Z}convertBytes(Z){return new A0(Z)}convertReference(Z){let Q=this.convertDocumentKey(Z,this.firestore._databaseId);return new X0(this.firestore,null,Q)}}function PZ(Z){Z=p6(Z,w6);let Q=p6(Z.firestore,r8),K=S3(Q),J=new u3(Q);return lW(Z._query),CW(K,Z._query).then((W)=>new u6(Q,J,Z,W))}function wZ(Z,Q,K,...J){Z=p6(Z,X0);let W=p6(Z.firestore,r8),X=KZ(W),U;return U=typeof(Q=x0(Q))=="string"||Q instanceof b8?fW(X,"updateDoc",Z._key,Q,K,J):uW(X,"updateDoc",Z._key,Q),g3(W,[U.toMutation(Z._key,h0.exists(!0))])}function f3(Z,Q){let K=p6(Z.firestore,r8),J=o1(Z),W=sW(Z.converter,Q);return g3(K,[mW(KZ(Z.firestore),"addDoc",J._key,W,Z.converter!==null,{}).toMutation(J._key,h0.exists(!1))]).then(()=>J)}function g3(Z,Q){return function(J,W){let X=new i0;return J.asyncQueue.enqueueAndForget(async()=>IW(await xW(J),W,X)),X.promise}(S3(Z),Q)}(function(Q,K=!0){(function(W){b6=W})(ZQ),R8(new J6("firestore",(J,{instanceIdentifier:W,options:X})=>{let U=J.getProvider("app").getImmediate(),Y=new r8(new Q5(J.getProvider("auth-internal")),new G5(U,J.getProvider("app-check-internal")),function(P,F){if(!Object.prototype.hasOwnProperty.apply(P.options,["projectId"]))throw new L(A.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new h8(P.options.projectId,F)}(U,W),U);return X={useFetchStreams:K,...X},Y._setSettings(X),Y},"PUBLIC").setMultipleInstances(!0)),W6(UQ,VQ,Q),W6(UQ,VQ,"esm2020")})();var p3={apiKey:"__FIREBASE_API_KEY__",authDomain:"__FIREBASE_AUTH_DOMAIN__",projectId:"__FIREBASE_PROJECT_ID__",storageBucket:"__FIREBASE_STORAGE_BUCKET__",messagingSenderId:"__FIREBASE_MESSAGING_SENDER_ID__",appId:"__FIREBASE_APP_ID__",measurementId:"__FIREBASE_MEASUREMENT_ID__"};var dW=m9(p3),e8=A3(dW);function oW(){let Z=localStorage.getItem("deviceId");if(!Z)Z="device_"+crypto.randomUUID(),localStorage.setItem("deviceId",Z);return Z}var l3=oW();async function BZ(Z){let Q=document.getElementById("leaderboardList");if(!Q)return;Q.innerHTML="<p>Loading...</p>";try{let K=d1(e8,`leaderboard_${Z}`),J=$Z(K,zZ("time","asc"),h3(10)),W=await PZ(J);if(W.empty){Q.innerHTML="<p>No scores yet. Be the first!</p>";return}Q.innerHTML="";let X=1;W.forEach((U)=>{let Y=U.data(),z=document.createElement("div");z.className="leaderboard-item",z.innerHTML=`
        <span class="rank">#${X}</span>
        <span class="name">${Y.name}</span>
        <span class="time">${Y.time}s</span>
      `,Q.appendChild(z),X++})}catch(K){console.error("Error fetching leaderboard:",K),Q.innerHTML="<p>Error loading scores.</p>"}}async function s3(Z,Q,K){let J=`leaderboard_${Z.difficulty}`;try{let W=d1(e8,J),X=$Z(W,zZ("time","asc")),U=await PZ(X),Y=null,z=1/0;for(let P of U.docs)if(P.data().deviceId===l3){Y=P.id,z=P.data().time;break}if(Y)if(Z.time<z){let P=o1(e8,J,Y);await wZ(P,{name:Q,time:Z.time,timestamp:Date.now()})}else{let P=o1(e8,J,Y);await wZ(P,{name:Q})}else await f3(d1(e8,J),{deviceId:l3,name:Q,time:Z.time,timestamp:Date.now()});K()}catch(W){console.error("Error submitting score:",W),alert("Failed to submit score. Please try again.")}}class qZ{ctx=null;enabled=!0;constructor(){try{let Z=window.AudioContext||window.webkitAudioContext;this.ctx=new Z}catch(Z){console.warn("Web Audio API not supported")}}toggle(){return this.enabled=!this.enabled,this.enabled}isEnabled(){return this.enabled}initCtx(){if(this.ctx&&this.ctx.state==="suspended")this.ctx.resume()}playClick(){if(!this.enabled||!this.ctx)return;this.initCtx();let Z=this.ctx.createOscillator(),Q=this.ctx.createGain();Z.connect(Q),Q.connect(this.ctx.destination),Z.type="sine",Z.frequency.setValueAtTime(800,this.ctx.currentTime),Z.frequency.exponentialRampToValueAtTime(400,this.ctx.currentTime+0.1),Q.gain.setValueAtTime(0.1,this.ctx.currentTime),Q.gain.exponentialRampToValueAtTime(0.01,this.ctx.currentTime+0.1),Z.start(),Z.stop(this.ctx.currentTime+0.1)}playFlag(){if(!this.enabled||!this.ctx)return;this.initCtx();let Z=this.ctx.createOscillator(),Q=this.ctx.createGain();Z.connect(Q),Q.connect(this.ctx.destination),Z.type="triangle",Z.frequency.setValueAtTime(400,this.ctx.currentTime),Q.gain.setValueAtTime(0.1,this.ctx.currentTime),Q.gain.exponentialRampToValueAtTime(0.01,this.ctx.currentTime+0.1),Z.start(),Z.stop(this.ctx.currentTime+0.1)}playExplosion(){if(!this.enabled||!this.ctx)return;this.initCtx();let Z=0.5,Q=this.ctx.sampleRate*Z,K=this.ctx.createBuffer(1,Q,this.ctx.sampleRate),J=K.getChannelData(0);for(let Y=0;Y<Q;Y++)J[Y]=Math.random()*2-1;let W=this.ctx.createBufferSource();W.buffer=K;let X=this.ctx.createBiquadFilter();X.type="lowpass",X.frequency.setValueAtTime(1000,this.ctx.currentTime),X.frequency.exponentialRampToValueAtTime(100,this.ctx.currentTime+Z);let U=this.ctx.createGain();U.gain.setValueAtTime(0.3,this.ctx.currentTime),U.gain.exponentialRampToValueAtTime(0.01,this.ctx.currentTime+Z),W.connect(X),X.connect(U),U.connect(this.ctx.destination),W.start()}playWin(){if(!this.enabled||!this.ctx)return;this.initCtx();let Z=this.ctx.currentTime;[523.25,659.25,783.99,1046.5].forEach((K,J)=>{if(!this.ctx)return;let W=this.ctx.createOscillator(),X=this.ctx.createGain();W.connect(X),X.connect(this.ctx.destination),W.type="sine",W.frequency.value=K;let U=Z+J*0.1;X.gain.setValueAtTime(0,U),X.gain.linearRampToValueAtTime(0.1,U+0.05),X.gain.exponentialRampToValueAtTime(0.01,U+0.4),W.start(U),W.stop(U+0.4)})}}class FZ{levels=N4;gridEl;mineEl;hintEl;timerEl;diffSelect;customModal;customInputs;overlay;modal;modalTitle;modalText;bestEl;soundBtn;flagBtn;grid=[];R=9;C=9;M=10;flags=0;hints=I9;started=!1;gameOver=!1;time=0;timerInterval;startTime=0;currentDiff="easy";customConfig=null;isLeftDown=!1;isRightDown=!1;soundManager;flagMode=!1;constructor(){this.soundManager=new qZ,this.gridEl=document.getElementById("grid"),this.gridEl.addEventListener("contextmenu",(Z)=>Z.preventDefault()),this.mineEl=document.getElementById("mineCount"),this.hintEl=document.getElementById("hintBtn"),this.timerEl=document.getElementById("timer"),this.diffSelect=document.getElementById("difficulty"),this.customModal=document.getElementById("customModalOverlay"),this.customInputs={r:document.getElementById("customR"),c:document.getElementById("customC"),m:document.getElementById("customM")},this.overlay=document.getElementById("overlay"),this.modal=this.overlay.querySelector(".modal"),this.modalTitle=document.getElementById("modalTitle"),this.modalText=document.getElementById("modalText"),this.bestEl=document.getElementById("best"),this.soundBtn=document.getElementById("soundBtn"),this.flagBtn=document.getElementById("flagBtn"),this.loadTheme(),this.updateBest(),this.restart(),this.setupGlobalEvents()}toggleSound(){let Z=this.soundManager.toggle();this.soundBtn.innerText=Z?"\uD83D\uDD0A":"\uD83D\uDD07"}toggleFlagMode(){this.flagMode=!this.flagMode,this.flagBtn.classList.toggle("active",this.flagMode),this.soundManager.playClick()}setupGlobalEvents(){document.addEventListener("mousedown",(Z)=>{if(Z.button===0)this.isLeftDown=!0;if(Z.button===2)this.isRightDown=!0}),document.addEventListener("mouseup",()=>{this.isLeftDown=!1,this.isRightDown=!1}),document.addEventListener("keydown",(Z)=>{if(Z.target.tagName==="INPUT")return;switch(Z.key.toLowerCase()){case"r":this.restart();break;case"h":this.useHint();break;case"t":this.handleTheme();break;case"m":this.toggleSound();break}})}loadTheme(){let Z=localStorage.getItem("theme");if(Z==="dark"||!Z){if(document.body.classList.add("dark"),!Z)localStorage.setItem("theme","dark")}}handleTheme(){document.body.classList.toggle("dark");let Z=document.body.classList.contains("dark");localStorage.setItem("theme",Z?"dark":"light")}restart(){this.stopTimer(),this.overlay.style.display="none",this.overlay.classList.remove("visible"),this.modal.classList.remove("win","lose"),this.started=!1,this.gameOver=!1,this.time=0,this.timerEl.innerText="00:00";let Z=this.diffSelect.value;if(Z==="custom"){if(!this.customConfig){this.customModal.classList.add("visible"),this.customModal.style.display="flex";return}this.R=this.customConfig.r,this.C=this.customConfig.c,this.M=this.customConfig.m}else{this.customConfig=null,this.currentDiff=Z;let Q=this.levels[Z];this.R=Q.r,this.C=Q.c,this.M=Q.m}this.flags=0,this.flagMode=!1,this.flagBtn.classList.remove("active"),this.hints=I9,this.updateMineCount(),this.updateHintCount(),this.grid=[],this.gridEl.innerHTML="",this.gridEl.style.gridTemplateColumns=`repeat(${this.C}, auto)`;for(let Q=0;Q<this.R;Q++){this.grid[Q]=[];for(let K=0;K<this.C;K++){let J=document.createElement("div");J.className="cell";let W=new N9(Q,K,J);J.addEventListener("mousedown",(U)=>{if(U.button===0)if(this.flagMode)this.toggleFlag(W);else this.handleClick(W);else if(U.button===2)U.preventDefault(),this.toggleFlag(W)}),J.addEventListener("mouseenter",()=>{if(this.isLeftDown){if(!this.flagMode)this.handleClick(W)}else if(this.isRightDown){if(!W.revealed&&!W.flagged)this.toggleFlag(W)}});let X;J.addEventListener("touchstart",(U)=>{if(this.flagMode){U.preventDefault(),this.toggleFlag(W);return}X=setTimeout(()=>{this.toggleFlag(W),navigator.vibrate?.(50)},500)},{passive:!1}),J.addEventListener("touchend",(U)=>{if(clearTimeout(X),this.flagMode)return}),J.addEventListener("dblclick",()=>this.tryChord(W)),this.gridEl.appendChild(J),this.grid[Q][K]=W}}this.updateBest()}updateMineCount(){this.mineEl.innerHTML=`\uD83D\uDCA3 ${this.M-this.flags}`}updateHintCount(){this.hintEl.innerText=`\uD83D\uDCA1 ${this.hints}`,this.hintEl.disabled=this.hints===0||this.gameOver}useHint(){if(this.gameOver||this.hints<=0||!this.started)return;let Z=[];for(let Q=0;Q<this.R;Q++)for(let K=0;K<this.C;K++){let J=this.grid[Q][K];if(!J.mine&&!J.revealed&&!J.flagged)Z.push(J)}if(Z.length>0){let Q=Z[Math.floor(Math.random()*Z.length)];this.reveal(Q),Q.el.style.transition="background-color 0.5s",Q.el.style.backgroundColor="#fbbf24",setTimeout(()=>{Q.el.style.backgroundColor=""},500),this.hints--,this.updateHintCount()}}applyCustom(){let Z=parseInt(this.customInputs.r.value),Q=parseInt(this.customInputs.c.value),K=parseInt(this.customInputs.m.value);if(Z<5||Q<5||K<1)return;if(K>=Z*Q){alert("Too many mines!");return}this.customConfig={r:Z,c:Q,m:K},this.customModal.style.display="none",this.customModal.classList.remove("visible"),this.restart()}cancelCustom(){this.customModal.style.display="none",this.customModal.classList.remove("visible"),this.diffSelect.value=this.currentDiff,this.restart()}startTimer(){this.startTime=Date.now(),this.timerInterval=setInterval(()=>{let Z=Math.floor((Date.now()-this.startTime)/1000);this.time=Z;let Q=Math.floor(Z/60).toString().padStart(2,"0"),K=(Z%60).toString().padStart(2,"0");this.timerEl.innerText=`${Q}:${K}`},1000)}stopTimer(){if(this.timerInterval)clearInterval(this.timerInterval)}placeMines(Z){let Q=0;while(Q<this.M){let K=Math.floor(Math.random()*this.R),J=Math.floor(Math.random()*this.C),W=this.grid[K][J],X=Math.abs(K-Z.r),U=Math.abs(J-Z.c),Y=X<=1&&U<=1;if(!W.mine&&!Y)W.mine=!0,Q++}}handleClick(Z){if(this.gameOver||Z.flagged)return;if(Z.revealed){this.tryChord(Z);return}if(!this.started)this.started=!0,this.placeMines(Z),this.startTimer();this.reveal(Z),this.soundManager.playClick()}toggleFlag(Z){if(this.gameOver||Z.revealed||!this.started)return;Z.flagged=!Z.flagged,Z.el.classList.toggle("flagged"),Z.el.textContent=Z.flagged?"\uD83D\uDEA9":"",this.flags+=Z.flagged?1:-1,this.updateMineCount(),this.soundManager.playFlag()}reveal(Z){if(Z.revealed||Z.flagged)return;if(Z.revealed=!0,Z.el.classList.add("revealed"),Z.mine){this.endGame(!1,Z);return}let Q=this.countMines(Z);if(Q>0)Z.el.textContent=Q.toString(),Z.el.classList.add(`n${Q}`);else this.getNeighbors(Z).forEach((K)=>this.reveal(K));this.checkWin()}tryChord(Z){if(!Z.revealed)return;let Q=this.countMines(Z),K=this.getNeighbors(Z),J=K.filter((W)=>W.flagged).length;if(Q===J)K.forEach((W)=>{if(!W.flagged&&!W.revealed)this.reveal(W)})}countMines(Z){return this.getNeighbors(Z).filter((Q)=>Q.mine).length}getNeighbors(Z){let Q=[];for(let K=-1;K<=1;K++)for(let J=-1;J<=1;J++){if(K===0&&J===0)continue;let W=Z.r+K,X=Z.c+J;if(W>=0&&W<this.R&&X>=0&&X<this.C)Q.push(this.grid[W][X])}return Q}checkWin(){if(this.gameOver)return;let Z=this.R*this.C;if(this.grid.flat().filter((K)=>K.revealed).length===Z-this.M)this.endGame(!0)}endGame(Z,Q){if(this.gameOver=!0,this.stopTimer(),Z)this.soundManager.playWin();else this.soundManager.playExplosion();if(this.grid.flat().forEach((K)=>{if(K.mine)if(Z)K.el.textContent="\uD83D\uDEA9",K.el.classList.add("flagged");else{if(!K.revealed)K.el.textContent="\uD83D\uDCA3",K.el.classList.add("mine");if(K===Q)K.el.classList.add("mine-trigger")}else if(K.flagged)K.el.classList.add("wrong-flag")}),Z){let K=this.diffSelect.value,J=localStorage.getItem("best-"+K);if(!J||this.time<parseInt(J))localStorage.setItem("best-"+K,this.time.toString());if(["easy","medium","hard"].includes(K))this.showNameModal();else this.showModal(!0)}else this.showModal(!1);this.updateBest()}showModal(Z){this.modalTitle.textContent=Z?"You Won! \uD83C\uDF89":"Game Over \uD83D\uDCA5",this.modalText.textContent=Z?`Completed in ${this.timerEl.innerText}`:"Better luck next time!",this.modal.className=`modal ${Z?"win":"lose"}`,this.overlay.style.display="flex",this.overlay.offsetHeight,this.overlay.classList.add("visible")}showNameModal(){let Z=document.getElementById("nameModalOverlay");Z.style.display="flex",Z.classList.add("visible");let Q=document.getElementById("playerName");Q.value=localStorage.getItem("playerName")||"",Q.focus()}submitScoreHandler(){let Q=document.getElementById("playerName").value.trim()||"Anonymous";localStorage.setItem("playerName",Q);let K={time:this.time,difficulty:this.diffSelect.value};s3(K,Q,()=>{this.closeNameModal(),this.restart(),this.showLeaderboardHandler()})}closeNameModal(){let Z=document.getElementById("nameModalOverlay");Z.style.display="none",Z.classList.remove("visible")}showLeaderboardHandler(){let Z=document.getElementById("leaderboardOverlay");Z.style.display="flex",Z.classList.add("visible"),BZ("easy"),document.querySelectorAll(".tab-btn").forEach((Q)=>{Q.onclick=()=>{document.querySelectorAll(".tab-btn").forEach((K)=>K.classList.remove("active")),Q.classList.add("active"),BZ(Q.dataset.diff||"easy")}})}closeLeaderboard(){let Z=document.getElementById("leaderboardOverlay");Z.style.display="none",Z.classList.remove("visible")}updateBest(){let Z=this.diffSelect.value,Q=localStorage.getItem("best-"+Z);this.bestEl.textContent=Q?`\uD83C\uDFC6 Best: ${Q}s`:""}}var S0=new FZ;window.restartGame=()=>S0.restart();window.toggleTheme=()=>S0.handleTheme();window.useHint=()=>S0.useHint();window.applyCustom=()=>S0.applyCustom();window.cancelCustom=()=>S0.cancelCustom();window.showLeaderboard=()=>S0.showLeaderboardHandler();window.closeLeaderboard=()=>S0.closeLeaderboard();window.submitScore=()=>S0.submitScoreHandler();window.closeNameModal=()=>S0.closeNameModal();window.toggleSound=()=>S0.toggleSound();window.toggleFlagMode=()=>S0.toggleFlagMode();document.getElementById("difficulty")?.addEventListener("change",()=>S0.restart());
